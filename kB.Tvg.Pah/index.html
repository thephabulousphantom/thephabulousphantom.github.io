<!DOCTYPE HTML>
<html>
  <head>
    <title>Phones Against Humanity</title>
    
    <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />

    <style type="text/css">
            
        body 
        {
            background-color: #000;

            -ms-touch-action: none;

            touch-action: manipulation;

            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -ms-touch-select: none;
            user-select: none;

            /*-ms-touch-action: manipulation;*/

            -webkit-backface-visibility: hidden;
        }
        
        @font-face 
        {
            font-family: CaptionFont;
            src: url(ttf/YanoneKaffeesatz-Bold.otf);
        }

        @font-face 
        {
            font-family: RegularFont;
            font-weight: bold;
            src: url(ttf/Aller_Rg.ttf);
        }

    </style>

    <!-- polyfills -->
    <script type='text/javascript' language='javascript'>var json_parse=(function(){var h,g,b,e,j,d={"\\":"\\",'"':'"',"/":"/",t:"\t",n:"\n",r:"\r",f:"\f",b:"\b"},i={go:function(){h="ok"},firstokey:function(){e=j;h="colon"},okey:function(){e=j;h="colon"},ovalue:function(){h="ocomma"},firstavalue:function(){h="acomma"},avalue:function(){h="acomma"}},f={go:function(){h="ok"},ovalue:function(){h="ocomma"},firstavalue:function(){h="acomma"},avalue:function(){h="acomma"}},a={"{":{go:function(){g.push({state:"ok"});b={};h="firstokey"},ovalue:function(){g.push({container:b,state:"ocomma",key:e});b={};h="firstokey"},firstavalue:function(){g.push({container:b,state:"acomma"});b={};h="firstokey"},avalue:function(){g.push({container:b,state:"acomma"});b={};h="firstokey"}},"}":{firstokey:function(){var k=g.pop();j=b;b=k.container;e=k.key;h=k.state},ocomma:function(){var k=g.pop();b[e]=j;j=b;b=k.container;e=k.key;h=k.state}},"[":{go:function(){g.push({state:"ok"});b=[];h="firstavalue"},ovalue:function(){g.push({container:b,state:"ocomma",key:e});b=[];h="firstavalue"},firstavalue:function(){g.push({container:b,state:"acomma"});b=[];h="firstavalue"},avalue:function(){g.push({container:b,state:"acomma"});b=[];h="firstavalue"}},"]":{firstavalue:function(){var k=g.pop();j=b;b=k.container;e=k.key;h=k.state},acomma:function(){var k=g.pop();b.push(j);j=b;b=k.container;e=k.key;h=k.state}},":":{colon:function(){if(Object.hasOwnProperty.call(b,e)){throw new SyntaxError('Duplicate key "'+e+'"')}h="ovalue"}},",":{ocomma:function(){b[e]=j;h="okey"},acomma:function(){b.push(j);h="avalue"}},"true":{go:function(){j=true;h="ok"},ovalue:function(){j=true;h="ocomma"},firstavalue:function(){j=true;h="acomma"},avalue:function(){j=true;h="acomma"}},"false":{go:function(){j=false;h="ok"},ovalue:function(){j=false;h="ocomma"},firstavalue:function(){j=false;h="acomma"},avalue:function(){j=false;h="acomma"}},"null":{go:function(){j=null;h="ok"},ovalue:function(){j=null;h="ocomma"},firstavalue:function(){j=null;h="acomma"},avalue:function(){j=null;h="acomma"}}};function c(k){return k.replace(/\\(?:u(.{4})|([^u]))/g,function(l,m,n){return m?String.fromCharCode(parseInt(m,16)):d[n]})}return function(n,m){var l,o=/^[\x20\t\n\r]*(?:([,:\[\]{}]|true|false|null)|(-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)|"((?:[^\r\n\t\\\"]|\\(?:["\\\/trnfb]|u[0-9a-fA-F]{4}))*)")/;h="go";g=[];try{for(;;){l=o.exec(n);if(!l){break}if(l[1]){a[l[1]][h]()}else{if(l[2]){j=+l[2];f[h]()}else{j=c(l[3]);i[h]()}}n=n.slice(l[0].length)}}catch(k){h=k}if(h!=="ok"||/[^\x20\t\n\r]/.test(n)){throw h instanceof SyntaxError?h:new SyntaxError("JSON")}return typeof m==="function"?(function q(r,t){var s,u,w=r[t];if(w&&typeof w==="object"){for(s in w){if(Object.prototype.hasOwnProperty.call(w,s)){u=q(w,s);if(u!==undefined){w[s]=u}else{delete w[s]}}}}return m.call(r,t,w)}({"":j},"")):j}}());(function(){if(typeof global!="undefined"&&typeof process!="undefined"&&process.hrtime){global.performance={now:function c(){var d=process.hrtime();return d[0]*1000+d[1]/1000000}};return}if(typeof window.performance==="undefined"){window.performance={}}if(!window.performance.now){var b=Date.now();if(performance.timing&&performance.timing.navigationStart){b=performance.timing.navigationStart}window.performance.now=function a(){return Date.now()-b}}})();(function(){var a=0;var b=["ms","moz","webkit","o"];for(var c=0;c<b.length&&!window.requestAnimationFrame;++c){window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(d,f){var e=new Date().getTime();var h=Math.max(0,16-(e-a));var g=window.setTimeout(function(){d(e+h)},h);a=e+h;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());window.tvg={};tvg.game={classes:{},command:{classes:{}},util:{classes:{}}};tvg=(function(b){function a(j){var i={};this.severity=null;this.writers=null;this.level=null;this.init=function h(m){this.severity={debug:1,information:2,warning:3,error:4};this.writers=[];this.level=m?m:this.severity.debug};this.attachWriter=function c(n){for(var m=0;m<this.writers.length;m++){if(this.writers[m]===n){return}}this.writers.push(n)};this.detachWriter=function e(n){for(var m=0;m<this.writers.length;m++){if(this.writers[m]===n){this.writers=this.writers.splice(m,1);return}}};i.write=function l(o,n){if(n<this.level){return}for(var m=0;m<this.writers.length;m++){if(n>=this.writers[m].level){this.writers[m].write(new Date(),arguments.callee.caller.arguments.callee.caller.name,o,n)}}};this.debug=function d(m){i.write.call(this,m,this.severity.debug)};this.information=function g(m){i.write.call(this,m,this.severity.information)};this.warning=function k(m){i.write.call(this,m,this.severity.warning)};this.error=function f(m){i.write.call(this,m,this.severity.error)};return this.init.apply(this,arguments)}b.game.log=new a();return b})(tvg);tvg=(function(c){c.game.util.classes.guid=function b(){var d=arguments.callee.prototype;this.value=null;this.init=function e(){this.value=c.game.util.classes.guid.generate();return this};this.release=function f(){this.value=null};return this.init.apply(this,arguments)};c.game.util.classes.guid.generate=function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var e=Math.random()*16|0,f=d=="x"?e:(e&3|8);return f.toString(16)})};return c})(tvg);tvg=(function(b){b.game.util.classes.logConsoleWriter=function a(g){var f={};this.init=function e(j){this.level=j?j:b.game.log.severity.debug;return this};this.release=function h(){f=null};f.formatMethod=function c(j){if(j.length<20){return j+"                    ".substr(0,20-j.length)+"\t"}if(j.length>20){return j.substr(0,20)+"\t"}return""+j+"\t"};f.formatTime=function d(j){var k=""+j.getFullYear();if(j.getMonth()+1<10){k+="0"}k+=""+(j.getMonth()+1)+"";if(j.getDate()<10){k+="0"}k+=""+j.getDate()+" ";if(j.getHours()<10){k+="0"}k+=""+j.getHours()+":";if(j.getMinutes()<10){k+="0"}k+=""+j.getMinutes()+":";if(j.getSeconds()<10){k+="0"}k+=""+j.getSeconds()+".";if(j.getMilliseconds()<10){k+="00"}else{if(j.getMilliseconds()<100){k+="0"}}k+=""+j.getMilliseconds()+"\t";return k};this.write=function i(j,k,m,l){switch(l){case b.game.log.severity.debug:console.log(f.formatTime(j),f.formatMethod(k),m);return;case b.game.log.severity.information:console.info(f.formatTime(j),f.formatMethod(k),m);return;case b.game.log.severity.warning:console.warn(f.formatTime(j),f.formatMethod(k),m);return;case b.game.log.severity.error:console.error(f.formatTime(j),f.formatMethod(k),m);return;default:console.log(f.formatTime(j),f.formatMethod(k),m);return}};return this.init.apply(this,arguments)};return b})(tvg);tvg=(function(b){b.game.util.classes.logConsoleSeverityWriter=function a(g){var f={};this.init=function e(j){this.level=j?j:b.game.log.severity.debug;return this};this.release=function h(){f=null};f.formatMethod=function c(j){if(j.length<20){return j+"                    ".substr(0,20-j.length)+"\t"}if(j.length>20){return j.substr(0,20)+"\t"}return""+j+"\t"};f.formatTime=function d(j){var k=""+j.getFullYear();if(j.getMonth()+1<10){k+="0"}k+=""+(j.getMonth()+1)+"";if(j.getDate()<10){k+="0"}k+=""+j.getDate()+" ";if(j.getHours()<10){k+="0"}k+=""+j.getHours()+":";if(j.getMinutes()<10){k+="0"}k+=""+j.getMinutes()+":";if(j.getSeconds()<10){k+="0"}k+=""+j.getSeconds()+".";if(j.getMilliseconds()<10){k+="00"}else{if(j.getMilliseconds()<100){k+="0"}}k+=""+j.getMilliseconds()+"\t";return k};this.write=function i(j,k,m,l){switch(l){case b.game.log.severity.debug:console.log("Debug\t",f.formatTime(j),f.formatMethod(k),m);return;case b.game.log.severity.information:console.log("Info\t",f.formatTime(j),f.formatMethod(k),m);return;case b.game.log.severity.warning:console.log("Warning\t",f.formatTime(j),f.formatMethod(k),m);return;case b.game.log.severity.error:console.log("Error\t",f.formatTime(j),f.formatMethod(k),m);return;default:console.log("?\t"+f.formatMethod(k),m);return}};return this.init.apply(this,arguments)};return b})(tvg);tvg.game.configuration={maxCommandHistoryLength:32,maxCommandHistoryAge:20000,getStateTimeoutMilliseconds:10000,simpleJoinMode:true,lobbyTimeoutMilliseconds:5*60*1000};tvg=(function(b){b.game.classes.entity=function a(){this.id=null;this.state=null;this.init=function c(h){this.id=""+(++b.game.classes.entity.lastId);this.state={};this.state.type=h?h:"entity";return this};this.release=function e(){for(key in this.state){if(this.state[key]&&this.state[key].release){this.state[key].release()}this.state[key]=null}this.id=null;this.state=null};this.saveState=function f(){var j={id:this.id};for(var i in this.state){if(this.state[i]===undefined||this.state[i]===null){continue}if(this.state[i].saveState){j[i]=this.state[i].saveState()}else{if(typeof this.state[i]==="object"){j[i]={};for(var h in this.state[i]){if(this.state[i][h]&&this.state[i][h].saveState){j[i][h]=this.state[i][h].saveState()}else{j[i][h]=this.state[i][h]}}}else{j[i]=this.state[i]}}}return j};this.saveStateDiff=function g(l){if(!l){return this.saveState()}var m={};for(var j in this.state){if(this.state[j]===null){if(l[j]){m[j]=null}continue}if(this.state[j].saveStateDiff){var n=this.state[j].saveStateDiff(l[j]);if(n){m[j]=n}}else{if(typeof this.state[j]==="object"){if(!l[j]){m[j]={};for(var h in this.state[j]){if(this.state[j][h]&&this.state[j][h].saveState){m[j][h]=this.state[j][h].saveState()}else{m[j][h]=this.state[j][h]}}}else{var k={};for(var h in this.state[j]){if(this.state[j][h]&&this.state[j][h].saveStateDiff){var i=this.state[j][h].saveStateDiff(l[j][h]);if(i){k[h]=i}}else{if(this.state[j][h]!=l[j][h]){k[h]=this.state[j][h]}}}for(var h in l[j]){if(this.state[j][h]===undefined){k[h]="___deleted___"}}if(Object.keys(k).length>0){m[j]=k}}}else{if(this.state[j]!=l[j]){m[j]=this.state[j]}}}}for(j in l){if(j!=="id"&&this.state[j]===undefined){m[j]="___deleted___"}}if(Object.keys(m).length){m.id=this.id;m.type=this.state.type;return m}return null};this.loadState=function d(j){for(var i in j){if(i==="id"){this.id=j.id;if(this.id>b.game.classes.entity.lastId){b.game.classes.entity.lastId=this.id}continue}if(j[i]==="___deleted___"){if(this.state[i]!==undefined){delete this.state[i]}continue}if(j[i]&&j[i].type){if(!this.state[i]){this.state[i]=new b.game.classes[j[i].type]()}this.state[i].loadState(j[i])}else{if(typeof j[i]==="object"){if(!this.state[i]){this.state[i]={}}for(var h in j[i]){if(j[i][h]==="___deleted___"){if(this.state[i][h]!==undefined){delete this.state[i][h]}}else{if(j[i][h]&&j[i][h].type){if(!this.state[i][h]){this.state[i][h]=new b.game.classes[j[i][h].type]()}this.state[i][h].loadState(j[i][h])}else{this.state[i][h]=j[i][h]}}}}else{this.state[i]=j[i]}}}};return this.init.apply(this,arguments)};b.game.classes.entity.lastId=0;return b})(tvg);tvg=(function(b){b.game.classes.player=function a(){var c=arguments.callee.prototype;this.init=function d(f){c.init.call(this,"player");this.state.nickname=f===undefined?"":""+f;this.state.readyToStart=false;return this};this.release=function e(){c.release.call(this)};return this.init.apply(this,arguments)};b.game.classes.player.prototype=new b.game.classes.entity();return b})(tvg);tvg=(function(d){d.game.classes.heart=function b(){this.init=function f(){return this};this.release=function g(){};this.beat=function e(h){};return this.init.apply(this,arguments)};d.game.classes.heart.hearts={};d.game.classes.heart.register=function c(e){if(!d.game.classes.heart.hearts[e]){d.game.classes.heart.hearts[e]=d.game.classes[e]()}};d.game.classes.heart.beat=function a(f){if(!f.heart){return}var e=d.game.classes.heart.hearts[f.heart];if(!e){return}e.beat(f)};return d})(tvg);tvg=(function(b){b.game.classes.session=function a(){var e=arguments.callee.prototype;var h={};h.offset=null;this.commandQueue=null;this.getStateCommandQueue=null;this.snapshots=null;this.init=function g(o){e.init.call(this,"session");this.commandQueue=[];this.getStateCommandQueue=[];this.snapshots={};this.state.id=this.id;this.state.time=0;this.state.frame=0;this.state.lastChangedFrame=0;this.state.roundStarted=false;this.state.lastJoinedPlayerId=-1;this.state.players={};this.state.heart=null;this.state.endTime=null;if(o){this.loadState(o);if(this.state.heart){b.game.classes.heart.register(this.state.heart)}b.game.log.information("Game "+this.id+", started @ "+this.startTime+", joining.")}else{b.game.log.information("Game "+this.id+", starting @ "+performance.now()+".")}return this};this.release=function j(){this.commandQueue=null;this.getStateCommandQueue=null;this.snapshots=null;this.state=null;h=null;e.release.call(this)};this.addPlayer=function c(o){if(o==""){return null}for(playerId in this.state.players){var q=this.state.players[playerId];if(q.state.nickname==o){b.game.log.warning("Game "+this.id+", nickname "+o+" already taken, cannot add player.");return null}}var q=new b.game.classes.player(o);this.state.players[q.id]=q;this.state.lastJoinedPlayerId=q.id;b.game.log.information("Game "+this.id+", player "+q.id+", added as "+o+".");return q};this.removePlayer=function k(q){var o=this.state.players[q];if(o){b.game.log.information("Game "+this.id+", player "+o.id+", removed.");this.state.players[q]=null;delete this.state.players[q];if(Object.keys(this.state.players).length==0){this.stop()}return o}else{b.game.log.warning("Game "+this.id+", player "+q+", not in the game, can't remove player.")}return null};this.setHeart=function l(o){b.game.log.information("Game "+this.id+", setting heart to "+o+".");this.state.heart=o;b.game.classes.heart.register(this.state.heart)};this.allPlayersReady=function d(){var o=0;for(playerId in this.state.players){if(!this.state.players[playerId].state.ready){return false}o++}return o>1};this.stop=function m(){this.state.endTime=new Date();b.game.kernel.removeSession(this);b.game.log.information("Game "+this.id+", stopping @ "+this.state.endTime+", lasted "+((((this.state.endTime-this.startTime)/1000)/60)|0)+"min "+((((this.state.endTime-this.startTime)/1000)%60)|0)+"sec.")};this.enqueue=function f(o){if(o.commandName=="getState"){o.timeReceived=this.state.time;if(o.frame>=this.state.lastChangedFrame){this.getStateCommandQueue.push(o)}else{o.session=this;o.execute.apply(o,o.commandParameters);o.release();o=null}return}for(var q=0;q<this.commandQueue.length;q++){var r=this.commandQueue[q];if(r.frame>o.frame){this.commandQueue.splice(q,0,o);return}}this.commandQueue.push(o)};this.tick=function n(r){this.state.time=r;this.state.frame++;if(this.state.frame%60===0){if(!this.state.roundStarted){var q=performance.now()-this.startTime;if(q>b.game.configuration.lobbyTimeoutMilliseconds){b.game.log.warning("Game "+this.id+", has not started in "+(q/1000)+"sec, terminating.");this.stop.call(this);this.processGetStateCommands.call(this,r)}}}while(this.commandQueue.length){var o=this.commandQueue[0];if(o.frame>this.state.frame){break}this.commandQueue.shift();o.session=this;o.execute.apply(o,o.commandParameters);if(o.executed&&o.commandName!="getState"){this.state.lastChangedFrame=this.state.frame}o.release();o=null}b.game.classes.heart.beat(this.state);this.processGetStateCommands.call(this,r)};this.processGetStateCommands=function i(s){var q=null;for(var r=0;r<this.getStateCommandQueue.length;r++){var o=this.getStateCommandQueue[r];if(o.frame<this.state.lastChangedFrame){if(!q){q=this.saveState()}o.session=this;o.execute.call(o,o.commandParameters[0],q);o.release();o=null;this.getStateCommandQueue.splice(r--,1);continue}if((this.state.time-o.timeReceived)>b.game.configuration.getStateTimeoutMilliseconds){o.session=this;o.failed.call(o,"Time out.");o.release();o=null;this.getStateCommandQueue.splice(r--,1);continue}}};return this.init.apply(this,arguments)};b.game.classes.session.prototype=new b.game.classes.entity();return b})(tvg);tvg=(function(b){b.game.classes.kernel=function a(){this.sessions=null;this.commandQueue=null;this.frameDuration=null;this.init=function f(){this.frameDuration=0.01*((100000/60)|0);this.sessions={};this.commandQueue=[]};this.release=function g(){this.frameDuration=null;this.commandQueue=null;for(sessionId in this.sessions){var i=this.sessions[sessionId];i.stop();i.release()}this.sessions=null};this.addSession=function c(i){i.startTime=performance.now();this.sessions[i.id]=i};this.removeSession=function c(i){i.state.endTime=performance.now();this.sessions[i.id]=null;delete this.sessions[i.id]};this.getSession=function e(i){return this.sessions[i]};this.enqueue=function d(j){if(j.sessionId){var m=this.sessions[j.sessionId];if(!m){j.failed("Invalid  session ID "+j.sessionId);return}m.enqueue(j)}else{for(var k=0;k<this.commandQueue.length;k++){var l=this.commandQueue[k];if(l.frame>j.frame){this.commandQueue.splice(k,0,j);return}}this.commandQueue.push(j)}};this.tick=function h(n){while(this.commandQueue.length){var i=this.commandQueue.shift();if(i.sessionId){i.failed.call(i,"Invalid session ID: "+i.sessionId)}else{i.execute.apply(i,i.commandParameters)}i.release();i=null}for(var l in this.sessions){var k=this.sessions[l];var j=k.state.time;var m=n-k.startTime;while(j<m){j+=this.frameDuration;k.tick.call(k,j)}}};return this.init.apply(this,arguments)};return b})(tvg);tvg=(function(b){b.game.classes.randomizer=function a(g){var e={};this.init=function d(h){e.seed=h;return this};this.generate=function c(h){e.seed=(e.seed*e.seed)%(3469*9769);return(e.seed/(3469*9769))*(h===undefined?1:h)};this.release=function f(){e=null};return this.init.apply(this,arguments)};return b})(tvg);tvg=(function(b){b.game.command.classes.command=function a(){this.sessionId=null;this.frame=null;this.commandName=null;this.commandParameters=null;this.successCallback=null;this.failCallback=null;this.state=null;this.session=null;this.executed=null;this.init=function e(i,j,m,k,l){this.sessionId=null;this.frame=null;this.commandName=i?""+i:null;if(j){this.parameters.apply(this,j)}else{this.commandParameters=null}this.successCallback=m?m:null;this.failCallback=k?k:null;this.state=l?l:null;this.session=null;this.executed=false};this.parameters=function f(){this.sessionId=(arguments[0]&&arguments[0]!="")?""+arguments[0]:null;this.frame=arguments[1]?arguments[1]|0:null;this.commandParameters=Array.prototype.slice.call(arguments);this.commandParameters.splice(0,2)};this.release=function g(){this.sessionId=null;this.frame=null;this.commandName=null;this.commandParameters=null;this.successCallback=null;this.failCallback=null;this.state=null;this.session=null;this.executed=null};this.execute=function c(){this.failed("Not implemented")};this.succeeded=function h(i){if(this.successCallback){this.successCallback(this.state,i?i:{},this.commandName,this.commandParameters)}this.executed=true};this.failed=function d(i){if(this.failCallback){this.failCallback(this.state,i?i:"Unspecified error.",this.commandName,this.commandParameters)}this.executed=false};return this.init.apply(this,arguments)};return b})(tvg);tvg=(function(b){b.game.command.classes.startGame=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"startGame",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(i,h){if(!i){b.game.log.warning("Game ?, can't startGame("+i+", "+h+").");this.failed("Host nickname is required.");return}if(b.game.configuration.simpleJoinMode){for(sessionId in b.game.kernel.sessions){var g=b.game.kernel.sessions[sessionId];if(!g.state.roundStarted){var j=g.addPlayer(i);if(!j){b.game.log.warning("Game "+g.id+", can't start-joinGame, nickname "+i+" already taken.");this.failed("Nickname already in use.");return}b.game.log.information("Game "+g.id+", player "+j.id+", start-joined as "+i+".");this.succeeded({playerId:j.id,state:g.saveState()});return}}}var k=new b.game.classes.session();k.setHeart(h?h:"heart");var j=k.addPlayer(i);j.state.host="1";b.game.log.information("Game "+k.id+", player "+j.id+", started "+h+" game, as "+i+".");b.game.kernel.addSession(k);this.succeeded({playerId:j.id,state:k.saveState()})};return this.init.apply(this,arguments)};b.game.command.classes.startGame.prototype=new b.game.command.classes.command();return b})(tvg);tvg=(function(b){b.game.command.classes.joinGame=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"joinGame",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(g){if(!this.session){b.game.log.warning("Game ?, can't joinGame("+g+").");this.failed("Invalid session.");return}if(!g){b.game.log.warning("Game "+this.session.id+", can't joinGame, no nickname specified.");this.failed("Nickname is required.");return}var h=this.session.addPlayer(g);if(!h){b.game.log.warning("Game "+this.session.id+", can't joinGame, nickname "+g+" already taken.");this.failed("Nickname already in use.");return}b.game.log.information("Game "+this.session.id+", player "+h.id+", joined as "+g+".");this.succeeded({playerId:h.id,state:this.session.saveState()})};return this.init.apply(this,arguments)};b.game.command.classes.joinGame.prototype=new b.game.command.classes.command();return b})(tvg);tvg=(function(b){b.game.command.classes.leaveGame=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"leaveGame",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(g){if(!this.session){b.game.log.warning("Game ?, can't leaveGame("+g+").");this.failed("Invalid session.");return}if(!this.session.removePlayer(g)){b.game.log.warning("Game "+this.session.id+", player "+g+", not in the game, player can't leave.");this.failed("Not in the game.");return}b.game.log.information("Game "+this.session.id+", player "+g+", left the game.");this.succeeded({})};return this.init.apply(this,arguments)};b.game.command.classes.leaveGame.prototype=new b.game.command.classes.command();return b})(tvg);tvg=(function(b){b.game.command.classes.getState=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"getState",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(i,h){if(!this.session){this.failed("Invalid session.");return}if(!this.session.state.players[i]){this.failed("Invalid player ID.");return}if(!h){h=this.session.saveState()}var g=this.session.snapshots[i]?this.session.saveStateDiff(this.session.snapshots[i]):h;this.session.snapshots[i]=h;this.succeeded(g)};return this.init.apply(this,arguments)};b.game.command.classes.getState.prototype=new b.game.command.classes.command();return b})(tvg);tvg=(function(b){b.game.command.classes.setReady=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"setReady",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(h,i){if(!this.session){b.game.log.warning("Game ?, can't setReady("+h+", "+i+").");this.failed("Invalid session.");return}if(!this.session.state.players[h]){b.game.log.warning("Game "+this.session.id+", player "+h+", invalid player, can't set ready state.");this.failed("Invalid player ID.");return}b.game.log.information("Game "+this.session.id+", player "+h+", changing ready status from "+(!!this.session.state.players[h].state.ready)+" to "+(!!i)+".");this.session.state.players[h].state.ready=i?true:false;if(i){if(this.session.allPlayersReady()){b.game.log.information("Game "+this.session.id+", all "+(Object.keys(this.session.state.players).length)+" players ready, starting the game.");var g=new b.game.command.classes.startRound([this.session.id,this.session.state.frame+3000/b.game.kernel.frameDuration]);b.game.kernel.enqueue(g)}}this.succeeded({})};return this.init.apply(this,arguments)};b.game.command.classes.setReady.prototype=new b.game.command.classes.command();return b})(tvg);tvg=(function(b){b.game.command.classes.startRound=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"startRound",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(){if(!this.session){b.game.log.warning("Game ?, can't startRound.");this.failed("Invalid session.");return}if(!this.session.allPlayersReady()){b.game.log.warning("Game "+this.session.id+", aborting start because not all players are ready.");this.failed();return}b.game.log.information("Game "+this.session.id+", started.");this.session.state.roundStarted=true;this.succeeded({})};return this.init.apply(this,arguments)};b.game.command.classes.startRound.prototype=new b.game.command.classes.command();return b})(tvg);tvg.game.kernel=new tvg.game.classes.kernel();tvg.client={app:{classes:{}},evt:{classes:{}},cmd:{classes:{}},data:{classes:{}},gfx:{classes:{event:{}}},input:{classes:{event:{}}},sfx:{classes:{event:{}}},util:{classes:{}},net:{classes:{}},quit:function quit(){window.close()}};tvg=(function(a){a.client.app.Application={current:null};return a})(tvg);tvg=(function(b){b.client.app.classes.Application=function a(){var d=arguments.callee.prototype;this.handlers=null;this.time=null;var h={};h.currentScreen=null;h.running=false;h.loaded=false;h.instance=null;this.init=function g(){if(arguments.callee.caller.arguments.callee.caller.name){b.game.log.information("Initializing application "+arguments.callee.caller.arguments.callee.caller.name+".")}this.handlers=[];h.instance=this;b.client.app.Application.current=this;return this};this.release=function o(){b.game.log.information("Releasing application.");this.handlers=null;this.time=null;b.client.app.Application.current=null;h=null};this.start=function u(){b.game.log.information("Starting application.");var x=this;if(document.readyState==="complete"){setTimeout(function z(){x.onLoad.call(x)},0)}else{document.onreadystatechange=function y(){if(document.readyState==="complete"){setTimeout(function A(){x.onLoad.call(x)},0)}}}};this.pause=function l(){b.game.log.information("Pausing application.");h.running=false};this.resume=function q(){if(!h.running){b.game.log.information("Resuming application.");h.running=true;requestAnimationFrame(h.heartbeat)}else{b.game.log.warning("Application already running.")}};this.quit=function n(){b.game.log.information("Quitting application.");try{window.close()}catch(x){}try{window.top.close()}catch(x){}};this.showScreen=function s(x){b.game.log.information("Showing screen "+x.name+".");var y=h.currentScreen;if(y){y.stop.call(y)}h.currentScreen=new x();b.client.gfx.Screen.addChild(h.currentScreen);h.currentScreen.show(function z(){if(y){b.client.gfx.Screen.removeChild(y.id);y.release.call(y)}})};this.loadDrivers=function j(){b.game.log.information("Loading drivers.")};this.loadApplicationState=function i(){b.game.log.information("Loading application state.")};this.showStartingScreen=function t(){b.game.log.information("Showing start screen.")};this.onLoad=function k(){if(h.loaded){return}b.game.log.information("Loading application.");h.loaded=true;this.loadDrivers();this.loadApplicationState();this.showStartingScreen();this.resume()};this.sense=function r(x){b.client.input.Driver.sense(x)};this.processInputEvents=function m(z){if(!h.currentScreen){return}var x=null;while(x=b.client.input.Events.remove()){var y=this.handlers[x.type];if(y){y.call(this,z,x)}else{h.currentScreen.processInputEvent.call(h.currentScreen,z,x)}x.release()}};this.executeGameLoop=function e(x){b.game.kernel.tick(x);if(h.currentScreen){h.currentScreen.tick(x)}};this.updateGraphics=function v(y){var x=b.client.gfx.Driver.get();if(!x){return}x.processEvents(y)};this.updateSound=function w(y){var x=b.client.sfx.Driver.get();if(!x){return}x.processEvents(y)};this.animate=function c(x){b.client.gfx.classes.Animation.animate(x)};h.heartbeat=function f(x){if(!x){x=performance.now()}h.instance.time=x;h.instance.sense.call(h.instance,x);h.instance.processInputEvents.call(h.instance,x);h.instance.executeGameLoop.call(h.instance,x);h.instance.animate.call(h.instance,x);h.instance.updateGraphics.call(h.instance,x);h.instance.updateSound.call(h.instance,x);if(h.running){requestAnimationFrame(h.heartbeat)}};return this.init.apply(this,arguments)};b.game.log.level=b.game.log.severity.information;b.game.log.attachWriter(new b.game.util.classes.logConsoleWriter());return b})(tvg);tvg=(function(b){b.client.evt.classes.Event=function a(e){this.type=null;this.init=function c(f){this.type=f?(""+f):"Event";return this};this.release=function d(){this.type=null};return this.init.apply(this,arguments)};return b})(tvg);tvg=(function(b){b.client.evt.classes.EventPool=function a(c,h){var f={};f.events=null;this.init=function e(k,m){b.game.log.information("Initializing event pool "+k.name+" with "+m+" events.");f.events=[];f.eventType=k;for(var l=0;l<m;l++){var j=new f.eventType();j.release();f.events.push(j)}return this};this.release=function g(){f.events=null;f.eventType=null;f=null};this.get=function d(){if(f.events===null){return null}for(var k=0;k<f.events.length;k++){if(!f.events[k].type){f.events[k].init.apply(f.events[k],arguments);return f.events[k]}}b.game.log.information("Growing event pool "+f.eventType.name+" to "+(f.events.length+1)+" events.");var j=new f.eventType();j.init.apply(j,arguments);f.events.push(j);return j};return this.init.apply(this,arguments)};return b})(tvg);tvg=(function(b){b.client.evt.classes.Queue=function a(e){this.id=null;this.events=null;this.length=null;this.init=function f(i){this.id=i?(""+i):null;this.events=[];this.length=0;b.client.evt.Queues.add(this);return this};this.release=function g(){b.client.evt.Queues.remove(this.id);this.id=null;this.events=null;this.length=null};this.add=function c(i){this.events.push(i);this.length=this.events.length;return this};this.get=function d(j){if(j<0||j>=this.length){return null}return this.events[j]};this.remove=function h(j){if(j===undefined){var k=this.events.shift();this.length=this.events.length;return k}if(j<0||j>=this.length){return null}var k=this.events[j];this.events.splice(j,1);this.length=this.events.length;return k};return this.init.apply(this,arguments)};return b})(tvg);tvg=(function(b){function a(){var f={};f.all=[];this.init=function e(){};this.release=function g(){f=null};this.add=function c(i){if(f.all[i.id]){this.remove(i.id)}b.game.log.information("Adding event queue "+i.id+".");f.all[i.id]=i;return this};this.remove=function h(i){if(f.all[i]){var j=f.all[i];b.game.log.information("Removing event queue "+i+".");f.all[i]=null;delete f.all[i];j.release()}else{b.game.log.warning("Event queue "+i+" not added.")}return this};this.get=function d(i){return f.all[i]};return this.init.apply(this,arguments)}b.client.evt.Queues=new a();return b})(tvg);tvg=(function(a){a.client.gfx.Events=new a.client.evt.classes.Queue("gfx");return a})(tvg);tvg=(function(a){a.client.gfx.classes.event.VisualLoaded=function b(g,d){var c=arguments.callee.prototype;this.visual=null;this.callback=null;this.init=function e(i,h){c.init.call(this,"VisualLoaded");this.visual=i?i:null;this.callback=h?h:null;return this};this.release=function f(){this.visual=null;this.callback=null;c.release.call(this)};return this.init.apply(this,arguments)};a.client.gfx.classes.event.VisualLoaded.prototype=new a.client.evt.classes.Event();return a})(tvg);tvg=(function(a){a.client.gfx.classes.event.VisualUnloaded=function b(g,d){var c=arguments.callee.prototype;this.visual=null;this.callback=null;this.init=function e(i,h){c.init.call(this,"VisualUnloaded");this.visual=i?i:null;this.callback=h?h:null;return this};this.release=function f(){this.visual=null;this.callback=null;c.release.call(this)};return this.init.apply(this,arguments)};a.client.gfx.classes.event.VisualUnloaded.prototype=new a.client.evt.classes.Event();return a})(tvg);tvg=(function(a){a.client.gfx.classes.event.VisualShown=function b(g,d){var c=arguments.callee.prototype;this.visualId=null;this.callback=null;this.init=function e(i,h){c.init.call(this,"VisualShown");this.visualId=i?(""+i):null;this.callback=h?h:null;return this};this.release=function f(){this.visualId=null;this.callback=null;c.release.call(this)};return this.init.apply(this,arguments)};a.client.gfx.classes.event.VisualShown.prototype=new a.client.evt.classes.Event();return a})(tvg);tvg=(function(a){a.client.gfx.classes.event.VisualHidden=function b(g,d){var c=arguments.callee.prototype;this.visualId=null;this.callback=null;this.init=function e(i,h){c.init.call(this,"VisualHidden");this.visualId=i?(""+i):null;this.callback=h?h:null;return this};this.release=function f(){this.visualId=null;this.callback=null;c.release.call(this)};return this.init.apply(this,arguments)};a.client.gfx.classes.event.VisualHidden.prototype=new a.client.evt.classes.Event();return a})(tvg);tvg=(function(b){b.client.gfx.classes.event.ImageUrlChanged=function a(g,d){var c=arguments.callee.prototype;this.visualId=null;this.callback=null;this.init=function e(i,h){c.init.call(this,"ImageUrlChanged");this.visualId=i?(""+i):null;this.callback=h?h:null;return this};this.release=function f(){this.visualId=null;this.callback=null;c.release.call(this)};return this.init.apply(this,arguments)};b.client.gfx.classes.event.ImageUrlChanged.prototype=new b.client.evt.classes.Event();return b})(tvg);tvg=(function(b){b.client.gfx.classes.event.TextChanged=function a(g,d){var c=arguments.callee.prototype;this.visualId=null;this.callback=null;this.init=function e(i,h){c.init.call(this,"TextChanged");this.visualId=i?(""+i):null;this.callback=h?h:null;return this};this.release=function f(){this.visualId=null;this.callback=null;c.release.call(this)};return this.init.apply(this,arguments)};b.client.gfx.classes.event.TextChanged.prototype=new b.client.evt.classes.Event();return b})(tvg);tvg=(function(b){b.client.gfx.classes.event.TextInputFocused=function a(h,e,d){var c=arguments.callee.prototype;this.visualId=null;this.focus=null;this.callback=null;this.init=function f(k,j,i){c.init.call(this,"TextInputFocused");this.visualId=k?(""+k):null;this.focus=j?(j&&true):false;this.callback=i?i:null;return this};this.release=function g(){this.visualId=null;this.focus=null;this.callback=null;c.release.call(this)};return this.init.apply(this,arguments)};b.client.gfx.classes.event.TextInputFocused.prototype=new b.client.evt.classes.Event();return b})(tvg);tvg=(function(a){a.client.gfx.classes.event.VisualUpdated=function b(g,d){var c=arguments.callee.prototype;this.visualId=null;this.callback=null;this.init=function e(i,h){c.init.call(this,"VisualUpdated");this.visualId=i?(""+i):null;this.callback=h?h:null;return this};this.release=function f(){this.visualId=null;this.callback=null;c.release.call(this)};return this.init.apply(this,arguments)};a.client.gfx.classes.event.VisualUpdated.prototype=new a.client.evt.classes.Event();return a})(tvg);tvg=(function(b){b.client.gfx.classes.Driver=function a(r){var c=arguments.callee.prototype;this.type=null;this.screenSize=null;this.devicePixelRatio=null;this.eventHandlers=null;this.init=function n(v){this.type=v?""+v:"";this.devicePixelRatio=(window.devicePixelRatio||1);this.screenSize={game:{x:12000,y:16000},physical:{x:null,y:null},scale:{x:null,y:null},browser:{x:null,y:null},translate:{x:null,y:null}};var x=window,s=document,t=s.documentElement,u=s.getElementsByTagName("body")[0];this.screenSize.browser.x=x.innerWidth||t.clientWidth||u.clientWidth;this.screenSize.browser.y=x.innerHeight||t.clientHeight||u.clientHeight;this.screenSize.physical.x=(this.screenSize.browser.x*this.devicePixelRatio)|0;this.screenSize.physical.y=(this.screenSize.browser.y*this.devicePixelRatio)|0;this.screenSize.browser.x=this.screenSize.physical.x/this.devicePixelRatio;this.screenSize.browser.y=this.screenSize.physical.y/this.devicePixelRatio;if(this.screenSize.physical.x>this.screenSize.physical.y){if((this.screenSize.physical.y/this.screenSize.game.y)*this.screenSize.game.x>this.screenSize.physical.x){this.screenSize.scale.x=this.screenSize.scale.y=(this.screenSize.game.x/this.screenSize.physical.x)}else{this.screenSize.scale.x=this.screenSize.scale.y=(this.screenSize.game.y/this.screenSize.physical.y)}}else{if((this.screenSize.physical.y/this.screenSize.game.y)*this.screenSize.game.x<this.screenSize.physical.x){this.screenSize.scale.x=this.screenSize.scale.y=(this.screenSize.game.x/this.screenSize.physical.x)}else{this.screenSize.scale.x=this.screenSize.scale.y=(this.screenSize.game.y/this.screenSize.physical.y)}}this.screenSize.translate.x=((((this.screenSize.game.x/this.screenSize.scale.x)|0)-this.screenSize.physical.x)/2)|0;this.screenSize.translate.y=((((this.screenSize.game.y/this.screenSize.scale.y)|0)-this.screenSize.physical.y)/2)|0;this.eventHandlers=[];return this};this.release=function q(){this.type=null;this.screenSize=null;this.devicePixelRatio=null;this.eventHandlers=null};this.processEvents=function o(v){var s=null;for(var u=0;u<b.client.gfx.Events.length;u++){s=b.client.gfx.Events.get(u);var t=this.eventHandlers[s.type];if(t){if(t.call(this,v,s)){continue}}b.client.gfx.Events.remove(u--);s.release()}};this.getPhysicalX=function h(s){return(s/this.screenSize.scale.x)|0};this.getPhysicalY=function i(s){return(0.5+s/this.screenSize.scale.y)|0};this.getTranslatedPhysicalX=function l(s){return((0.5+s/this.screenSize.scale.x)|0)-this.screenSize.translate.x};this.getTranslatedPhysicalY=function m(s){return((0.5+s/this.screenSize.scale.y)|0)-this.screenSize.translate.y};this.getBrowserX=function d(s){return((0.5+s/this.screenSize.scale.x)|0)/this.devicePixelRatio};this.getBrowserY=function e(s){return((0.5+s/this.screenSize.scale.y)|0)/this.devicePixelRatio};this.getTranslatedBrowserX=function j(s){return(((0.5+s/this.screenSize.scale.x)|0)-this.screenSize.translate.x)/this.devicePixelRatio};this.getTranslatedBrowserY=function k(s){return(((0.5+s/this.screenSize.scale.y)|0)-this.screenSize.translate.y)/this.devicePixelRatio};this.getGameX=function f(s){return(((0.5+s*this.devicePixelRatio)|0)+this.screenSize.translate.x)*this.screenSize.scale.x};this.getGameY=function g(s){return(((0.5+s*this.devicePixelRatio)|0)+this.screenSize.translate.y)*this.screenSize.scale.y};return this.init.apply(this,arguments)};return b})(tvg);tvg=(function(b){b.client.gfx.classes.CssDriver=function a(){var c=arguments.callee.prototype;var i={};i.visualData={};i.visualDataInitializers=[];i.visualDataRenderers=[];i.launchFullscreen=function(x){if(x.requestFullscreen){x.requestFullscreen()}else{if(x.mozRequestFullScreen){x.mozRequestFullScreen()}else{if(x.webkitRequestFullscreen){x.webkitRequestFullscreen()}else{if(x.msRequestFullscreen){x.msRequestFullscreen()}}}}};i.exitFullscreen=function(){if(document.exitFullscreen){document.exitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}}}}};i.lockOrientation=function(x){var y="orientation" in screen?"":"mozOrientation" in screen?"moz":"msOrientation" in screen?"ms":null;if(!y){return}i.launchFullscreen(document.documentElement);setTimeout(function(){screen[y+(y===""?"l":"L")+"ockOrientation"](x)},1)};i.unlockOrientation=function(){var x="orientation" in screen?"":"mozOrientation" in screen?"moz":"msOrientation" in screen?"ms":null;if(!x){return}i.exitFullscreen();screen[x+(x===""?"u":"U")+"nlockOrientation"]()};this.init=function e(){c.init.call(this,"CssDriver");i.lockOrientation("portrait");this.eventHandlers.VisualLoaded=i.VisualLoadedHandler;this.eventHandlers.VisualUnloaded=i.VisualUnloadedHandler;this.eventHandlers.VisualShown=i.VisualShownHandler;this.eventHandlers.VisualUpdated=i.VisualUpdatedHandler;this.eventHandlers.VisualHidden=i.VisualHiddenHandler;this.eventHandlers.ImageUrlChanged=i.ImageUrlChangedHandler;this.eventHandlers.TextChanged=i.TextChangedHandler;this.eventHandlers.TextInputFocused=i.TextInputFocusedHandler;document.body.style.overflow="hidden";document.body.style.margin="0px";document.body.style.padding="0px";i.visibleTop=this.getGameY(0);i.visibleRight=this.getGameX(this.screenSize.browser.x);i.visibleBottom=this.getGameY(this.screenSize.browser.y);i.visibleLeft=this.getGameX(0);return this};this.release=function k(){i=null;c.release.call(this)};i.visualDataInitializers.Layer=function f(y,x){y.current={visible:undefined,x:-999999,y:-999999,width:-999999,height:-999999};if(x){x.call(y.visual)}return y};i.initSprite=function g(z,x){z.current={visible:undefined,x:-999999,y:-999999,width:-999999,height:-999999,frame:-999999};z.canvas=document.createElement("canvas");z.canvas.width=this.getPhysicalX(z.visual.width);z.canvas.height=this.getPhysicalY(z.visual.height);z.element=z.canvas;z.element.id=z.visual.id;z.element.style.cssText="display:none";z.element.alt=z.visual.comment?""+z.visual.comment:null;if(z.visual.imageUrl){z.imageElement=document.createElement("img");z.imageElement.onload=function y(){if(z.imageElement.width<z.canvas.width){z.canvas.width=z.imageElement.width;z.canvas.height=z.imageElement.height}i.updateSprite.call(b.client.gfx.Driver.current,z);if(x){x.call(z.visual)}};if(z.visual.imageUrl.substr(0,11)=="data:image/"){z.imageElement.src=z.visual.imageUrl;z.srcSet=true}else{z.imageElement.src="./img/"+z.visual.imageUrl;z.srcSet=true}}else{i.updateSprite.call(b.client.gfx.Driver.current,z);if(x){x.call(z.visual)}}document.body.appendChild(z.element);return z};i.measureText=function(y,z){var A=0;for(var x=0;x<z.length;x++){A+=y.measureText(z[x]).width*1}return A};i.fillText=function(A,B,C,D){for(var z=0;z<B.length;z++){A.fillText(B[z],C,D);C+=A.measureText(B[z]).width*1}};i.measureFontHeight=function j(y){var x=document.createElement("div");var B=document.createElement("span");B.style.cssText="font: "+y;var A=document.createElement("div");A.style.cssText="display: inline-block; width: 1px; height: 0px; vertical-align: bottom";x.appendChild(B);x.appendChild(A);document.body.appendChild(x);var z=A.offsetTop-B.offsetTop;document.body.removeChild(x);return z};i.updateSprite=function r(H){var E=H.canvas.getContext("2d",{alpha:H.visual.alpha});E.imageSmoothingEnabled=false;if(H.imageElement){E.drawImage(H.imageElement,0,0,H.imageElement.width,H.imageElement.height,0,0,H.canvas.width,H.canvas.height)}else{E.clearRect(0,0,H.canvas.width,H.canvas.height)}if(H.visual.text!==undefined){var B=1*H.canvas.width/this.getPhysicalX(H.visual.width);var C=1*H.canvas.height/this.getPhysicalY(H.visual.height);E.font=(B*this.getPhysicalX(H.visual.size))+"px "+H.visual.font;E.fillStyle=H.visual.color;E.textBaseline="top";var L=this.getPhysicalY(H.visual.margin);i.lineHeight=i.measureFontHeight((B*this.getPhysicalX(H.visual.size))+"px "+H.visual.font);var K=H.visual.text.replace(/\r\n/g," ~~~newline~~~ ").split(/\s+/);var F="";var D=H.canvas.width-2*B*this.getPhysicalX(H.visual.margin);var z=H.canvas.height-L;var A=0;var x=H.visual.align.split(" ");if((x.length>1?x[1]:"middle")=="middle"){var G=i.lineHeight;for(var I=0;I<K.length;I++){var J=K[I];if(J=="~~~newline~~~"){G+=i.lineHeight;F=""}else{if(F!=""&&i.measureText(E,F+" "+J)>D){G+=i.lineHeight;F=J}else{F+=(F==""?"":" ")+J}}}L=C*this.getPhysicalY(H.visual.margin)+(H.canvas.height-2*C*this.getPhysicalY(H.visual.margin)-G)/2}F="";for(var I=0;I<K.length;I++){var J=K[I];if(J=="~~~newline~~~"||(F!=""&&i.measureText(E,F+" "+J)>D)){if((x.length>0?x[0]:"center")=="center"){i.fillText(E,F,B*this.getPhysicalX(H.visual.margin)+(H.canvas.width-2*B*this.getPhysicalX(H.visual.margin)-i.measureText(E,F))/2,L|0)}else{i.fillText(E,F,B*this.getPhysicalX(H.visual.margin),L|0)}L+=i.lineHeight;F=J=="~~~newline~~~"?"":J}else{F+=(F==""?"":" ")+J}if(L>z){break}}if(L<=z){if((x.length>0?x[0]:"center")=="center"){i.fillText(E,F,B*this.getPhysicalX(H.visual.margin)+(H.canvas.width-2*B*this.getPhysicalX(H.visual.margin)-i.measureText(E,F))/2,L|0)}else{i.fillText(E,F,B*this.getPhysicalX(H.visual.margin),L|0)}}}H.srcSet=true;i.renderSprite.call(b.client.gfx.Driver.current,H)};i.visualDataInitializers.Sprite=i.initSprite;i.visualDataInitializers.SpriteText=i.initSprite;i.visualDataInitializers.Text=i.initSprite;i.visualDataInitializers.TextInput=function h(A,x){A.current={visible:undefined,x:-999999,y:-999999,width:-999999,height:-999999,font:undefined,color:undefined,size:-999999,align:undefined,alignH:undefined,alignV:undefined};A.element=document.createElement("input");A.element.type="text";A.element.value=A.visual.text;A.element.id=A.visual.id;A.element.style.cssText="display:none";A.element.onkeyup=function z(){A.visual.text=A.element.value};A.element.onchange=function y(){A.visual.text=A.element.value};document.body.appendChild(A.element);if(x){x.call(A.visual)}return A};i.visualDataRenderers.Layer=function l(y){y.current.visible=y.visual.visible;var x=y.visual.parent;while(x){y.current.visible&=x.visible;x=x.parent}y.current.x=this.getTranslatedBrowserX(y.visual.x);y.current.y=this.getTranslatedBrowserY(y.visual.y);y.current.width=this.getTranslatedBrowserX(y.visual.x+y.visual.width)-y.current.x;y.current.height=this.getTranslatedBrowserY(y.visual.y+y.visual.height)-y.current.y};i.renderSprite=function m(A){A.current.visible=A.visual.visible;var z=A.visual.parent;while(z&&A.current.visible){A.current.visible&=z.visible;z=z.parent}A.current.x=this.getTranslatedBrowserX(A.visual.x);A.current.y=this.getTranslatedBrowserY(A.visual.y);A.current.width=this.getTranslatedBrowserX(A.visual.x+A.visual.width)-A.current.x;A.current.height=this.getTranslatedBrowserY(A.visual.y+A.visual.height)-A.current.y;A.current.frame=A.visual.frame|0;if(!A.srcSet||!A.current.visible){A.element.style.cssText="display:none";return}var x={top:0,right:((A.current.frame+1)*A.current.width),bottom:A.current.height,left:A.current.frame*A.current.width,parent:{top:i.visibleTop,right:i.visibleRight,bottom:i.visibleBottom,left:i.visibleLeft}};z=A.visual.parent;while(z){if(z.x>x.left){x.parent.left=z.x}if(z.y>x.parent.top){x.parent.top=z.y}if(z.x+z.width<x.parent.right){x.parent.right=z.x+z.width}if(z.y+z.height<x.parent.bottom){x.parent.bottom=z.y+z.height}z=z.parent}var y=(A.visual.frames===undefined?1:A.visual.frames)>1;if(A.visual.x<x.parent.left){x.left+=this.getBrowserX(x.parent.left-A.visual.x);y=true}if(A.visual.x+A.visual.width>x.parent.right){x.right-=this.getBrowserX(A.visual.x+A.visual.width-x.parent.right);y=true}if(A.visual.y<x.parent.top){x.top+=this.getBrowserY(x.parent.top-A.visual.y);y=true}if(A.visual.y+A.visual.height>x.parent.bottom){x.bottom-=this.getBrowserY(A.visual.y+A.visual.height-x.parent.bottom);y=true}if(!y){var B=""+(A.current.x-A.current.frame*A.current.width)+"px,"+A.current.y+"px";A.element.style.cssText="position:fixed;z-index:"+A.depth+";transform:translate3d("+B+",0);-webkit-transform:translate3d("+B+",0);-ms-transform:translate("+B+");width:"+A.current.width+"px;height:"+A.current.height+"px"}else{if(x.right-x.left<1||x.bottom-x.top<1){A.element.style.cssText="display:none"}else{var B=""+(A.current.x-A.current.frame*A.current.width)+"px,"+A.current.y+"px";A.element.style.cssText="position:fixed;z-index:"+A.depth+";transform:translate3d("+B+",0);-webkit-transform:translate3d("+B+",0);-ms-transform:translate("+B+");width:"+((A.visual.frames===undefined?1:A.visual.frames)*A.current.width)+"px;height:"+A.current.height+"px;clip:rect("+(1*x.top)+"px,"+(1*x.right)+"px,"+(1*x.bottom)+"px,"+(1*x.left)+"px)"}}};i.visualDataRenderers.Sprite=i.renderSprite;i.visualDataRenderers.SpriteText=i.renderSprite;i.visualDataRenderers.Text=i.renderSprite;i.visualDataRenderers.TextInput=function n(C){C.current.visible=C.visual.visible;var z=C.visual.parent;while(z){C.current.visible&=z.visible;z=z.parent}C.current.x=this.getTranslatedBrowserX(C.visual.x);C.current.y=this.getTranslatedBrowserY(C.visual.y);C.current.width=this.getTranslatedBrowserX(C.visual.x+C.visual.width)-C.current.x;C.current.height=this.getTranslatedBrowserY(C.visual.y+C.visual.height)-C.current.y;C.current.font=C.visual.font;C.current.color=C.visual.color;C.current.size=this.getBrowserY(C.visual.size);if(C.current.align!=C.visual.align){var x=C.visual.align.split(" ");C.current.align=C.visual.align;C.current.alignH=x.length>0?x[0]:"center";C.current.alignV=x.length>1?x[1]:"middle"}if(!C.current.visible){C.element.style.cssText="display:none";return}var A=0;switch(C.current.alignV){case"top":break;case"middle":default:A+=this.getBrowserY((C.visual.height-C.visual.size)/2);break;case"bottom":A+=this.getBrowserY(C.visual.height-C.visual.size);break}if(C.visual.parent){var y={top:0,right:C.current.width,bottom:C.current.height,left:0,needed:false,parent:{top:i.visibleTop,right:i.visibleRight,bottom:i.visibleBottom,left:i.visibleLeft}};var B=C.visual;while(B){if(B.parent){if(B.parent.x>y.parent.left){y.parent.left=B.parent.x}if(B.parent.y>y.parent.top){y.parent.top=B.parent.y}if(B.parent.x+B.parent.width<y.parent.right){y.parent.right=B.parent.x+B.parent.width}if(B.parent.y+B.parent.height<y.parent.bottom){y.parent.bottom=B.parent.y+B.parent.height}}B=B.parent}if(C.visual.x<y.parent.left){y.left+=this.getBrowserX(y.parent.left-C.visual.x);y.needed=true}if(C.visual.x+C.visual.width>y.parent.right){y.right-=this.getBrowserX(C.visual.x+C.visual.width-y.parent.right);y.needed=true}if(C.visual.y<y.parent.top){y.top+=this.getBrowserY(y.parent.top-C.visual.y);y.needed=true}if(C.visual.y+C.visual.height>y.parent.bottom){y.bottom-=this.getBrowserY(C.visual.y+C.visual.height-y.parent.bottom);y.needed=true}if(!y.needed){var D=""+C.current.x+"px,"+C.current.y+"px";C.element.style.cssText="position:fixed; outline:none;z-index:"+C.depth+";transform:translate3d("+D+",0);-webkit-transform:translate3d("+D+",0);-ms-transform:translate("+D+");width:"+C.current.width+"px;height:"+C.current.height+"px;"+(A?"padding-top:"+A+"px;":"")+"font-family:"+C.current.font+";font-size:"+C.current.size+"px;color:"+C.current.color+";background:none;border:none;text-align:"+C.current.alignH+";vertical-align:"+C.current.alignV}else{if(y.right-y.left<1||y.bottom-y.top<1){C.element.style.cssText="display:none"}else{var D=""+C.current.x+"px,"+C.current.y+"px";C.element.style.cssText="position:fixed; outline:none;z-index:"+C.depth+";transform:translate3d("+D+",0);-webkit-transform:translate3d("+D+",0);-ms-transform:translate("+D+");width:"+C.current.width+"px;height:"+C.current.height+"px;"+(A?"padding-top:"+A+"px;":"")+"font-family:"+C.current.font+";font-size:"+C.current.size+"px;color:"+C.current.color+";background:none;border:none;text-align:"+C.current.alignH+";vertical-align:"+C.current.alignV+";clip:rect("+(y.top|0)+"px,"+(y.right|0)+"px,"+(y.bottom|0)+"px,"+(y.left|0)+"px)"}}}};i.VisualLoadedHandler=function t(y,x){b.game.log.debug("processing "+x.type+"("+x.visual.id+")");if(x.visual&&x.visual.id){i.visualData[x.visual.id]=i.visualDataInitializers[x.visual.type].call(this,{visual:x.visual,depth:x.visual.parent&&i.visualData[x.visual.parent.id]?i.visualData[x.visual.parent.id].depth+100:0,element:null},x.callback)}};i.VisualUnloadedHandler=function v(z,y){var A=i.visualData[y.visual.id];if(!A||!A.visual.loaded){return true}if(A.visual.children){for(var x in A.visual.children){if(!A.visual.children[x].loaded){return true}}}if(A.element){document.body.removeChild(A.element);if(A.srcSet){A.srcSet=false}if(A.canvas){A.canvas=null}if(A.imageElement){A.imageElement=null}A.element=null}i.visualData[y.visual.id]=null;delete i.visualData[y.visual.id];if(y.callback){y.callback.call(y.visual)}};i.VisualShownHandler=function u(A,y){var B=i.visualData[y.visualId];if(!B||!B.visual.loaded){return true}if(B.visual.children){for(var x in B.visual.children){if(!B.visual.children[x].loaded){return true}}}B.visual.visible=true;for(var x in B.visual.children){B.visual.children[x].update()}var z=i.visualDataRenderers[B.visual.type];if(z){z.call(this,B)}if(y.callback){y.callback.call(y)}};i.VisualUpdatedHandler=function w(A,y){var B=i.visualData[y.visualId];if(!B||!B.visual.loaded){return true}if(B.visual.children){for(var x in B.visual.children){if(!B.visual.children[x].loaded){return true}}}var z=i.visualDataRenderers[B.visual.type];if(z){z.call(this,B)}if(y.callback){y.callback.call(y)}};i.VisualHiddenHandler=function s(z,y){var A=i.visualData[y.visualId];if(!A){return true}A.visual.visible=false;for(var x in A.visual.children){A.visual.children[x].update()}if(A.element){A.element.style.cssText="display:none"}if(y.callback){y.callback.call(y)}};i.ImageUrlChangedHandler=function d(A,y){var B=i.visualData[y.visualId];if(!B||!B.visual.loaded){return true}if(B.visual.children){for(var x in B.visual.children){if(!B.visual.children[x].loaded){return true}}}if(B.visual&&B.visual.imageUrl&&B.imageElement){B.imageElement.onload=function z(){i.updateSprite(B)};if(B.visual.imageUrl.substr(0,11)=="data:image/"){B.imageElement.src=B.visual.imageUrl}else{B.imageElement.src="./img/"+B.visual.imageUrl}}if(y.callback){y.callback.call(y)}};i.TextChangedHandler=function o(z,y){var A=i.visualData[y.visualId];if(!A||!A.visual.loaded){return true}if(A.visual.children){for(var x in A.visual.children){if(!A.visual.children[x].loaded){return true}}}if(A.canvas){i.updateSprite.call(b.client.gfx.Driver.current,A)}else{A.element.value=A.visual.text}if(y.callback){y.callback.call(y)}};i.TextInputFocusedHandler=function q(y,x){var z=i.visualData[x.visualId];if(!z){return true}if(z.element){if(x.focus){z.element.focus()}else{z.element.blur()}}if(x.callback){x.callback.call(x)}};return this.init.apply(this,arguments)};b.client.gfx.classes.CssDriver.prototype=new b.client.gfx.classes.Driver();return b})(tvg);tvg=(function(a){a.client.gfx.classes.Visual=function b(m,j,r,s,q,e){var c=arguments.callee.prototype;var h={};this.type=null;this.name=null;this.id=null;this.x=null;this.y=null;this.width=null;this.height=null;this.eventHandlers=null;this.parent=null;this.visible=null;this.alpha=null;this.loaded=null;this.init=function g(v,u,z,A,w,t){this.type=v?(""+v):null;this.name=u?(""+u):null;this.id=(v||u)?(""+v+"_"+u):null;this.x=z|0;this.y=A|0;this.width=w?(w|0):null;this.height=t?(t|0):null;this.eventHandlers=[];this.visible=false;this.alpha=true;this.loaded=false;if(this.name!==undefined){a.client.gfx.Events.add(new a.client.gfx.classes.event.VisualLoaded(this,h.loaded))}else{h.loaded.call(this)}return this};this.release=function k(){if(this.name!==undefined){a.client.gfx.Events.add(new a.client.gfx.classes.event.VisualUnloaded(this,h.unloaded))}else{h.unloaded.call(this)}};h.loaded=function i(){this.loaded=true};h.unloaded=function n(){this.type=null;this.name=null;this.id=null;this.x=null;this.y=null;this.width=null;this.height=null;this.eventHandlers=null;this.parent=null;this.visible=null;this.alpha=null;this.loaded=null};this.show=function l(t){if(!this.visible){a.client.gfx.Events.add(a.client.gfx.classes.Visual.VisualShownPool.get(this.id,t))}return this};this.hide=function f(){if(this.visible){a.client.gfx.Events.add(a.client.gfx.classes.Visual.VisualHiddenPool.get(this.id))}return this};this.handle=function d(v,t){if(this.eventHandlers[t.type]){var u=this.eventHandlers[t.type].call(this,v,t);return u===undefined|u}return false};this.update=function o(){a.client.gfx.Events.add(a.client.gfx.classes.Visual.VisualUpdatedPool.get(this.id))};return this.init.apply(this,arguments)};a.client.gfx.classes.Visual.VisualShownPool=new a.client.evt.classes.EventPool(a.client.gfx.classes.event.VisualShown,20);a.client.gfx.classes.Visual.VisualHiddenPool=new a.client.evt.classes.EventPool(a.client.gfx.classes.event.VisualHidden,20);a.client.gfx.classes.Visual.VisualUpdatedPool=new a.client.evt.classes.EventPool(a.client.gfx.classes.event.VisualUpdated,20);return a})(tvg);tvg=(function(b){b.client.gfx.classes.Layer=function a(h,l,m,k,f){var d=arguments.callee.prototype;this.children=null;this.init=function g(o,r,s,q,n){d.init.call(this,"Layer",o,r,s,q,n);this.children={};return this};this.release=function i(){for(id in this.children){var n=this.children[id];this.removeChild(id);n.release.call(n)}this.children=null;d.release.call(this)};this.addChild=function c(n){if(this.children[n.id]!=null){this.children[n.id].release.call(this.children[n.id]);this.removeChild(n.id)}this.children[n.id]=n;n.parent=this;return this};this.removeChild=function j(o){var n=this.children[o];if(n!=null){n.parent=null;this.children[o]=null;delete this.children[o]}return n};this.handle=function e(t,o){var s=null;var r=Object.keys(this.children);for(var q=r.length-1;q>=0;q--){var n=this.children[r[q]];if(!n){continue}if(o.x!==undefined&&o.y!==undefined){if(n.visible){if(o.x>=n.x&&o.x<=n.x+n.width&&o.y>=n.y&&o.y<=n.y+n.height){if(s=n.handle(t,o)){return s}}else{if(o.startX!==undefined&&o.startX>=n.x&&o.startX<=n.x+n.width&&o.startY>=n.y&&o.startY<=n.y+n.height){if(s=n.handle(t,o)){return s}}}}else{continue}}else{if(s=n.handle(t,o)){return s}}}return d.handle.call(this,t,o)};return this.init.apply(this,arguments)};b.client.gfx.classes.Layer.prototype=new b.client.gfx.classes.Visual();return b})(tvg);tvg=(function(b){b.client.gfx.classes.Sprite=function a(h,l,m,k,e,f,d){var c=arguments.callee.prototype;this.imageUrl=null;this.frames=null;this.frame=null;this.comment=null;this.init=function g(r,t,u,s,o,q,n){c.init.call(this,"Sprite",r,t,u,s,o);this.imageUrl=q?(""+q):null;this.frames=n?(n|0):1;this.frame=0;this.comment=null;return this};this.release=function i(){this.imageUrl=null;this.frames=null;this.frame=null;this.comment=null;c.release.call(this)};this.setImage=function j(o,n){if(n){this.frames=n|0}else{this.frames=1}if(o&&(this.imageUrl!=""+o)){this.imageUrl=""+o;b.client.gfx.Events.add(new b.client.gfx.classes.event.ImageUrlChanged(this.id))}return this};return this.init.apply(this,arguments)};b.client.gfx.classes.Sprite.prototype=new b.client.gfx.classes.Visual();return b})(tvg);tvg=(function(b){b.client.gfx.classes.SpriteText=function a(l,t,u,s,h,i,g,r,f,e,q,c,k){var d=arguments.callee.prototype;this.imageUrl=null;this.frames=null;this.frame=null;this.comment=null;this.text=null;this.font=null;this.color=null;this.size=null;this.align=null;this.margin=null;this.init=function j(E,I,J,H,B,C,A,G,z,w,F,v,D){d.init.call(this,"SpriteText",E,I,J,H,B,C,A);this.imageUrl=C?(""+C):null;this.frames=A?(A|0):1;this.frame=0;this.comment=null;this.text=G?(""+G):"";this.font=z?(""+z):b.client.gfx.classes.Text.defaultFont;this.color=w?(""+w):b.client.gfx.classes.Text.defaultColor;this.size=F?(F|0):b.client.gfx.classes.Text.defaultSize;this.align=v?(""+v):b.client.gfx.classes.Text.defaultAlign;this.margin=D?(D|0):b.client.gfx.classes.Text.defaultMargin;return this};this.release=function m(){this.imageUrl=null;this.frames=null;this.frame=null;this.comment=null;this.text=null;this.font=null;this.color=null;this.size=null;this.align=null;this.margin=null;d.release.call(this)};this.setImage=function n(w,v){if(v){this.frames=v|0}else{this.frames=1}if(w&&(this.imageUrl!=""+w)){this.imageUrl=""+w;b.client.gfx.Events.add(new b.client.gfx.classes.event.ImageUrlChanged(this.id))}return this};this.setText=function o(w){var v=this.text;if(w){this.text=""+w}else{this.text=""}if(v!=this.text){b.client.gfx.Events.add(new b.client.gfx.classes.event.TextChanged(this.id))}return this};return this.init.apply(this,arguments)};b.client.gfx.classes.SpriteText.prototype=new b.client.gfx.classes.Visual();return b})(tvg);tvg=(function(b){b.client.gfx.classes.Text=function a(k,z,A,w,h,v,g,f,u,c,d,j){var e=arguments.callee.prototype;this.text=null;this.font=null;this.color=null;this.background=null;this.size=null;this.align=null;this.margin=null;this.init=function i(H,L,M,K,F,J,E,D,I,B,C,G){e.init.call(this,"Text",H,L,M,K,F);this.text=J?(""+J):null;this.font=E?(""+E):b.client.gfx.classes.Text.defaultFont;this.color=D?(""+D):b.client.gfx.classes.Text.defaultColor;this.size=I?(I|0):b.client.gfx.classes.Text.defaultSize;this.align=B?(""+B):b.client.gfx.classes.Text.defaultAlign;this.background=C?(""+C):null;this.margin=G?(G|0):b.client.gfx.classes.Text.defaultMargin;return this};this.release=function l(){this.text=null;this.font=null;this.color=null;this.size=null;this.align=null;this.background=null;e.release.call(this)};this.setText=function t(y){var x=this.text;if(y){this.text=""+y}else{this.text=""}if(x!=this.text){b.client.gfx.Events.add(new b.client.gfx.classes.event.TextChanged(this.id))}return this};this.setFont=function q(x){if(x){this.font=""+x}else{this.font=b.client.gfx.classes.Text.defaultFont}this.update();return this};this.setColor=function o(x){if(x){this.color=""+x}else{this.color=b.client.gfx.classes.Text.defaultColor}this.update();return this};this.setBackground=function n(x){if(x){this.background=""+x}else{this.background=null}this.update();return this};this.setMargin=function r(x){if(x){this.margin=x|0}else{this.margin=b.client.gfx.classes.Text.defaultMargin}this.update();return this};this.setSize=function s(x){if(x){this.size=x|0}else{this.size=b.client.gfx.classes.Text.defaultSize}this.update();return this};this.setAlign=function m(x){if(x){this.align=x|0}else{this.align=b.client.gfx.classes.Text.defaultAlign}this.update();return this};return this.init.apply(this,arguments)};b.client.gfx.classes.Text.prototype=new b.client.gfx.classes.Visual();b.client.gfx.classes.Text.defaultFont="Arial, Sans-Serif";b.client.gfx.classes.Text.defaultColor="#000";b.client.gfx.classes.Text.defaultSize=1000;b.client.gfx.classes.Text.defaultAlign="center middle";b.client.gfx.classes.Text.defaultMargin=0;return b})(tvg);tvg=(function(b){b.client.gfx.classes.TextInput=function a(h,t,u,s,f,r,e,q,c){var d=arguments.callee.prototype;this.text=null;this.font=null;this.color=null;this.size=null;this.align=null;this.init=function g(B,F,G,E,A,D,z,w,C,v){d.init.call(this,"TextInput",B,F,G,E,A);this.text=D?(""+D):null;this.font=z?(""+z):b.client.gfx.classes.TextInput.defaultFont;this.color=w?(""+w):b.client.gfx.classes.TextInput.defaultColor;this.size=C?(C|0):b.client.gfx.classes.TextInput.defaultSize;this.align=v?(""+v):b.client.gfx.classes.TextInput.defaultAlign;return this};this.release=function i(){this.text=null;this.font=null;this.color=null;this.size=null;this.align=null;d.release.call(this)};this.setText=function o(w){var v=this.text;if(w){this.text=""+w}else{this.text=""}if(v!=this.text){b.client.gfx.Events.add(new b.client.gfx.classes.event.TextChanged(this.id))}return this};this.setFont=function m(v){if(v){this.font=""+v}else{this.font=b.client.gfx.classes.TextInput.defaultFont}this.update();return this};this.setColor=function k(v){if(v){this.color=""+v}else{this.color=b.client.gfx.classes.TextInput.defaultColor}this.update();return this};this.setSize=function n(v){if(v){this.size=v|0}else{this.size=b.client.gfx.classes.TextInput.defaultSize}this.update();return this};this.setAlign=function j(v){if(v){this.align=v|0}else{this.align=b.client.gfx.classes.TextInput.defaultAlign}this.update();return this};this.setFocus=function l(v){b.client.gfx.Events.add(new b.client.gfx.classes.event.TextInputFocused(this.id,v));return this};return this.init.apply(this,arguments)};b.client.gfx.classes.TextInput.prototype=new b.client.gfx.classes.Visual();b.client.gfx.classes.TextInput.defaultFont="Arial, Sans-Serif";b.client.gfx.classes.TextInput.defaultColor="#000";b.client.gfx.classes.TextInput.defaultSize=1000;b.client.gfx.classes.TextInput.defaultAlign="center middle";return b})(tvg);tvg=(function(b){b.client.gfx.classes.Screen=function a(e){var c=arguments.callee.prototype;this.init=function d(i){c.init.call(this,i,0,0,12000,16000);return this};this.stop=function g(){};this.processInputEvent=function f(j,i){return this.handle.call(this,j,i)};this.tick=function h(i){};return this.init.apply(this,arguments)};b.client.gfx.classes.Screen.prototype=new b.client.gfx.classes.Layer();return b})(tvg);tvg=(function(b){b.client.gfx.classes.List=function a(i,s,t,r,e,h){var d=arguments.callee.prototype;this.offset=null;var g={};g.items=null;g.offsetStart=null;this.init=function f(w,A,B,z,u,v){d.init.call(this,w,A,B,z,u);this.offset=0;this.margin=v|0;g.items=[];g.offsetStart=this.offset;this.eventHandlers.PointerClick=this.onClick;this.eventHandlers.PointerDown=this.onDown;this.eventHandlers.PointerDrag=this.onDrag;this.eventHandlers.PointerUp=this.onUp;return this};this.release=function n(){this.offset=null;g=null;d.release.call(this)};this.addItem=function c(v,u){v.y=g.items.length?this.margin+g.items[g.items.length-1].visual.y+g.items[g.items.length-1].visual.height:this.y+this.offset;v.show();v.update();g.items.push({visual:v,clickHandler:u});return this.addChild(v)};this.removeItem=function o(w){var u=false;for(var v=0;v<g.items.length;v++){var x=g.items[v].visual;if(x.id==w){u=true;g.items.splice(v--,1);continue}if(u){x.visual.y=(v==0)?this.y+this.offset:this.margin+g.items[v-1].visual.y+g.items[v-1].visual.height;x.visual.update()}}return this.removeChild(w)};this.update=function q(){if(g.items.length&&(this.y+this.offset!=g.items[0].y)){var v=this.y+this.offset;for(var u=0;u<g.items.length;u++){g.items[u].visual.y=v;g.items[u].visual.update.call(g.items[u].visual);v+=this.margin+g.items[u].visual.height}}d.update.call(this)};this.onClick=function j(w,u){for(var v=0;v<g.items.length;v++){var x=g.items[v].visual;if(x.y<=u.y&&x.y+x.height>=u.y&&g.items[v].clickHandler){new b.client.gfx.classes.Animation(x,"y",x.y+250,150,b.client.gfx.classes.Animation.animationFunction.bounce,g.items[v].clickHandler);return true}}return false};this.onDown=function k(v,u){g.offsetStart=this.offset};this.onDrag=function l(v,u){this.offset=g.offsetStart+(u.y-u.startY);this.update()};this.onUp=function m(x,u){var w=32000;for(var v=0;v<g.items.length;v++){if(Math.abs(w)>Math.abs(this.y-g.items[v].visual.y)){w=this.y-g.items[v].visual.y}}new b.client.gfx.classes.Animation(this,"offset",this.offset+w,150,b.client.gfx.classes.Animation.animationFunction.easeIn)};return this.init.apply(this,arguments)};b.client.gfx.classes.List.prototype=new b.client.gfx.classes.Layer();return b})(tvg);tvg=(function(g){g.client.gfx.classes.Animation=function b(u,n,t,k,h,j){var i=arguments.callee.prototype;this.visual=null;this.propertyName=null;this.value=null;this.duration=null;var m={};m.startTime=null;m.endTime=null;m.startValue=null;m.animationFunction=null;m.callback=null;this.init=function l(C,A,B,x,v,w){this.visual=C;this.propertyName=A?(""+A):null;this.value=B|0;this.duration=x|0;m.animationFunction=v?v:g.client.gfx.classes.Animation.animationFunction.linear;m.callback=w?w:null;for(var z=0;z<g.client.gfx.classes.Animation.currentAnimations.length;z++){var y=g.client.gfx.classes.Animation.currentAnimations[z];if(y.visual.id==this.visual.id&&y.propertyName==this.propertyName){y.toEnd();m.startValue=this.visual[this.propertyName];g.client.gfx.classes.Animation.currentAnimations[z]=this;y.stop();return this}}m.startValue=this.visual[this.propertyName];g.client.gfx.classes.Animation.currentAnimations.push(this);return this};this.release=function o(){this.visual=null;this.propertyName=null;this.value=null;this.duration=null;m=null};this.toEnd=function s(){this.visual[this.propertyName]=m.startValue+m.animationFunction((this.value-m.startValue),(m.endTime-m.startTime)/this.duration);this.visual.update()};this.stop=function q(){this.visual[this.propertyName]=m.startValue+m.animationFunction((this.value-m.startValue),(m.endTime-m.startTime)/this.duration);if(this.visual.id){this.visual.update()}var w=this.visual;var v=m.callback;this.release();if(v){v.call(w)}};this.tick=function r(v){if(m.startTime==null){m.startTime=v|0;m.endTime=m.startTime+this.duration}else{if((v|0)>=m.endTime){return false}}if(!this.visual.id){return false}this.visual[this.propertyName]=m.startValue+m.animationFunction((this.value-m.startValue),(v-m.startTime)/this.duration);this.visual.update();return true};return this.init.apply(this,arguments)};g.client.gfx.classes.Animation.currentAnimations=[];g.client.gfx.classes.Animation.animate=function a(k){for(var j=0;j<g.client.gfx.classes.Animation.currentAnimations.length;j++){var h=g.client.gfx.classes.Animation.currentAnimations[j];if(!h.tick(k)){g.client.gfx.classes.Animation.currentAnimations.splice(j--,1);h.stop()}}};g.client.gfx.classes.Animation.animationFunction={linear:function f(i,h){return i*h},easeIn:function d(i,h){return i*(1-Math.pow(1-h,4))},easeOut:function e(i,h){return i*Math.pow(h,4)},bounce:function c(i,h){return Math.cos(h*Math.PI-Math.PI/2)*i}};return g})(tvg);tvg=(function(b){function a(){this.current=null;this.init=function d(){this.current=null};this.release=function f(){this.current.release();this.current=null};this.load=function e(g){if(this.current){this.current.release();this.current=null}b.game.log.information("Loading gfx driver "+g.type+".");return this.current=g};this.get=function c(){return this.current};return this.init.apply(this,arguments)}b.client.gfx.Driver=new a();return b})(tvg);tvg=(function(a){a.client.gfx.Screen=new a.client.gfx.classes.Screen("main");a.client.gfx.Screen.show();return a})(tvg);tvg=(function(a){a.client.sfx.Events=new a.client.evt.classes.Queue("sfx");return a})(tvg);tvg=(function(b){b.client.sfx.classes.event.SampleLoaded=function a(g,d){var c=arguments.callee.prototype;this.sample=null;this.callback=null;this.init=function e(i,h){c.init.call(this,"SampleLoaded");this.sample=i?i:null;this.callback=h?h:null;return this};this.release=function f(){this.sample=null;this.callback=null;c.release.call(this)};return this.init.apply(this,arguments)};b.client.sfx.classes.event.SampleLoaded.prototype=new b.client.evt.classes.Event();return b})(tvg);tvg=(function(b){b.client.sfx.classes.event.SamplePlayed=function a(g,d){var c=arguments.callee.prototype;this.sampleId=null;this.callback=null;this.init=function e(i,h){c.init.call(this,"SamplePlayed");this.sampleId=i?(""+i):null;this.callback=h?h:null;return this};this.release=function f(){this.sampleId=null;this.callback=null;c.release.call(this)};return this.init.apply(this,arguments)};b.client.sfx.classes.event.SamplePlayed.prototype=new b.client.evt.classes.Event();return b})(tvg);tvg=(function(b){b.client.gfx.classes.event.SampleUnloaded=function a(g,d){var c=arguments.callee.prototype;this.sampleId=null;this.callback=null;this.init=function e(i,h){c.init.call(this,"SampleUnloaded");this.sampleId=i?(""+i):null;this.callback=h?h:null;return this};this.release=function f(){this.sampleId=null;this.callback=null;c.release.call(this)};return this.init.apply(this,arguments)};b.client.gfx.classes.event.SampleUnloaded.prototype=new b.client.evt.classes.Event();return b})(tvg);tvg=(function(a){a.client.sfx.classes.event.VolumeChanged=function b(g,h,d){var c=arguments.callee.prototype;this.sampleId=null;this.volume=null;this.callback=null;this.init=function e(j,k,i){c.init.call(this,"VolumeChanged");this.sampleId=j?(""+j):null;this.volume=k?1*k:null;this.callback=i?i:null;return this};this.release=function f(){this.sampleId=null;this.volume=null;this.callback=null;c.release.call(this)};return this.init.apply(this,arguments)};a.client.sfx.classes.event.VolumeChanged.prototype=new a.client.evt.classes.Event();return a})(tvg);tvg=(function(b){b.client.sfx.classes.Driver=function a(g){var c=arguments.callee.prototype;this.eventHandlers=null;this.type=null;this.init=function d(h){this.type=h?""+h:"";this.eventHandlers=[];return this};this.release=function f(){this.type=null;this.eventHandlers=null};this.processEvents=function e(j){var h=null;while(h=b.client.sfx.Events.remove()){var i=this.eventHandlers[h.type];if(i){i.call(this,j,h)}h.release()}};return this.init.apply(this,arguments)};return b})(tvg);tvg=(function(b){b.client.sfx.classes.DriverHtml5=function a(){var c=arguments.callee.prototype;var f={};f.sampleData=[];f.sampleDataInitializers=[];this.init=function d(){c.init.call(this,"DriverHtml5");this.eventHandlers.SampleLoaded=f.SampleLoadedHandler;this.eventHandlers.SampleUnloaded=f.SampleUnloadedHandler;this.eventHandlers.SamplePlayed=f.SamplePlayedHandler;this.eventHandlers.VolumeChanged=f.VolumeChangedHandler;return this};this.release=function g(){f=null;c.release.call(this)};f.initSample=function e(n,m){var l=document.createElement("audio");l.src="sfx/"+n.sample.sampleUrl+".wav";l.volume=n.sample.volume;l.preload="auto";n.element=l;if(m){m.call(n.sample)}return n};f.sampleDataInitializers.SimpleSound=f.initSample;f.sampleDataInitializers.ComplexSound=f.initSample;f.SampleLoadedHandler=function h(m,l){b.game.log.debug("processing "+l.type+"("+l.sample.id+")");f.sampleData[l.sample.id]=f.sampleDataInitializers[l.sample.type].call(this,{sample:l.sample,element:null},l.callback)};f.SampleUnloadedHandler=function j(n,l){b.game.log.debug("processing "+l.type+"("+l.sample.id+")");var m=f.sampleData[l.sampleId];f.sampleData[l.sampleId]=null;if(m&&m.element){m.element.pause();l.callback.call(m.sample)}else{l.callback.call(null)}};f.SamplePlayedHandler=function i(o,l){b.game.log.debug("processing "+l.type+"("+l.sampleId+")");var m=f.sampleData[l.sampleId];if(m&&m.element){if(m.element.readyState>0){m.element.currentTime=0;m.element.play();l.callback.call(m.sample)}else{m.element.addEventListener("loadedmetadata",function n(){m.element.currentTime=0;m.element.play();l.callback.call(m.sample)},false)}}else{l.callback.call(null)}};f.VolumeChangedHandler=function k(n,l){b.game.log.debug("processing "+l.type+"("+l.sampleId+")");var m=f.sampleData[l.sampleId];if(m&&m.element){m.element.volume=m.sample.volume;l.callback.call(m.sample)}else{l.callback.call(null)}};return this.init.apply(this,arguments)};b.client.sfx.classes.DriverHtml5.prototype=new b.client.sfx.classes.Driver();return b})(tvg);tvg=(function(b){b.client.sfx.classes.DriverCordova=function a(){var c=arguments.callee.prototype;var g={};g.sampleData=[];g.sampleDataInitializers=[];g.cordovaAudioSupported=null;this.init=function d(){c.init.call(this,"DriverCordova");g.cordovaAudioSupported=window.plugins&&window.plugins.NativeAudio;this.eventHandlers.SampleLoaded=g.SampleLoadedHandler;this.eventHandlers.SampleUnloaded=g.SampleUnloadedHandler;this.eventHandlers.SamplePlayed=g.SamplePlayedHandler;this.eventHandlers.VolumeChanged=g.VolumeChangedHandler;return this};this.release=function h(){g=null;c.release.call(this)};g.sampleDataInitializers.SimpleSound=function f(n,m){if(g.cordovaAudioSupported){window.plugins.NativeAudio.preloadSimple(n.sample.id,"sfx/"+n.sample.sampleUrl+".wav")}n.initialized=true;if(m){m.call(n.sample)}return n};g.sampleDataInitializers.ComplexSound=function e(n,m){if(g.cordovaAudioSupported){window.plugins.NativeAudio.preloadComplex(n.sample.id,"sfx/"+n.sample.sampleUrl+".wav",n.sample.volume)}n.initialized=true;if(m){m.call(n.sample)}return n};g.SampleLoadedHandler=function i(n,m){b.game.log.debug("processing "+m.type+"("+m.sample.id+")");g.sampleData[m.sample.id]=g.sampleDataInitializers[m.sample.type].call(this,{sample:m.sample,initialized:false},m.callback)};g.SampleUnloadedHandler=function k(o,m){b.game.log.debug("processing "+m.type+"("+m.sample.id+")");var n=g.sampleData[m.sampleId];g.sampleData[m.sampleId]=null;if(n&&n.initialized){if(g.cordovaAudioSupported){window.plugins.NativeAudio.unload(m.sampleId)}m.callback.call(n.sample)}else{m.callback.call(null)}};g.SamplePlayedHandler=function j(o,m){b.game.log.debug("processing "+m.type+"("+m.sampleId+")");var n=g.sampleData[m.sampleId];if(n&&n.initialized){if(g.cordovaAudioSupported){window.plugins.NativeAudio.play(m.sampleId)}m.callback.call(n.sample)}else{m.callback.call(null)}};g.VolumeChangedHandler=function l(o,m){b.game.log.debug("processing "+m.type+"("+m.sampleId+")");var n=g.sampleData[m.sampleId];if(n&&n.element){if(g.cordovaAudioSupported){window.plugins.NativeAudio.setVolumeForComplexAsset(m.sampleId,m.volume)}m.callback.call(n.sample)}else{m.callback.call(null)}};return this.init.apply(this,arguments)};b.client.sfx.classes.DriverCordova.prototype=new b.client.sfx.classes.Driver();return b})(tvg);tvg=(function(a){a.client.sfx.classes.Sample=function b(k,f,i,l){var c=arguments.callee.prototype;this.type=null;this.name=null;this.id=null;this.sampleUrl=null;this.volume=null;this.playing=false;this.init=function d(o,m,n,q){this.type=o?(""+o):null;this.name=m?(""+m):null;this.id=(o||m)?(""+o+"_"+m):null;this.volume=1;if(n){this.load(n)}if(q){this.setVolume(q)}return this};this.release=function h(){if(this.name!==undefined){a.client.sfx.Events.add(new a.client.sfx.classes.event.SampleUnloaded(this.id))}this.type=null;this.name=null;this.id=null;this.sampleUrl=null;this.volume=null;this.playing=null};this.load=function e(n,m){this.sampleUrl=n?(""+n):null;a.client.sfx.Events.add(new a.client.sfx.classes.event.SampleLoaded(this,m))};this.play=function g(m){this.playing=true;a.client.sfx.Events.add(new a.client.sfx.classes.event.SamplePlayed(this.id,function n(){if(this&&this.playing){this.playing=false}if(m){m.call(this)}}));return this};this.setVolume=function j(n,m){this.volume=n?(1*n):null;a.client.sfx.Events.add(new a.client.sfx.classes.event.VolumeChanged(this.id,this.volume,m));return this};return this.init.apply(this,arguments)};return a})(tvg);tvg=(function(b){b.client.sfx.classes.SimpleSound=function a(e,h,j){var c=arguments.callee.prototype;this.init=function d(k,l,m){c.init.call(this,"SimpleSound",k,l,m);return this};this.release=function g(){c.release.call(this)};this.play=function f(k){if(this.volume>0){c.play.call(this,k)}return this};this.setVolume=function i(l,k){this.volume=l?(1*l):null;if(k){k.call(this)}return this};return this.init.apply(this,arguments)};b.client.sfx.classes.SimpleSound.prototype=new b.client.sfx.classes.Sample();return b})(tvg);tvg=(function(b){function a(){this.current=null;this.init=function d(){this.current=null};this.release=function f(){this.current.release();this.current=null};this.load=function e(g){if(this.current){this.current.release();this.current=null}b.game.log.information("Loading sfx driver "+g.type+".");return this.current=g};this.get=function c(){return this.current};return this.init.apply(this,arguments)}b.client.sfx.Driver=new a();return b})(tvg);tvg=(function(a){a.client.input.Events=new a.client.evt.classes.Queue("input");return a})(tvg);tvg=(function(b){b.client.input.classes.event.PointerMove=function a(f,g){var c=arguments.callee.prototype;this.x=null;this.y=null;this.init=function d(h,i){c.init.call(this,"PointerMove");this.x=h?(1*h):null;this.y=i?(1*i):null;return this};this.release=function e(){this.x=null;this.y=null;c.release.call(this)};return this.init.apply(this,arguments)};b.client.input.classes.event.PointerMove.prototype=new b.client.evt.classes.Event();return b})(tvg);tvg=(function(b){b.client.input.classes.event.PointerDown=function a(f,g){var c=arguments.callee.prototype;this.x=null;this.y=null;this.init=function d(h,i){c.init.call(this,"PointerDown");this.x=h?(1*h):null;this.y=i?(1*i):null;return this};this.release=function e(){this.x=null;this.y=null;c.release.call(this)};return this.init.apply(this,arguments)};b.client.input.classes.event.PointerDown.prototype=new b.client.evt.classes.Event();return b})(tvg);tvg=(function(b){b.client.input.classes.event.PointerDrag=function a(h,i,f,g){var c=arguments.callee.prototype;this.x=null;this.y=null;this.startX=null;this.startY=null;this.init=function d(l,m,j,k){c.init.call(this,"PointerDrag");this.x=l?(1*l):null;this.y=m?(1*m):null;this.startX=j?(1*j):null;this.startY=k?(1*k):null;return this};this.release=function e(){this.x=null;this.y=null;this.startX=null;this.startY=null;c.release.call(this)};return this.init.apply(this,arguments)};b.client.input.classes.event.PointerDrag.prototype=new b.client.evt.classes.Event();return b})(tvg);tvg=(function(b){b.client.input.classes.event.PointerUp=function a(g,h,f,f){var c=arguments.callee.prototype;this.x=null;this.y=null;this.startX=null;this.startY=null;this.init=function d(k,l,i,j){c.init.call(this,"PointerUp");this.x=k?(1*k):null;this.y=l?(1*l):null;this.startX=i?(1*i):null;this.startY=j?(1*j):null;return this};this.release=function e(){this.x=null;this.y=null;this.startX=null;this.startY=null;c.release.call(this)};return this.init.apply(this,arguments)};b.client.input.classes.event.PointerUp.prototype=new b.client.evt.classes.Event();return b})(tvg);tvg=(function(b){b.client.input.classes.event.PointerClick=function a(g,h,d){var c=arguments.callee.prototype;this.x=null;this.y=null;this.duration=null;this.isLong=null;this.init=function e(k,l,i,j){c.init.call(this,"PointerClick");this.x=k?(1*k):null;this.y=l?(1*l):null;this.duration=i?(i|0):null;this.isLong=j&true;return this};this.release=function f(){this.x=null;this.y=null;this.duration=null;this.isLong=null;c.release.call(this)};return this.init.apply(this,arguments)};b.client.input.classes.event.PointerClick.prototype=new b.client.evt.classes.Event();return b})(tvg);tvg=(function(b){b.client.input.classes.event.KeyDown=function a(f,d){var c=arguments.callee.prototype;this.name=null;this.code=null;this.init=function e(i,h){c.init.call(this,"KeyDown");this.name=i?(""+i):null;this.code=h?(h|0):-1;return this};this.release=function g(){this.name=null;this.code=null;c.release.call(this)};return this.init.apply(this,arguments)};b.client.input.classes.event.KeyDown.prototype=new b.client.evt.classes.Event();return b})(tvg);tvg=(function(b){b.client.input.classes.event.OrientationChanged=function a(f,d){var c=arguments.callee.prototype;this.orientation=null;this.init=function e(h){c.init.call(this,"OrientationChanged");this.orientation=h?(h|0):b.client.input.Orientations.Moving;return this};this.release=function g(){this.orientation=null;c.release.call(this)};return this.init.apply(this,arguments)};b.client.input.classes.event.OrientationChanged.prototype=new b.client.evt.classes.Event();return b})(tvg);tvg=(function(b){b.client.input.classes.Driver=function a(h,g){var c=arguments.callee.prototype;this.type=null;this.subType=null;this.init=function d(j,i){this.type=j;this.subType=i?""+i:"";return this};this.release=function e(){this.type=null};this.sense=function f(i){};return this.init.apply(this,arguments)};return b})(tvg);tvg=(function(b){b.client.input.classes.KeyboardDriver=function a(h){var c=arguments.callee.prototype;var e={};e.browserKeyCodes={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Pause:19,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,PrintScreen:44,Insert:45,Delete:46,Key0:48,Key1:49,Key2:50,Key3:51,Key4:52,Key5:53,Key6:54,Key7:55,Key8:56,Key9:57,KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NumLock:144,ScrollLock:145,Comma:188,Dot:190,Slash:191,Apostrophe:192,BracketOpen:219,Backslash:220,BracketClosed:221,Quote:222,Colon:(b.client.input.classes.KeyboardDriver.browser=="Opera"||b.client.input.classes.KeyboardDriver.browser=="Firefox")?59:186,Equal:b.client.input.classes.KeyboardDriver.browser=="Opera"?61:(b.client.input.classes.KeyboardDriver.browser=="Firefox"?107:187),Minus:(b.client.input.classes.KeyboardDriver.browser=="Opera"||b.client.input.classes.KeyboardDriver.browser=="Firefox")?109:189,Windows:b.client.input.classes.KeyboardDriver.browser=="Opera"?219:91,Menu:b.client.input.classes.KeyboardDriver.browser=="Opera"?0:93};this.init=function d(i){c.init.call(this,"KeyboardDriver",i);document.addEventListener("keydown",e.keydownHandler,false);return this};this.release=function g(){document.removeEventListener("keydown",e.keydownHandler,false);e=null;c.release.call(this)};e.keydownHandler=function f(i){var j=i?i:window.event;for(keyName in e.browserKeyCodes){if(e.browserKeyCodes[keyName]==(j.keyCode||i.which)){b.client.input.Events.add(new b.client.input.classes.event.KeyDown(keyName,b.client.input.classes.KeyboardDriver.keyCode[keyName]))}}};return this.init.apply(this,arguments)};b.client.input.classes.KeyboardDriver.prototype=new b.client.input.classes.Driver();b.client.input.classes.KeyboardDriver.browser="Standard";b.client.input.classes.KeyboardDriver.keyCode={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Pause:19,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,PrintScreen:44,Insert:45,Delete:46,Key0:48,Key1:49,Key2:50,Key3:51,Key4:52,Key5:53,Key6:54,Key7:55,Key8:56,Key9:57,KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NumLock:144,ScrollLock:145,Comma:188,Dot:190,Slash:191,Apostrophe:192,BracketOpen:219,Backslash:220,BracketClosed:221,Quote:222,Colon:186,Equal:187,Minus:189,Windows:91,Menu:93};return b})(tvg);tvg=(function(b){b.client.input.classes.BackButtonDriver=function a(h){var c=arguments.callee.prototype;var e={};this.init=function d(i){c.init.call(this,"BackButtonDriver",i);document.addEventListener("backbutton",e.backButtonHandler,false);return this};this.release=function g(){document.removeEventListener("backbutton",e.backButtonHandler,false);e=null;c.release.call(this)};e.backButtonHandler=function f(i){b.client.input.Events.add(new b.client.input.classes.event.KeyDown("Escape",b.client.input.classes.KeyboardDriver.keyCode.Escape))};return this.init.apply(this,arguments)};b.client.input.classes.BackButtonDriver.prototype=new b.client.input.classes.Driver();return b})(tvg);tvg=(function(b){b.client.input.classes.MouseDriver=function a(k){var c=arguments.callee.prototype;var f={};f.mouseDownTime=null;f.mouseDownPosition=null;f.currentPosition=null;f.clickTimeoutTimerId=null;f.clickPositionTreshold=100;f.clickTimeout=500;f.moved=false;f.PointerMovePool=new b.client.evt.classes.EventPool(b.client.input.classes.event.PointerMove,10);f.PointerDownPool=new b.client.evt.classes.EventPool(b.client.input.classes.event.PointerDown,5);f.PointerDragPool=new b.client.evt.classes.EventPool(b.client.input.classes.event.PointerDrag,10);f.PointerUpPool=new b.client.evt.classes.EventPool(b.client.input.classes.event.PointerUp,5);f.PointerClickPool=new b.client.evt.classes.EventPool(b.client.input.classes.event.PointerClick,5);this.init=function e(l){c.init.call(this,"PointerDriver","MouseDriver");document.addEventListener("mousedown",this.mouseDownHandler,false);document.addEventListener("mousemove",this.mouseMoveHandler,false);document.addEventListener("mouseup",this.mouseUpHandler,false);f.mouseDownTime=null;f.mouseDownPosition={x:0,y:0};f.currentPosition={x:0,y:0};return this};this.release=function j(){document.removeEventListener("mousedown",this.mouseDownHandler,false);document.removeEventListener("mousemove",this.mouseMoveHandler,false);document.removeEventListener("mouseup",this.mouseUpHandler,false);f=null;c.release.call(this)};this.mouseDownHandler=function g(l){var m=l?l:window.event,n=0,o=0;if((m.clientX||m.clientY)&&document.body&&document.body.scrollLeft!=null){n=(m.clientX+document.body.scrollLeft)|0;o=(m.clientY+document.body.scrollTop)|0}if((m.clientX||m.clientY)&&document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.scrollLeft!=null){n=(m.clientX+document.documentElement.scrollLeft)|0;o=(m.clientY+document.documentElement.scrollTop)|0}if(m.pageX||m.pageY){n=m.pageX|0;o=m.pageY|0}f.currentPosition.x=b.client.gfx.Driver.current.getGameX(n);f.currentPosition.y=b.client.gfx.Driver.current.getGameY(o);f.mouseDownPosition.x=f.currentPosition.x;f.mouseDownPosition.y=f.currentPosition.y;f.moved=false;f.mouseDownTime=b.client.app.Application.current.time;if(f.clickTimeoutTimerId){clearTimeout(f.clickTimeoutTimerId)}f.clickTimeoutTimerId=setTimeout(f.clickIfNotMoved,1.1*f.clickTimeout+1000/60);b.client.input.Events.add(f.PointerDownPool.get(f.mouseDownPosition.x,f.mouseDownPosition.y));if(l.preventDefault){l.preventDefault()}return false};this.mouseMoveHandler=function h(l){var m=l?l:window.event,n=0,o=0;if((m.clientX||m.clientY)&&document.body&&document.body.scrollLeft!=null){n=(m.clientX+document.body.scrollLeft)|0;o=(m.clientY+document.body.scrollTop)|0}if((m.clientX||m.clientY)&&document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.scrollLeft!=null){n=(m.clientX+document.documentElement.scrollLeft)|0;o=(m.clientY+document.documentElement.scrollTop)|0}if(m.pageX||m.pageY){n=m.pageX|0;o=m.pageY|0}f.currentPosition.x=b.client.gfx.Driver.current.getGameX(n);f.currentPosition.y=b.client.gfx.Driver.current.getGameY(o);if(f.mouseDownTime!==null){if(f.moved==false&&(Math.abs(f.mouseDownPosition.x-f.currentPosition.x)>f.clickPositionTreshold||Math.abs(f.mouseDownPosition.y-f.currentPosition.y)>f.clickPositionTreshold)){f.moved=true}b.client.input.Events.add(f.PointerDragPool.get(f.currentPosition.x,f.currentPosition.y,f.mouseDownPosition.x,f.mouseDownPosition.y))}else{b.client.input.Events.add(f.PointerMovePool.get(f.currentPosition.x,f.currentPosition.y))}if(l.preventDefault){l.preventDefault()}return false};this.mouseUpHandler=function i(l){var m=l?l:window.event,n=0,o=0;if((m.clientX||m.clientY)&&document.body&&document.body.scrollLeft!=null){n=(m.clientX+document.body.scrollLeft)|0;o=(m.clientY+document.body.scrollTop)|0}if((m.clientX||m.clientY)&&document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.scrollLeft!=null){n=(m.clientX+document.documentElement.scrollLeft)|0;o=(m.clientY+document.documentElement.scrollTop)|0}if(m.pageX||m.pageY){n=m.pageX|0;o=m.pageY|0}f.currentPosition.x=b.client.gfx.Driver.current.getGameX(n);f.currentPosition.y=b.client.gfx.Driver.current.getGameY(o);if(f.mouseDownTime!==null){b.client.input.Events.add(f.PointerUpPool.get(f.currentPosition.x,f.currentPosition.y,f.mouseDownPosition.x,f.mouseDownPosition.y));if(f.clickTimeoutTimerId){clearTimeout(f.clickTimeoutTimerId)}f.clickIfNotMoved()}else{b.client.input.Events.add(f.PointerUpPool.get(f.currentPosition.x,f.currentPosition.y))}f.mouseDownTime=null;if(l.preventDefault){l.preventDefault()}return false};f.clickIfNotMoved=function d(){if(!f.moved&&Math.abs(f.mouseDownPosition.x-f.currentPosition.x)<f.clickPositionTreshold&&Math.abs(f.mouseDownPosition.y-f.currentPosition.y)<f.clickPositionTreshold){b.client.input.Events.add(f.PointerClickPool.get(f.currentPosition.x,f.currentPosition.y,b.client.app.Application.current.time-f.mouseDownTime,b.client.app.Application.current.time-f.mouseDownTime>=f.clickTimeout));f.mouseDownTime=null}f.clickTimeoutTimerId=null};return this.init.apply(this,arguments)};b.client.input.classes.MouseDriver.prototype=new b.client.input.classes.Driver();return b})(tvg);tvg=(function(b){b.client.input.classes.TouchDriver=function a(){var c=arguments.callee.prototype;var f={};f.touchTime=null;f.touchStartPosition=null;f.currentPosition=null;f.clickTimeoutTimerId=null;f.clickPositionTreshold=200;f.clickTimeout=500;f.PointerMovePool=new b.client.evt.classes.EventPool(b.client.input.classes.event.PointerMove,10);f.PointerDownPool=new b.client.evt.classes.EventPool(b.client.input.classes.event.PointerDown,5);f.PointerDragPool=new b.client.evt.classes.EventPool(b.client.input.classes.event.PointerDrag,10);f.PointerUpPool=new b.client.evt.classes.EventPool(b.client.input.classes.event.PointerUp,5);f.PointerClickPool=new b.client.evt.classes.EventPool(b.client.input.classes.event.PointerClick,5);this.init=function e(){c.init.call(this,"PointerDriver","TouchDriver");document.addEventListener("touchstart",this.touchStartHandler,false);document.addEventListener("touchmove",this.touchMoveHandler,false);document.addEventListener("touchend",this.touchEndHandler,false);f.touchTime=null;f.touchStartPosition={x:0,y:0};f.currentPosition={x:0,y:0};return this};this.release=function g(){document.removeEventListener("touchstart",this.touchStartHandler,false);document.removeEventListener("touchmove",this.touchMoveHandler,false);document.removeEventListener("touchend",this.touchEndHandler,false);f=null;c.release.call(this)};this.touchStartHandler=function j(k){f.currentPosition.x=b.client.gfx.Driver.current.getGameX(k.targetTouches[0].pageX);f.currentPosition.y=b.client.gfx.Driver.current.getGameY(k.targetTouches[0].pageY);f.touchStartPosition.x=f.currentPosition.x;f.touchStartPosition.y=f.currentPosition.y;f.touchTime=b.client.app.Application.current.time;if(f.clickTimeoutTimerId){clearTimeout(f.clickTimeoutTimerId)}f.clickTimeoutTimerId=setTimeout(f.clickIfNotMoved,1.1*f.clickTimeout+1000/60);b.client.input.Events.add(f.PointerDownPool.get(f.touchStartPosition.x,f.touchStartPosition.y));if(k.preventDefault){k.preventDefault()}return false};this.touchMoveHandler=function i(k){f.currentPosition.x=b.client.gfx.Driver.current.getGameX(k.targetTouches[0].pageX);f.currentPosition.y=b.client.gfx.Driver.current.getGameY(k.targetTouches[0].pageY);if(f.touchTime!==null){b.client.input.Events.add(f.PointerDragPool.get(f.currentPosition.x,f.currentPosition.y,f.touchStartPosition.x,f.touchStartPosition.y))}else{b.client.input.Events.add(f.PointerMovePool.get(f.currentPosition.x,f.currentPosition.y))}if(k.preventDefault){k.preventDefault()}return false};this.touchEndHandler=function h(k){f.currentPosition.x=b.client.gfx.Driver.current.getGameX((k.targetTouches[0]||k.changedTouches[0]).pageX);f.currentPosition.y=b.client.gfx.Driver.current.getGameY((k.targetTouches[0]||k.changedTouches[0]).pageY);if(f.touchTime!==null){b.client.input.Events.add(f.PointerUpPool.get(f.currentPosition.x,f.currentPosition.y,f.touchStartPosition.x,f.touchStartPosition.y));if(f.clickTimeoutTimerId){clearTimeout(f.clickTimeoutTimerId)}f.clickIfNotMoved()}else{b.client.input.Events.add(f.PointerUpPool.get(f.currentPosition.x,f.currentPosition.y))}f.touchTime=null;if(k.preventDefault){k.preventDefault()}return false};f.clickIfNotMoved=function d(){if(Math.abs(f.touchStartPosition.x-f.currentPosition.x)<f.clickPositionTreshold&&Math.abs(f.touchStartPosition.y-f.currentPosition.y)<f.clickPositionTreshold){b.client.input.Events.add(f.PointerClickPool.get(f.currentPosition.x,f.currentPosition.y,b.client.app.Application.current.time-f.touchTime,b.client.app.Application.current.time-f.touchTime>=f.clickTimeout));f.touchTime=null}f.clickTimeoutTimerId=null};return this.init.apply(this,arguments)};b.client.input.classes.TouchDriver.prototype=new b.client.input.classes.Driver();return b})(tvg);tvg=(function(b){b.client.input.classes.CameraDriver=function a(){var c=arguments.callee.prototype;this.started=null;this.width=null;this.height=null;this.init=function e(j,k,i){c.init.call(this,"CameraDriver",j);this.started=false;this.width=k?(k|0):b.client.input.classes.CameraDriver.defaultWidth;this.height=i?(i|0):b.client.input.classes.CameraDriver.defaultHeight;return this};this.release=function f(){if(this.started){this.stop()}this.started=null;this.width=null;this.height=null;c.release.call(this)};this.start=function g(n,i,l,m,k,j){this.width=n?(n|0):(this.width?this.width:b.client.input.classes.CameraDriver.defaultWidth);this.height=i?(i|0):(this.height?this.height:b.client.input.classes.CameraDriver.defaultHeight);this.previewX=l?(l|0):-10;this.previewY=m?(m|0):-10;this.previewWidth=k?(k|0):10;this.previewHeight=j?(j|0):10;this.started=true};this.stop=function h(){this.started=false};this.getPicture=function d(j,i){if(!this.started){if(i){i("Camera not started.")}return}if(i){i("Camera is not supported.")}this.stop()};return this.init.apply(this,arguments)};b.client.input.classes.CameraDriver.prototype=new b.client.input.classes.Driver();b.client.input.classes.CameraDriver.defaultWidth=800;b.client.input.classes.CameraDriver.defaultHeight=600;return b})(tvg);tvg=(function(b){b.client.input.classes.CameraDriverHtml5=function a(k,e){var c=arguments.callee.prototype;var g={};g.getUserMedia=null;g.getUserMediaSupported=null;g.videoElement=null;g.canvas=null;g.context2d=null;this.init=function f(m,l){c.init.call(this,"CameraDriverHtml5",m,l);g.getUserMediaSupported=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);return this};this.release=function h(){g=null;c.release.call(this)};this.start=function i(t,l,r,s,q,o){c.start.call(this,t,l,r,s,q,o);if(!g.getUserMediaSupported){return}g.videoElement=document.createElement("video");g.videoElement.style.position="absolute";g.videoElement.style.zIndex="10000";g.videoElement.style.left=this.previewX+"px";g.videoElement.style.top=this.previewY+"px";g.videoElement.style.width=this.previewWidth+"px";g.videoElement.style.height=this.previewHeight+"px";g.videoElement.width=this.width;g.videoElement.height=this.height;g.videoElement.controls=false;document.body.appendChild(g.videoElement);g.canvas=document.createElement("canvas");g.canvas.width=this.width;g.canvas.height=this.height;g.context2d=g.canvas.getContext("2d");if(navigator.getUserMedia){navigator.getUserMedia("video",function m(u){if(g&&g.videoElement){g.videoStream=u;g.videoElement.src=u;g.videoElement.play()}},this.stop)}else{if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia({video:true},function n(u){if(g&&g.videoElement){g.videoStream=u;g.videoElement.src=window.URL.createObjectURL(u);g.videoElement.play()}},this.stop)}}};this.stop=function j(){if(g.videoElement){g.videoElement.pause();document.body.removeChild(g.videoElement);if(g.videoStream){if(g.videoStream.stop){g.videoStream.stop()}else{tracks=g.videoStream.getTracks();for(var l=0;l<tracks.length;l++){if(tracks[l].stop){tracks[l].stop()}}}g.videoStream=null}g.videoElement=null;g.canvas=null;g.context2d=null}c.stop.call(this)};this.getPicture=function d(n,l){if(!this.started){if(l){l("Camera not started.")}return}if(!g.getUserMediaSupported){if(l){l("Camera is not supported.")}this.stop()}else{if(!g.videoElement){setTimeout(function m(){if(l){l("Camera not yet initialized.")}},1000)}else{if(n){g.context2d.drawImage(g.videoElement,0,0,this.width,this.height);n.call(this,g.canvas.toDataURL("image/png"))}}}};return this.init.apply(this,arguments)};b.client.input.classes.CameraDriverHtml5.prototype=new b.client.input.classes.CameraDriver();return b})(tvg);tvg=(function(b){b.client.input.classes.CameraDriverCordova=function a(i,e){var c=arguments.callee.prototype;this.supported=null;var g={};this.init=function f(k,j){c.init.call(this,"CameraDriverCordova",k,j);g.instance=this;this.supported=navigator&&navigator.camera&&navigator.camera.getPicture;return this};this.release=function h(){this.supported=null;g=null;c.release.call(this)};this.getPicture=function d(k,j){if(!this.started){if(j){j.call(g.instance,"Camera not started.")}return}if(!this.supported){if(j){j.call(g.instance,"CameraDriverCordova is not supported on this platform.")}return}navigator.camera.getPicture(k?function(l){k.call(g.instance,"data:image/png;base64,"+l)}:null,j,{destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,correctOrientation:true,allowEdit:false,encodingType:Camera.EncodingType.PNG,targetWidth:this.width,targetHeight:this.height,saveToPhotoAlbum:false})};return this.init.apply(this,arguments)};b.client.input.classes.CameraDriverCordova.prototype=new b.client.input.classes.CameraDriver();return b})(tvg);tvg=(function(b){b.client.input.classes.CameraDriverCordovaPreview=function a(l,e){var c=arguments.callee.prototype;this.supported=null;var g={};g.takingPicture=false;g.stopRequested=false;this.init=function f(n,m){c.init.call(this,"CameraDriverCordovaPreview",n,m);g.instance=this;this.supported=(cordova&&cordova.plugins&&cordova.plugins.camerapreview)&&true;return this};this.release=function i(){this.supported=null;if(g&&g.image){document.body.removeChild(g.image);g.image=null}g=null;c.release.call(this)};this.start=function j(s,m,q,r,o,n){c.start.call(this,s,m,q,r,o,n);g.image=new Image();g.image.style.position="absolute";g.image.style.left=this.previewX+"px";g.image.style.top=this.previewY+"px";g.image.style.width=this.previewWidth+"px";g.image.style.height=this.previewHeight+"px";g.image.width=this.width;g.image.height=this.height;document.body.appendChild(g.image);cordova.plugins.camerapreview.startCamera({x:-this.width-10,y:-this.height-10,width:this.width,height:this.height},"back",false,false,false);cordova.plugins.camerapreview.setOnPictureTakenHandler(g.onPictureTaken)};this.stop=function k(){if(g&&g.image){document.body.removeChild(g.image);g.image=null}if(g.takingPicture){g.stopRequested=true;return}cordova.plugins.camerapreview.stopCamera();g.successCallback=null;g.failCallback=null;c.stop.call(this)};g.onPictureTaken=function h(m){g.takingPicture=false;if(g.stopRequested){if(g.failCallback){g.failCallback.call(g.instance,"Stopping.")}g.stopRequested=false;g.instance.stop.call(g.instance);return}var n="data:image/png;base64,"+m[0];if(g&&g.image){g.image.src=n}var r=g.successCallback;var q=g.failCallback;try{g.successCallback=null;g.failCallback=null;if(r){r.call(g.instance,n)}}catch(o){if(q){q.call(g.instance,""+o)}}};this.getPicture=function d(o,n){if(!this.supported){if(n){n.call(g.instance,"CameraDriverCordovaPreview is not supported on this platform.")}return}if(!this.started){if(n){n.call(g.instance,"Camera not started.")}return}try{g.takingPicture=true;g.successCallback=o;g.failCallback=n;cordova.plugins.camerapreview.takePicture({maxWidth:this.width,maxHeight:this.height})}catch(m){if(n){n.call(g.instance,""+m)}}};return this.init.apply(this,arguments)};b.client.input.classes.CameraDriverCordovaPreview.prototype=new b.client.input.classes.CameraDriver();return b})(tvg);tvg=(function(b){b.client.input.classes.QrDriver=function a(i,j,d){var c=arguments.callee.prototype;this.started=null;this.init=function e(l,m,k){c.init.call(this,"QrDriver",l);this.started=false;return this};this.release=function f(){if(this.started){this.stop()}this.started=null;c.release.call(this)};this.scan=function g(n,o,m,l,q,k){this.previewX=n?(n|0):-10;this.previewY=o?(o|0):-10;this.previewWidth=m?(m|0):10;this.previewHeight=l?(l|0):10;this.started=true};this.abort=function h(){this.started=false};return this.init.apply(this,arguments)};b.client.input.classes.QrDriver.prototype=new b.client.input.classes.Driver();return b})(tvg);tvg=(function(b){b.client.input.classes.QrDriverHtml5=function a(n,e){var d=arguments.callee.prototype;var g={};g.getUserMedia=null;g.getUserMediaSupported=null;g.videoElement=null;g.canvas=null;g.context2d=null;g.scanning=null;g.successCallback=null;g.failCallback=null;this.init=function f(q,o){d.init.call(this,"QrDriverHtml5",q,o);g.getUserMediaSupported=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);g.instance=this;g.scanning=false;g.qrCodeUtility=new b.client.util.classes.QrCodeUtility();return this};this.release=function k(){if(g.scanning){this.abort()}g=null;d.release.call(this)};this.scan=function l(u,v,t,s,w,o){d.scan.call(this,u,v,t,s,w,o);if(!g.getUserMediaSupported){return}g.videoElement=document.createElement("video");g.videoElement.style.position="absolute";g.videoElement.style.zIndex="10000";g.videoElement.style.left=b.client.gfx.Driver.current.getTranslatedBrowserX(this.previewX)+"px";g.videoElement.style.top=b.client.gfx.Driver.current.getTranslatedBrowserY(this.previewY)+"px";g.videoElement.style.width=b.client.gfx.Driver.current.getBrowserX(this.previewWidth)+"px";g.videoElement.style.height=b.client.gfx.Driver.current.getBrowserY(this.previewHeight)+"px";g.videoElement.controls=false;document.body.appendChild(g.videoElement);g.canvas=document.createElement("canvas");g.canvas.width=128;g.canvas.height=128;g.context2d=g.canvas.getContext("2d");if(navigator.getUserMedia){navigator.getUserMedia("video",function q(x){if(g&&g.videoElement){g.videoStream=x;g.videoElement.src=x;g.videoElement.play()}},this.abort)}else{if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia({video:true},function r(x){if(g&&g.videoElement){g.videoStream=x;g.videoElement.src=window.URL.createObjectURL(x);g.videoElement.play()}},this.abort)}}g.scanning=true;g.successCallback=w;g.failCallback=o;g.takePicture()};g.takePicture=function m(){setTimeout(function o(){if(g&&g.scanning){g.context2d.drawImage(g.videoElement,0,0,128,128);g.videoElement.play();g.onPictureTaken(g.canvas.toDataURL("image/png"))}},100)};this.abort=function c(){if(g.videoElement){g.videoElement.pause();document.body.removeChild(g.videoElement);if(g.videoStream){if(g.videoStream.stop){g.videoStream.stop()}else{tracks=g.videoStream.getTracks();for(var o=0;o<tracks.length;o++){if(tracks[o].stop){tracks[o].stop()}}}g.videoStream=null}g.videoElement=null;g.canvas=null;g.context2d=null}g.scanning=false;d.abort.call(this)};g.onPictureTaken=function j(o){if(o=="data:,"){g.takePicture()}else{g.qrCodeUtility.decode(o,g.onDetected,g.onError)}};g.onError=function i(o){if(!g||(g&&!g.scanning)){return}g.takePicture()};g.onDetected=function h(r){if(!g||(g&&!g.scanning)){return}if(g&&g.scanning){g.instance.abort()}var q=g.successCallback;var o=g.failCallback;g.successCallback=null;g.failCallback=null;if(q){q.call(g.instance,r)}};return this.init.apply(this,arguments)};b.client.input.classes.QrDriverHtml5.prototype=new b.client.input.classes.QrDriver();return b})(tvg);tvg=(function(b){b.client.input.classes.QrDriverCordova=function a(n,e){var d=arguments.callee.prototype;var g={};g.scanning=null;g.successCallback=null;g.failCallback=null;this.supported=null;this.init=function f(q,o){d.init.call(this,"QrDriverCordova",q,o);this.supported=navigator&&navigator.camera&&navigator.camera.getPicture;g.instance=this;g.scanning=false;g.qrCodeUtility=new b.client.util.classes.QrCodeUtility();return this};this.release=function k(){if(g.scanning){this.abort()}g=null;this.supported=null;d.release.call(this)};this.scan=function l(s,t,r,q,u,o){d.scan.call(this,s,t,r,q,u,o);if(!this.supported){if(o){o.call(g.instance,"QrDriverCordova is not supported on this platform.")}return}g.imageElement=document.createElement("img");g.imageElement.style.position="absolute";g.imageElement.style.left=b.client.gfx.Driver.current.getTranslatedBrowserX(this.previewX)+"px";g.imageElement.style.top=b.client.gfx.Driver.current.getTranslatedBrowserY(this.previewY)+"px";g.imageElement.style.width=b.client.gfx.Driver.current.getBrowserX(this.previewWidth)+"px";g.imageElement.style.height=b.client.gfx.Driver.current.getBrowserY(this.previewHeight)+"px";document.body.appendChild(g.imageElement);g.scanning=true;g.successCallback=u;g.failCallback=o;g.takePicture()};g.takePicture=function m(){setTimeout(function o(){if(g&&g.scanning){navigator.camera.getPicture(g.onPictureTaken,g.onError,{destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,correctOrientation:true,allowEdit:false,encodingType:Camera.EncodingType.PNG,targetWidth:this.width,targetHeight:this.height,saveToPhotoAlbum:false})}},100)};this.abort=function c(){if(g.imageElement){document.body.removeChild(g.imageElement);g.imageElement=null}g.scanning=false;d.abort.call(this)};g.onPictureTaken=function j(o){if(o==""){g.takePicture()}else{var q="data:image/png;base64,"+o;g.imageElement.src=q;g.qrCodeUtility.decode(q,g.onDetected,g.onError)}};g.onError=function i(o){if(!g||(g&&!g.scanning)){return}g.takePicture()};g.onDetected=function h(r){if(!g||(g&&!g.scanning)){return}if(g&&g.scanning){g.instance.abort()}var q=g.successCallback;var o=g.failCallback;g.successCallback=null;g.failCallback=null;if(q){q.call(g.instance,r)}};return this.init.apply(this,arguments)};b.client.input.classes.QrDriverCordova.prototype=new b.client.input.classes.QrDriver();return b})(tvg);tvg=(function(b){b.client.input.classes.QrDriverCordovaPreview=function a(m,e){var d=arguments.callee.prototype;var g={};g.takingPicture=false;g.stopRequested=false;g.successCallback=null;g.failCallback=null;this.supported=null;this.init=function f(o,n){d.init.call(this,"QrDriverCordovaPreview",o,n);g.instance=this;this.supported=(cordova&&cordova.plugins&&cordova.plugins.camerapreview)&&true;g.qrCodeUtility=new b.client.util.classes.QrCodeUtility();g.detecting=false;return this};this.release=function k(){this.supported=null;if(g.detecting){this.abort()}g=null;d.release.call(this)};this.scan=function l(s,t,r,q,v,o){d.scan.call(this,s,t,r,q,v,o);g.image=new Image();g.image.style.position="absolute";g.image.style.left=b.client.gfx.Driver.current.getTranslatedBrowserX(this.previewX)+"px";g.image.style.top=b.client.gfx.Driver.current.getTranslatedBrowserY(this.previewY)+"px";g.image.style.width=b.client.gfx.Driver.current.getBrowserX(this.previewWidth)+"px";g.image.style.height=b.client.gfx.Driver.current.getBrowserY(this.previewHeight)+"px";g.image.width=128;g.image.height=128;document.body.appendChild(g.image);try{g.detecting=true;g.takingPicture=true;g.successCallback=v;g.failCallback=o;cordova.plugins.camerapreview.startCamera({x:-b.client.gfx.Driver.current.getBrowserX(this.previewWidth)-10,y:-b.client.gfx.Driver.current.getBrowserY(this.previewHeight)-10,width:b.client.gfx.Driver.current.getBrowserX(this.previewWidth),height:b.client.gfx.Driver.current.getBrowserY(this.previewHeight)},"back",false,false,false);setTimeout(function u(){cordova.plugins.camerapreview.setOnPictureTakenHandler(g.onPictureTaken);cordova.plugins.camerapreview.takePicture({maxWidth:128,maxHeight:128})},1000)}catch(n){if(o){o.call(g.instance,""+n)}}};this.abort=function c(){if(g&&g.image){document.body.removeChild(g.image);g.image=null}if(g.takingPicture){g.stopRequested=true;return}cordova.plugins.camerapreview.stopCamera();g.successCallback=null;g.failCallback=null;g.detecting=false;d.abort.call(this)};g.onPictureTaken=function j(n){g.takingPicture=false;if(g.stopRequested){if(g.failCallback){g.failCallback.call(g.instance,"Stopping.")}g.stopRequested=false;g.instance.abort.call(g.instance);return}var o="data:image/png;base64,"+n[0];if(g&&g.image){g.image.src=o}g.qrCodeUtility.decode(o,g.onDetected,g.onError)};g.onError=function i(n){if(g.detecting){g.takingPicture=true;cordova.plugins.camerapreview.takePicture({maxWidth:128,maxHeight:128})}};g.onDetected=function h(q){var o=g.successCallback;var n=g.failCallback;if(g.detecting){g.instance.abort()}if(o){o.call(g.instance,q)}};return this.init.apply(this,arguments)};b.client.input.classes.QrDriverCordovaPreview.prototype=new b.client.input.classes.QrDriver();return b})(tvg);tvg=(function(b){b.client.input.classes.QrDriverCordovaBarcodeScanner=function a(l,e){var d=arguments.callee.prototype;var g={};g.supported=null;g.scanning=null;g.successCallback=null;g.failCallback=null;this.init=function f(n,m){d.init.call(this,"QrDriverCordovaBarcodeScanner",n,m);g.supported=(cordova&&cordova.plugins&&cordova.plugins.barcodeScanner)&&true;g.instance=this;g.scanning=false;return this};this.release=function j(){if(g.scanning){this.abort()}g=null;d.release.call(this)};this.scan=function k(q,r,o,n,s,m){d.scan.call(this,q,r,o,n,s,m);if(!g.supported){return}g.scanning=true;g.successCallback=s;g.failCallback=m;cordova.plugins.barcodeScanner.scan(g.onDetected,g.onError)};this.abort=function c(){g.scanning=false;d.abort.call(this)};g.onError=function i(m){if(!g||(g&&!g.scanning)){return}var o=g.successCallback;var n=g.failCallback;g.successCallback=null;g.failCallback=null;g.scanning=false;if(n){n.call(g.instance,""+m)}};g.onDetected=function h(n){if(!g||(g&&!g.scanning)){return}var o=g.successCallback;var m=g.failCallback;if(g&&g.scanning){g.instance.abort()}g.successCallback=null;g.failCallback=null;if(o){o.call(g.instance,n.text)}};return this.init.apply(this,arguments)};b.client.input.classes.QrDriverCordovaBarcodeScanner.prototype=new b.client.input.classes.QrDriver();return b})(tvg);tvg=(function(a){a.client.input.Orientations={Moving:0,FaceUp:1,FaceDown:-1};a.client.input.Orientation={supported:false,current:a.client.input.Orientations.Moving,alpha:0,beta:0,gamma:0,mean:{alpha:0,beta:0,gamma:0},deviation:{alpha:0,beta:0,gamma:0},calibration:{faceUp:{mean:{alpha:0,beta:0,gamma:0},deviation:{alpha:90,beta:3,gamma:3}},faceDown:{mean:{alpha:0,beta:0,gamma:180},deviation:{alpha:90,beta:3,gamma:3}}}};return a})(tvg);tvg=(function(b){b.client.input.classes.OrientationDriver=function a(j){var d=arguments.callee.prototype;var f={};this.samplingWindowsMilliseconds=null;this.init=function e(l,k){d.init.call(this,"OrientationDriver",l);this.samplingWindowsMilliseconds=k?k|0:600;f.history={currentSample:null,alpha:new Array((this.samplingWindowsMilliseconds*60/1000)|0),beta:new Array((this.samplingWindowsMilliseconds*60/1000)|0),gamma:new Array((this.samplingWindowsMilliseconds*60/1000)|0),alphaSum:{x:null,y:null},betaSum:{x:null,y:null},gammaSum:{x:null,y:null},alphaMean:new Array((this.samplingWindowsMilliseconds*60/1000)|0),betaMean:new Array((this.samplingWindowsMilliseconds*60/1000)|0),gammaMean:new Array((this.samplingWindowsMilliseconds*60/1000)|0),alphaDevSum:null,betaDevSum:null,gammaDevSum:null,lastOrientation:0,newOrientationFrameCount:0,newOrientationFrameTreshold:10};return this};this.release=function h(){this.samplingWindowsMilliseconds=null;f=null;d.release.call(this)};this.orientationChangedHandler=function g(k,l,m){b.client.input.Orientation.alpha=(isNaN(k)||k===null||k===undefined)?0:k;b.client.input.Orientation.beta=(isNaN(l)||l===null||l===undefined)?0:l;b.client.input.Orientation.gamma=(isNaN(m)||m===null||m===undefined)?0:m};f.angleDiff=function c(k,l){if(k<0){k+=360}if(l<0){l+=360}return Math.abs(((k-l+180+360)%360)-180)};this.sense=function i(m){if(!b.client.input.Orientation.supported){return}if(f.history.currentSample===null){f.history.currentSample=0;for(var k=0;k<f.history.alpha.length;k++){f.history.alphaMean[k]=f.history.alpha[k]=b.client.input.Orientation.alpha;f.history.betaMean[k]=f.history.beta[k]=b.client.input.Orientation.beta;f.history.gammaMean[k]=f.history.gamma[k]=b.client.input.Orientation.gamma}f.history.alphaSum.x=Math.cos(b.client.input.Orientation.alpha*(Math.PI/180))*f.history.alpha.length;f.history.alphaSum.y=Math.sin(b.client.input.Orientation.alpha*(Math.PI/180))*f.history.alpha.length;f.history.betaSum.x=Math.cos(b.client.input.Orientation.beta*(Math.PI/180))*f.history.alpha.length;f.history.betaSum.y=Math.sin(b.client.input.Orientation.beta*(Math.PI/180))*f.history.alpha.length;f.history.gammaSum.x=Math.cos(b.client.input.Orientation.gamma*(Math.PI/180))*f.history.alpha.length;f.history.gammaSum.y=Math.sin(b.client.input.Orientation.gamma*(Math.PI/180))*f.history.alpha.length;f.history.alphaDevSum=0;f.history.betaDevSum=0;f.history.gammaDevSum=0;b.client.input.Orientation.mean.alpha=b.client.input.Orientation.alpha;b.client.input.Orientation.mean.beta=b.client.input.Orientation.beta;b.client.input.Orientation.mean.gamma=b.client.input.Orientation.gamma;b.client.input.Orientation.deviation.alpha=0;b.client.input.Orientation.deviation.beta=0;b.client.input.Orientation.deviation.gamma=0;return}f.history.alphaSum.x-=Math.cos(f.history.alpha[f.history.currentSample]*(Math.PI/180));f.history.alphaSum.y-=Math.sin(f.history.alpha[f.history.currentSample]*(Math.PI/180));f.history.betaSum.x-=Math.cos(f.history.beta[f.history.currentSample]*(Math.PI/180));f.history.betaSum.y-=Math.sin(f.history.beta[f.history.currentSample]*(Math.PI/180));f.history.gammaSum.x-=Math.cos(f.history.gamma[f.history.currentSample]*(Math.PI/180));f.history.gammaSum.y-=Math.sin(f.history.gamma[f.history.currentSample]*(Math.PI/180));f.history.alphaDevSum-=f.angleDiff(f.history.alphaMean[f.history.currentSample],f.history.alpha[f.history.currentSample])*f.angleDiff(f.history.alphaMean[f.history.currentSample],f.history.alpha[f.history.currentSample]);f.history.betaDevSum-=f.angleDiff(f.history.betaMean[f.history.currentSample],f.history.beta[f.history.currentSample])*f.angleDiff(f.history.betaMean[f.history.currentSample],f.history.beta[f.history.currentSample]);f.history.gammaDevSum-=f.angleDiff(f.history.gammaMean[f.history.currentSample],f.history.gamma[f.history.currentSample])*f.angleDiff(f.history.gammaMean[f.history.currentSample],f.history.gamma[f.history.currentSample]);f.history.alpha[f.history.currentSample]=b.client.input.Orientation.alpha;f.history.beta[f.history.currentSample]=b.client.input.Orientation.beta;f.history.gamma[f.history.currentSample]=b.client.input.Orientation.gamma;f.history.alphaSum.x+=Math.cos(b.client.input.Orientation.alpha*(Math.PI/180));f.history.alphaSum.y+=Math.sin(b.client.input.Orientation.alpha*(Math.PI/180));f.history.betaSum.x+=Math.cos(b.client.input.Orientation.beta*(Math.PI/180));f.history.betaSum.y+=Math.sin(b.client.input.Orientation.beta*(Math.PI/180));f.history.gammaSum.x+=Math.cos(b.client.input.Orientation.gamma*(Math.PI/180));f.history.gammaSum.y+=Math.sin(b.client.input.Orientation.gamma*(Math.PI/180));b.client.input.Orientation.mean.alpha=Math.atan2(f.history.alphaSum.y,f.history.alphaSum.x)*(180/Math.PI);b.client.input.Orientation.mean.beta=Math.atan2(f.history.betaSum.y,f.history.betaSum.x)*(180/Math.PI);b.client.input.Orientation.mean.gamma=Math.atan2(f.history.gammaSum.y,f.history.gammaSum.x)*(180/Math.PI);if(isNaN(b.client.input.Orientation.mean.alpha)){b.client.input.Orientation.mean.alpha=0}if(isNaN(b.client.input.Orientation.mean.beta)){b.client.input.Orientation.mean.beta=0}if(isNaN(b.client.input.Orientation.mean.gamma)){b.client.input.Orientation.mean.gamma=0}f.history.alphaMean[f.history.currentSample]=b.client.input.Orientation.mean.alpha;f.history.betaMean[f.history.currentSample]=b.client.input.Orientation.mean.beta;f.history.gammaMean[f.history.currentSample]=b.client.input.Orientation.mean.gamma;f.history.alphaDevSum+=f.angleDiff(b.client.input.Orientation.mean.alpha,b.client.input.Orientation.alpha)*f.angleDiff(b.client.input.Orientation.mean.alpha,b.client.input.Orientation.alpha);f.history.betaDevSum+=f.angleDiff(b.client.input.Orientation.mean.beta,b.client.input.Orientation.beta)*f.angleDiff(b.client.input.Orientation.mean.beta,b.client.input.Orientation.beta);f.history.gammaDevSum+=f.angleDiff(b.client.input.Orientation.mean.gamma,b.client.input.Orientation.gamma)*f.angleDiff(b.client.input.Orientation.mean.gamma,b.client.input.Orientation.gamma);b.client.input.Orientation.deviation.alpha=Math.sqrt(f.history.alphaDevSum/f.history.alpha.length);b.client.input.Orientation.deviation.beta=Math.sqrt(f.history.betaDevSum/f.history.beta.length);b.client.input.Orientation.deviation.gamma=Math.sqrt(f.history.gammaDevSum/f.history.gamma.length);if(isNaN(b.client.input.Orientation.deviation.alpha)){b.client.input.Orientation.deviation.alpha=0}if(isNaN(b.client.input.Orientation.deviation.beta)){b.client.input.Orientation.deviation.beta=0}if(isNaN(b.client.input.Orientation.deviation.gamma)){b.client.input.Orientation.deviation.gamma=0}f.history.currentSample=(f.history.currentSample+1)%f.history.alpha.length;var l=b.client.input.Orientations.Moving;if((b.client.input.Orientation.calibration.faceUp.deviation.alpha>30||f.angleDiff(b.client.input.Orientation.mean.alpha,b.client.input.Orientation.calibration.faceUp.mean.alpha)<=b.client.input.Orientation.calibration.faceUp.deviation.alpha)&&(b.client.input.Orientation.calibration.faceUp.deviation.beta>30||f.angleDiff(b.client.input.Orientation.mean.beta,b.client.input.Orientation.calibration.faceUp.mean.beta)<=b.client.input.Orientation.calibration.faceUp.deviation.beta)&&(b.client.input.Orientation.calibration.faceUp.deviation.gamma>30||f.angleDiff(b.client.input.Orientation.mean.gamma,b.client.input.Orientation.calibration.faceUp.mean.gamma)<=b.client.input.Orientation.calibration.faceUp.deviation.gamma)){l=b.client.input.Orientations.FaceUp}else{if((b.client.input.Orientation.calibration.faceDown.deviation.alpha>30||f.angleDiff(b.client.input.Orientation.mean.alpha,b.client.input.Orientation.calibration.faceDown.mean.alpha)<=b.client.input.Orientation.calibration.faceDown.deviation.alpha)&&(b.client.input.Orientation.calibration.faceDown.deviation.beta>30||f.angleDiff(b.client.input.Orientation.mean.beta,b.client.input.Orientation.calibration.faceDown.mean.beta)<=b.client.input.Orientation.calibration.faceDown.deviation.beta)&&(b.client.input.Orientation.calibration.faceDown.deviation.gamma>30||f.angleDiff(b.client.input.Orientation.mean.gamma,b.client.input.Orientation.calibration.faceDown.mean.gamma)<=b.client.input.Orientation.calibration.faceDown.deviation.gamma)){l=b.client.input.Orientations.FaceDown}}if(f.history.lastOrientation==l){if(f.history.newOrientationFrameCount){f.history.newOrientationFrameCount=0}}else{if(++f.history.newOrientationFrameCount>f.history.newOrientationFrameTreshold){f.history.newOrientationFrameCount=0;f.history.lastOrientation=l;b.client.input.Orientation.current=l;b.client.input.Events.add(new b.client.input.classes.event.OrientationChanged(b.client.input.Orientation.current))}}};return this.init.apply(this,arguments)};b.client.input.classes.OrientationDriver.prototype=new b.client.input.classes.Driver();return b})(tvg);tvg=(function(b){b.client.input.classes.OrientationHtml5Driver=function a(){var c=arguments.callee.prototype;this.init=function e(){c.init.call(this,"OrientationHtml5Driver");window.addEventListener("deviceorientation",this.deviceorientationEventHandler,false);b.client.input.Orientation.supported=false;return this};this.release=function f(){window.removeEventListener("deviceorientation",this.deviceorientationEventHandler,false);b.client.input.Orientation.supported=false;c.release.call(this)};this.deviceorientationEventHandler=function d(g){b.client.input.Orientation.supported|=(g.alpha||g.beta||g.gamma)?true:false;c.orientationChangedHandler(g.alpha,g.beta,g.gamma)};return this.init.apply(this,arguments)};b.client.input.classes.OrientationHtml5Driver.prototype=new b.client.input.classes.OrientationDriver();return b})(tvg);tvg=(function(b){b.client.input.classes.OrientationManualDriver=function a(){var c=arguments.callee.prototype;var e={};this.init=function d(){c.init.call(this,"OrientationManualDriver");e.movingButton=document.createElement("div");e.movingButton.style.cssText="text-align: center; vertical-align: middle; display: inline-block; width: 16px; height 16px; border: solid 1px #000;";e.movingButton.innerText="M";e.movingButton.onclick=e.onMoving;e.faceUpButton=document.createElement("div");e.faceUpButton.style.cssText="text-align: center; vertical-align: middle; display: inline-block; width: 16px; height 16px; border: solid 1px #000;";e.faceUpButton.innerText="U";e.faceUpButton.onclick=e.onFaceUp;e.faceDownButton=document.createElement("div");e.faceDownButton.style.cssText="text-align: center; vertical-align: middle; display: inline-block; width: 16px; height 16px; border: solid 1px #000;";e.faceDownButton.innerText="D";e.faceDownButton.onclick=e.onFaceDown;e.manualOrientationContainer=document.createElement("div");e.manualOrientationContainer.style.cssText="z-index: 10000; color: #fff; font-family: Arial; cursor: pointer; position: absolute; text-align: center; vertical-align: middle; display: inline-block; width: 54px; height 18px; padding: 0px";e.manualOrientationContainer.appendChild(e.movingButton);e.manualOrientationContainer.appendChild(e.faceUpButton);e.manualOrientationContainer.appendChild(e.faceDownButton);document.body.appendChild(e.manualOrientationContainer);b.client.input.Orientation.supported=true;e.onMoving();return this};this.release=function i(){document.body.removeChild(e.manualOrientationContainer);b.client.input.Orientation.supported=false;e=null;c.release.call(this)};e.onMoving=function h(){e.movingButton.style.border="solid 1px #fff";e.faceUpButton.style.border="solid 1px #000";e.faceDownButton.style.border="solid 1px #000";c.orientationChangedHandler(90,90,90)};e.onFaceUp=function g(){e.movingButton.style.border="solid 1px #000";e.faceUpButton.style.border="solid 1px #fff";e.faceDownButton.style.border="solid 1px #000";c.orientationChangedHandler(180,0,0)};e.onFaceDown=function f(){e.movingButton.style.border="solid 1px #000";e.faceUpButton.style.border="solid 1px #000";e.faceDownButton.style.border="solid 1px #fff";c.orientationChangedHandler(180,0,180)};return this.init.apply(this,arguments)};b.client.input.classes.OrientationManualDriver.prototype=new b.client.input.classes.OrientationDriver();return b})(tvg);tvg=(function(b){function a(){var e={};e.currentDrivers={};this.init=function d(){};this.release=function g(){e=null};this.load=function f(j){b.game.log.information("Loading input driver "+j.type+(j.subType?", "+j.subType:"")+".");return e.currentDrivers[j.type]=j};this.unload=function i(j){if(!e.currentDrivers[j.type]){b.game.log.warning("Input driver "+j.type+(j.subType?", "+j.subType:"")+" not loaded.");return}b.game.log.information("Unloading input driver "+j.type+(j.subType?", "+j.subType:"")+".");e.currentDrivers[j.type]=null;return};this.get=function c(j){return e.currentDrivers[j]};this.sense=function h(l){var k=Object.keys(e.currentDrivers);for(var j=0;j<k.length;j++){e.currentDrivers[k[j]].sense.call(e.currentDrivers[k[j]],l)}};return this.init.apply(this,arguments)}b.client.input.Driver=new a();return b})(tvg);tvg=(function(b){b.client.data.classes.Driver=function a(k){var f={};f.changeHandlers={};this.type=null;this.init=function e(l){this.type=l?""+l:"";return this};this.release=function g(){this.type=null;f=null;base.release.call(this)};this.get=function d(m,l){return l};this.set=function j(o,l){var m=f.changeHandlers[o];if(!m){return}for(var n=0;n<m.length;n++){m[n](l,o)}};this.remove=function h(m){var l=f.changeHandlers[m];if(l){l.length=0;delete f.changeHandlers[m]}};this.addChangeHandler=function c(n,l){var m=f.changeHandlers[n];if(!m){f.changeHandlers[n]=m=[]}m.push(l)};this.removeChangeHandler=function i(o,l){var m=f.changeHandlers[o];if(m){for(var n=0;n<m.length;n++){if(m[n]===l){m.splice(n,1);return}}}};return this.init.apply(this,arguments)};return b})(tvg);tvg=(function(b){b.client.data.classes.MemoryDriver=function a(j){var c=arguments.callee.prototype;var f={};f.data=[];this.init=function e(k){c.init.call(this,k?k:"MemoryDriver");return this};this.release=function g(){f=null;c.release.call(this)};this.get=function d(l,k){if(f.data[l]===undefined){return c.get.call(this,l,k)}return f.data[l]};this.set=function i(l,k){f.data[l]=k;c.set.call(this,l,k)};this.remove=function h(k){if(f.data[k]){delete f.data[k]}c.remove.call(this,k)};return this.init.apply(this,arguments)};b.client.data.classes.MemoryDriver.prototype=new b.client.data.classes.Driver();return b})(tvg);tvg=(function(b){b.client.data.classes.LocalStorageDriver=function a(){var c=arguments.callee.prototype;var f={};f.supported=null;f.inMemory=[];this.init=function e(){c.init.call(this,"LocalStorageDriver");f.supported="localStorage" in window&&window.localStorage!==null;return this};this.release=function g(){f=null;c.release.call(this)};this.get=function d(l,k){if(!f.inMemory[l]&&f.supported){if(localStorage[""+l]===undefined){return k}var j=JSON.parse(localStorage[""+l]);c.set.call(this,l,j);f.inMemory[l]=true;return j}return c.get.call(this,l,k)};this.set=function i(k,j){if(f.supported){localStorage[""+k]=JSON.stringify(j)}c.set.call(this,k,j);f.inMemory[k]=true};this.remove=function h(j){if(f.supported){localStorage.removeItem[""+j]}c.remove.call(this,j);delete f.inMemory[j]};return this.init.apply(this,arguments)};b.client.data.classes.LocalStorageDriver.prototype=new b.client.data.classes.MemoryDriver();return b})(tvg);tvg=(function(b){function a(){this.current=null;this.init=function d(){this.current=null};this.release=function f(){this.current.release();this.current=null};this.load=function e(g){b.game.log.information("Loading data driver "+g.type+".");if(this.current){this.current.release();this.current=null}return this.current=g};this.get=function c(){return this.current};return this.init.apply(this,arguments)}b.client.data.Driver=new a();return b})(tvg);tvg=(function(tvg){tvg.client.util.classes.QrCodeUtility=function QrCodeUtility(){var QRCode;(function(){function QR8bitByte(data){this.mode=QRMode.MODE_8BIT_BYTE;this.data=data;this.parsedData=[];for(var i=0,l=this.data.length;i<l;i++){var byteArray=[];var code=this.data.charCodeAt(i);if(code>65536){byteArray[0]=240|((code&1835008)>>>18);byteArray[1]=128|((code&258048)>>>12);byteArray[2]=128|((code&4032)>>>6);byteArray[3]=128|(code&63)}else{if(code>2048){byteArray[0]=224|((code&61440)>>>12);byteArray[1]=128|((code&4032)>>>6);byteArray[2]=128|(code&63)}else{if(code>128){byteArray[0]=192|((code&1984)>>>6);byteArray[1]=128|(code&63)}else{byteArray[0]=code}}}this.parsedData.push(byteArray)}this.parsedData=Array.prototype.concat.apply([],this.parsedData);if(this.parsedData.length!=this.data.length){this.parsedData.unshift(191);this.parsedData.unshift(187);this.parsedData.unshift(239)}}QR8bitByte.prototype={getLength:function(buffer){return this.parsedData.length},write:function(buffer){for(var i=0,l=this.parsedData.length;i<l;i++){buffer.put(this.parsedData[i],8)}}};function QRCodeModel(typeNumber,errorCorrectLevel){this.typeNumber=typeNumber;this.errorCorrectLevel=errorCorrectLevel;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}QRCodeModel.prototype={addData:function(data){var newData=new QR8bitByte(data);this.dataList.push(newData);this.dataCache=null},isDark:function(row,col){if(row<0||this.moduleCount<=row||col<0||this.moduleCount<=col){throw new Error(row+","+col)}return this.modules[row][col]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(false,this.getBestMaskPattern())},makeImpl:function(test,maskPattern){this.moduleCount=this.typeNumber*4+17;this.modules=new Array(this.moduleCount);for(var row=0;row<this.moduleCount;row++){this.modules[row]=new Array(this.moduleCount);for(var col=0;col<this.moduleCount;col++){this.modules[row][col]=null}}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(test,maskPattern);if(this.typeNumber>=7){this.setupTypeNumber(test)}if(this.dataCache==null){this.dataCache=QRCodeModel.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)}this.mapData(this.dataCache,maskPattern)},setupPositionProbePattern:function(row,col){for(var r=-1;r<=7;r++){if(row+r<=-1||this.moduleCount<=row+r){continue}for(var c=-1;c<=7;c++){if(col+c<=-1||this.moduleCount<=col+c){continue}if((0<=r&&r<=6&&(c==0||c==6))||(0<=c&&c<=6&&(r==0||r==6))||(2<=r&&r<=4&&2<=c&&c<=4)){this.modules[row+r][col+c]=true}else{this.modules[row+r][col+c]=false}}}},getBestMaskPattern:function(){var minLostPoint=0;var pattern=0;for(var i=0;i<8;i++){this.makeImpl(true,i);var lostPoint=QRUtil.getLostPoint(this);if(i==0||minLostPoint>lostPoint){minLostPoint=lostPoint;pattern=i}}return pattern},createMovieClip:function(target_mc,instance_name,depth){var qr_mc=target_mc.createEmptyMovieClip(instance_name,depth);var cs=1;this.make();for(var row=0;row<this.modules.length;row++){var y=row*cs;for(var col=0;col<this.modules[row].length;col++){var x=col*cs;var dark=this.modules[row][col];if(dark){qr_mc.beginFill(0,100);qr_mc.moveTo(x,y);qr_mc.lineTo(x+cs,y);qr_mc.lineTo(x+cs,y+cs);qr_mc.lineTo(x,y+cs);qr_mc.endFill()}}}return qr_mc},setupTimingPattern:function(){for(var r=8;r<this.moduleCount-8;r++){if(this.modules[r][6]!=null){continue}this.modules[r][6]=(r%2==0)}for(var c=8;c<this.moduleCount-8;c++){if(this.modules[6][c]!=null){continue}this.modules[6][c]=(c%2==0)}},setupPositionAdjustPattern:function(){var pos=QRUtil.getPatternPosition(this.typeNumber);for(var i=0;i<pos.length;i++){for(var j=0;j<pos.length;j++){var row=pos[i];var col=pos[j];if(this.modules[row][col]!=null){continue}for(var r=-2;r<=2;r++){for(var c=-2;c<=2;c++){if(r==-2||r==2||c==-2||c==2||(r==0&&c==0)){this.modules[row+r][col+c]=true}else{this.modules[row+r][col+c]=false}}}}}},setupTypeNumber:function(test){var bits=QRUtil.getBCHTypeNumber(this.typeNumber);for(var i=0;i<18;i++){var mod=(!test&&((bits>>i)&1)==1);this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=mod}for(var i=0;i<18;i++){var mod=(!test&&((bits>>i)&1)==1);this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=mod}},setupTypeInfo:function(test,maskPattern){var data=(this.errorCorrectLevel<<3)|maskPattern;var bits=QRUtil.getBCHTypeInfo(data);for(var i=0;i<15;i++){var mod=(!test&&((bits>>i)&1)==1);if(i<6){this.modules[i][8]=mod}else{if(i<8){this.modules[i+1][8]=mod}else{this.modules[this.moduleCount-15+i][8]=mod}}}for(var i=0;i<15;i++){var mod=(!test&&((bits>>i)&1)==1);if(i<8){this.modules[8][this.moduleCount-i-1]=mod}else{if(i<9){this.modules[8][15-i-1+1]=mod}else{this.modules[8][15-i-1]=mod}}}this.modules[this.moduleCount-8][8]=(!test)},mapData:function(data,maskPattern){var inc=-1;var row=this.moduleCount-1;var bitIndex=7;var byteIndex=0;for(var col=this.moduleCount-1;col>0;col-=2){if(col==6){col--}while(true){for(var c=0;c<2;c++){if(this.modules[row][col-c]==null){var dark=false;if(byteIndex<data.length){dark=(((data[byteIndex]>>>bitIndex)&1)==1)}var mask=QRUtil.getMask(maskPattern,row,col-c);if(mask){dark=!dark}this.modules[row][col-c]=dark;bitIndex--;if(bitIndex==-1){byteIndex++;bitIndex=7}}}row+=inc;if(row<0||this.moduleCount<=row){row-=inc;inc=-inc;break}}}}};QRCodeModel.PAD0=236;QRCodeModel.PAD1=17;QRCodeModel.createData=function(typeNumber,errorCorrectLevel,dataList){var rsBlocks=QRRSBlock.getRSBlocks(typeNumber,errorCorrectLevel);var buffer=new QRBitBuffer();for(var i=0;i<dataList.length;i++){var data=dataList[i];buffer.put(data.mode,4);buffer.put(data.getLength(),QRUtil.getLengthInBits(data.mode,typeNumber));data.write(buffer)}var totalDataCount=0;for(var i=0;i<rsBlocks.length;i++){totalDataCount+=rsBlocks[i].dataCount}if(buffer.getLengthInBits()>totalDataCount*8){throw new Error("code length overflow. ("+buffer.getLengthInBits()+">"+totalDataCount*8+")")}if(buffer.getLengthInBits()+4<=totalDataCount*8){buffer.put(0,4)}while(buffer.getLengthInBits()%8!=0){buffer.putBit(false)}while(true){if(buffer.getLengthInBits()>=totalDataCount*8){break}buffer.put(QRCodeModel.PAD0,8);if(buffer.getLengthInBits()>=totalDataCount*8){break}buffer.put(QRCodeModel.PAD1,8)}return QRCodeModel.createBytes(buffer,rsBlocks)};QRCodeModel.createBytes=function(buffer,rsBlocks){var offset=0;var maxDcCount=0;var maxEcCount=0;var dcdata=new Array(rsBlocks.length);var ecdata=new Array(rsBlocks.length);for(var r=0;r<rsBlocks.length;r++){var dcCount=rsBlocks[r].dataCount;var ecCount=rsBlocks[r].totalCount-dcCount;maxDcCount=Math.max(maxDcCount,dcCount);maxEcCount=Math.max(maxEcCount,ecCount);dcdata[r]=new Array(dcCount);for(var i=0;i<dcdata[r].length;i++){dcdata[r][i]=255&buffer.buffer[i+offset]}offset+=dcCount;var rsPoly=QRUtil.getErrorCorrectPolynomial(ecCount);var rawPoly=new QRPolynomial(dcdata[r],rsPoly.getLength()-1);var modPoly=rawPoly.mod(rsPoly);ecdata[r]=new Array(rsPoly.getLength()-1);for(var i=0;i<ecdata[r].length;i++){var modIndex=i+modPoly.getLength()-ecdata[r].length;ecdata[r][i]=(modIndex>=0)?modPoly.get(modIndex):0}}var totalCodeCount=0;for(var i=0;i<rsBlocks.length;i++){totalCodeCount+=rsBlocks[i].totalCount}var data=new Array(totalCodeCount);var index=0;for(var i=0;i<maxDcCount;i++){for(var r=0;r<rsBlocks.length;r++){if(i<dcdata[r].length){data[index++]=dcdata[r][i]}}}for(var i=0;i<maxEcCount;i++){for(var r=0;r<rsBlocks.length;r++){if(i<ecdata[r].length){data[index++]=ecdata[r][i]}}}return data};var QRMode={MODE_NUMBER:1<<0,MODE_ALPHA_NUM:1<<1,MODE_8BIT_BYTE:1<<2,MODE_KANJI:1<<3};var QRErrorCorrectLevel={L:1,M:0,Q:3,H:2};var QRMaskPattern={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var QRUtil={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:(1<<10)|(1<<8)|(1<<5)|(1<<4)|(1<<2)|(1<<1)|(1<<0),G18:(1<<12)|(1<<11)|(1<<10)|(1<<9)|(1<<8)|(1<<5)|(1<<2)|(1<<0),G15_MASK:(1<<14)|(1<<12)|(1<<10)|(1<<4)|(1<<1),getBCHTypeInfo:function(data){var d=data<<10;while(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G15)>=0){d^=(QRUtil.G15<<(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G15)))}return((data<<10)|d)^QRUtil.G15_MASK},getBCHTypeNumber:function(data){var d=data<<12;while(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G18)>=0){d^=(QRUtil.G18<<(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G18)))}return(data<<12)|d},getBCHDigit:function(data){var digit=0;while(data!=0){digit++;data>>>=1}return digit},getPatternPosition:function(typeNumber){return QRUtil.PATTERN_POSITION_TABLE[typeNumber-1]},getMask:function(maskPattern,i,j){switch(maskPattern){case QRMaskPattern.PATTERN000:return(i+j)%2==0;case QRMaskPattern.PATTERN001:return i%2==0;case QRMaskPattern.PATTERN010:return j%3==0;case QRMaskPattern.PATTERN011:return(i+j)%3==0;case QRMaskPattern.PATTERN100:return(Math.floor(i/2)+Math.floor(j/3))%2==0;case QRMaskPattern.PATTERN101:return(i*j)%2+(i*j)%3==0;case QRMaskPattern.PATTERN110:return((i*j)%2+(i*j)%3)%2==0;case QRMaskPattern.PATTERN111:return((i*j)%3+(i+j)%2)%2==0;default:throw new Error("bad maskPattern:"+maskPattern)}},getErrorCorrectPolynomial:function(errorCorrectLength){var a=new QRPolynomial([1],0);for(var i=0;i<errorCorrectLength;i++){a=a.multiply(new QRPolynomial([1,QRMath.gexp(i)],0))}return a},getLengthInBits:function(mode,type){if(1<=type&&type<10){switch(mode){case QRMode.MODE_NUMBER:return 10;case QRMode.MODE_ALPHA_NUM:return 9;case QRMode.MODE_8BIT_BYTE:return 8;case QRMode.MODE_KANJI:return 8;default:throw new Error("mode:"+mode)}}else{if(type<27){switch(mode){case QRMode.MODE_NUMBER:return 12;case QRMode.MODE_ALPHA_NUM:return 11;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 10;default:throw new Error("mode:"+mode)}}else{if(type<41){switch(mode){case QRMode.MODE_NUMBER:return 14;case QRMode.MODE_ALPHA_NUM:return 13;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 12;default:throw new Error("mode:"+mode)}}else{throw new Error("type:"+type)}}}},getLostPoint:function(qrCode){var moduleCount=qrCode.getModuleCount();var lostPoint=0;for(var row=0;row<moduleCount;row++){for(var col=0;col<moduleCount;col++){var sameCount=0;var dark=qrCode.isDark(row,col);for(var r=-1;r<=1;r++){if(row+r<0||moduleCount<=row+r){continue}for(var c=-1;c<=1;c++){if(col+c<0||moduleCount<=col+c){continue}if(r==0&&c==0){continue}if(dark==qrCode.isDark(row+r,col+c)){sameCount++}}}if(sameCount>5){lostPoint+=(3+sameCount-5)}}}for(var row=0;row<moduleCount-1;row++){for(var col=0;col<moduleCount-1;col++){var count=0;if(qrCode.isDark(row,col)){count++}if(qrCode.isDark(row+1,col)){count++}if(qrCode.isDark(row,col+1)){count++}if(qrCode.isDark(row+1,col+1)){count++}if(count==0||count==4){lostPoint+=3}}}for(var row=0;row<moduleCount;row++){for(var col=0;col<moduleCount-6;col++){if(qrCode.isDark(row,col)&&!qrCode.isDark(row,col+1)&&qrCode.isDark(row,col+2)&&qrCode.isDark(row,col+3)&&qrCode.isDark(row,col+4)&&!qrCode.isDark(row,col+5)&&qrCode.isDark(row,col+6)){lostPoint+=40}}}for(var col=0;col<moduleCount;col++){for(var row=0;row<moduleCount-6;row++){if(qrCode.isDark(row,col)&&!qrCode.isDark(row+1,col)&&qrCode.isDark(row+2,col)&&qrCode.isDark(row+3,col)&&qrCode.isDark(row+4,col)&&!qrCode.isDark(row+5,col)&&qrCode.isDark(row+6,col)){lostPoint+=40}}}var darkCount=0;for(var col=0;col<moduleCount;col++){for(var row=0;row<moduleCount;row++){if(qrCode.isDark(row,col)){darkCount++}}}var ratio=Math.abs(100*darkCount/moduleCount/moduleCount-50)/5;lostPoint+=ratio*10;return lostPoint}};var QRMath={glog:function(n){if(n<1){throw new Error("glog("+n+")")}return QRMath.LOG_TABLE[n]},gexp:function(n){while(n<0){n+=255}while(n>=256){n-=255}return QRMath.EXP_TABLE[n]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var i=0;i<8;i++){QRMath.EXP_TABLE[i]=1<<i}for(var i=8;i<256;i++){QRMath.EXP_TABLE[i]=QRMath.EXP_TABLE[i-4]^QRMath.EXP_TABLE[i-5]^QRMath.EXP_TABLE[i-6]^QRMath.EXP_TABLE[i-8]}for(var i=0;i<255;i++){QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]]=i}function QRPolynomial(num,shift){if(num.length==undefined){throw new Error(num.length+"/"+shift)}var offset=0;while(offset<num.length&&num[offset]==0){offset++}this.num=new Array(num.length-offset+shift);for(var i=0;i<num.length-offset;i++){this.num[i]=num[i+offset]}}QRPolynomial.prototype={get:function(index){return this.num[index]},getLength:function(){return this.num.length},multiply:function(e){var num=new Array(this.getLength()+e.getLength()-1);for(var i=0;i<this.getLength();i++){for(var j=0;j<e.getLength();j++){num[i+j]^=QRMath.gexp(QRMath.glog(this.get(i))+QRMath.glog(e.get(j)))}}return new QRPolynomial(num,0)},mod:function(e){if(this.getLength()-e.getLength()<0){return this}var ratio=QRMath.glog(this.get(0))-QRMath.glog(e.get(0));var num=new Array(this.getLength());for(var i=0;i<this.getLength();i++){num[i]=this.get(i)}for(var i=0;i<e.getLength();i++){num[i]^=QRMath.gexp(QRMath.glog(e.get(i))+ratio)}return new QRPolynomial(num,0).mod(e)}};function QRRSBlock(totalCount,dataCount){this.totalCount=totalCount;this.dataCount=dataCount}QRRSBlock.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];QRRSBlock.getRSBlocks=function(typeNumber,errorCorrectLevel){var rsBlock=QRRSBlock.getRsBlockTable(typeNumber,errorCorrectLevel);if(rsBlock==undefined){throw new Error("bad rs block @ typeNumber:"+typeNumber+"/errorCorrectLevel:"+errorCorrectLevel)}var length=rsBlock.length/3;var list=[];for(var i=0;i<length;i++){var count=rsBlock[i*3+0];var totalCount=rsBlock[i*3+1];var dataCount=rsBlock[i*3+2];for(var j=0;j<count;j++){list.push(new QRRSBlock(totalCount,dataCount))}}return list};QRRSBlock.getRsBlockTable=function(typeNumber,errorCorrectLevel){switch(errorCorrectLevel){case QRErrorCorrectLevel.L:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+0];case QRErrorCorrectLevel.M:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+1];case QRErrorCorrectLevel.Q:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+2];case QRErrorCorrectLevel.H:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+3];default:return undefined}};function QRBitBuffer(){this.buffer=[];this.length=0}QRBitBuffer.prototype={get:function(index){var bufIndex=Math.floor(index/8);return((this.buffer[bufIndex]>>>(7-index%8))&1)==1},put:function(num,length){for(var i=0;i<length;i++){this.putBit(((num>>>(length-i-1))&1)==1)}},getLengthInBits:function(){return this.length},putBit:function(bit){var bufIndex=Math.floor(this.length/8);if(this.buffer.length<=bufIndex){this.buffer.push(0)}if(bit){this.buffer[bufIndex]|=(128>>>(this.length%8))}this.length++}};var QRCodeLimitLength=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];function _isSupportCanvas(){return typeof CanvasRenderingContext2D!="undefined"}function _getAndroid(){var android=false;var sAgent=navigator.userAgent;if(/android/i.test(sAgent)){android=true;var aMat=sAgent.toString().match(/android ([0-9]\.[0-9])/i);if(aMat&&aMat[1]){android=parseFloat(aMat[1])}}return android}var svgDrawer=(function(){var Drawing=function(el,htOption){this._el=el;this._htOption=htOption};Drawing.prototype.draw=function(oQRCode){var _htOption=this._htOption;var _el=this._el;var nCount=oQRCode.getModuleCount();var nWidth=Math.floor(_htOption.width/nCount);var nHeight=Math.floor(_htOption.height/nCount);this.clear();function makeSVG(tag,attrs){var el=document.createElementNS("http://www.w3.org/2000/svg",tag);for(var k in attrs){if(attrs.hasOwnProperty(k)){el.setAttribute(k,attrs[k])}}return el}var svg=makeSVG("svg",{viewBox:"0 0 "+String(nCount)+" "+String(nCount),width:"100%",height:"100%",fill:_htOption.colorLight});svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");_el.appendChild(svg);svg.appendChild(makeSVG("rect",{fill:_htOption.colorLight,width:"100%",height:"100%"}));svg.appendChild(makeSVG("rect",{fill:_htOption.colorDark,width:"1",height:"1",id:"template"}));for(var row=0;row<nCount;row++){for(var col=0;col<nCount;col++){if(oQRCode.isDark(row,col)){var child=makeSVG("use",{x:String(row),y:String(col)});child.setAttributeNS("http://www.w3.org/1999/xlink","href","#template");svg.appendChild(child)}}}};Drawing.prototype.clear=function(){while(this._el.hasChildNodes()){this._el.removeChild(this._el.lastChild)}};return Drawing})();var useSVG=document.documentElement.tagName.toLowerCase()==="svg";var Drawing=useSVG?svgDrawer:!_isSupportCanvas()?(function(){var Drawing=function(el,htOption){this._el=el;this._htOption=htOption};Drawing.prototype.draw=function(oQRCode){var _htOption=this._htOption;var _el=this._el;var nCount=oQRCode.getModuleCount();var nWidth=Math.floor(_htOption.width/nCount);var nHeight=Math.floor(_htOption.height/nCount);var aHTML=['<table style="border:0;border-collapse:collapse;">'];for(var row=0;row<nCount;row++){aHTML.push("<tr>");for(var col=0;col<nCount;col++){aHTML.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+nWidth+"px;height:"+nHeight+"px;background-color:"+(oQRCode.isDark(row,col)?_htOption.colorDark:_htOption.colorLight)+';"></td>')}aHTML.push("</tr>")}aHTML.push("</table>");_el.innerHTML=aHTML.join("");var elTable=_el.childNodes[0];var nLeftMarginTable=(_htOption.width-elTable.offsetWidth)/2;var nTopMarginTable=(_htOption.height-elTable.offsetHeight)/2;if(nLeftMarginTable>0&&nTopMarginTable>0){elTable.style.margin=nTopMarginTable+"px "+nLeftMarginTable+"px"}};Drawing.prototype.clear=function(){this._el.innerHTML=""};return Drawing})():(function(){function _onMakeImage(){this._elImage.src=this._elCanvas.toDataURL("image/png");this._elImage.style.display="block";this._elCanvas.style.display="none"}if(this._android&&this._android<=2.1){var factor=1/window.devicePixelRatio;var drawImage=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(image,sx,sy,sw,sh,dx,dy,dw,dh){if(("nodeName" in image)&&/img/i.test(image.nodeName)){for(var i=arguments.length-1;i>=1;i--){arguments[i]=arguments[i]*factor}}else{if(typeof dw=="undefined"){arguments[1]*=factor;arguments[2]*=factor;arguments[3]*=factor;arguments[4]*=factor}}drawImage.apply(this,arguments)}}function _safeSetDataURI(fSuccess,fFail){var self=this;self._fFail=fFail;self._fSuccess=fSuccess;if(self._bSupportDataURI===null){var el=document.createElement("img");var fOnError=function(){self._bSupportDataURI=false;if(self._fFail){self._fFail.call(self)}};var fOnSuccess=function(){self._bSupportDataURI=true;if(self._fSuccess){self._fSuccess.call(self)}};el.onabort=fOnError;el.onerror=fOnError;el.onload=fOnSuccess;el.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==";return}else{if(self._bSupportDataURI===true&&self._fSuccess){self._fSuccess.call(self)}else{if(self._bSupportDataURI===false&&self._fFail){self._fFail.call(self)}}}}var Drawing=function(el,htOption){this._bIsPainted=false;this._android=_getAndroid();this._htOption=htOption;this._elCanvas=document.createElement("canvas");this._elCanvas.width=htOption.width;this._elCanvas.height=htOption.height;el.appendChild(this._elCanvas);this._el=el;this._oContext=this._elCanvas.getContext("2d");this._bIsPainted=false;this._elImage=document.createElement("img");this._elImage.alt="Scan me!";this._elImage.style.display="none";this._el.appendChild(this._elImage);this._bSupportDataURI=null};Drawing.prototype.draw=function(oQRCode){var _elImage=this._elImage;var _oContext=this._oContext;var _htOption=this._htOption;var nCount=oQRCode.getModuleCount();var nWidth=_htOption.width/nCount;var nHeight=_htOption.height/nCount;var nRoundedWidth=Math.round(nWidth);var nRoundedHeight=Math.round(nHeight);_elImage.style.display="none";this.clear();for(var row=0;row<nCount;row++){for(var col=0;col<nCount;col++){var bIsDark=oQRCode.isDark(row,col);var nLeft=col*nWidth;var nTop=row*nHeight;_oContext.strokeStyle=bIsDark?_htOption.colorDark:_htOption.colorLight;_oContext.lineWidth=1;_oContext.fillStyle=bIsDark?_htOption.colorDark:_htOption.colorLight;_oContext.fillRect(nLeft,nTop,nWidth,nHeight);_oContext.strokeRect(Math.floor(nLeft)+0.5,Math.floor(nTop)+0.5,nRoundedWidth,nRoundedHeight);_oContext.strokeRect(Math.ceil(nLeft)-0.5,Math.ceil(nTop)-0.5,nRoundedWidth,nRoundedHeight)}}this._bIsPainted=true};Drawing.prototype.makeImage=function(){if(this._bIsPainted){_safeSetDataURI.call(this,_onMakeImage)}};Drawing.prototype.isPainted=function(){return this._bIsPainted};Drawing.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height);this._bIsPainted=false};Drawing.prototype.round=function(nNumber){if(!nNumber){return nNumber}return Math.floor(nNumber*1000)/1000};return Drawing})();function _getTypeNumber(sText,nCorrectLevel){var nType=1;var length=_getUTF8Length(sText);for(var i=0,len=QRCodeLimitLength.length;i<=len;i++){var nLimit=0;switch(nCorrectLevel){case QRErrorCorrectLevel.L:nLimit=QRCodeLimitLength[i][0];break;case QRErrorCorrectLevel.M:nLimit=QRCodeLimitLength[i][1];break;case QRErrorCorrectLevel.Q:nLimit=QRCodeLimitLength[i][2];break;case QRErrorCorrectLevel.H:nLimit=QRCodeLimitLength[i][3];break}if(length<=nLimit){break}else{nType++}}if(nType>QRCodeLimitLength.length){throw new Error("Too long data")}return nType}function _getUTF8Length(sText){var replacedText=encodeURI(sText).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return replacedText.length+(replacedText.length!=sText?3:0)}QRCode=function(el,vOption){this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRErrorCorrectLevel.H};if(typeof vOption==="string"){vOption={text:vOption}}if(vOption){for(var i in vOption){this._htOption[i]=vOption[i]}}if(typeof el=="string"){el=document.getElementById(el)}if(this._htOption.useSVG){Drawing=svgDrawer}this._android=_getAndroid();this._el=el;this._oQRCode=null;this._oDrawing=new Drawing(this._el,this._htOption);if(this._htOption.text){this.makeCode(this._htOption.text)}};QRCode.prototype.makeCode=function(sText){this._oQRCode=new QRCodeModel(_getTypeNumber(sText,this._htOption.correctLevel),this._htOption.correctLevel);this._oQRCode.addData(sText);this._oQRCode.make();this._el.title=sText;this._oDrawing.draw(this._oQRCode);this.makeImage()};QRCode.prototype.makeImage=function(){if(typeof this._oDrawing.makeImage=="function"&&(!this._android||this._android>=3)){this._oDrawing.makeImage()}};QRCode.prototype.clear=function(){this._oDrawing.clear()};QRCode.CorrectLevel=QRErrorCorrectLevel})();var QRReader=new (function QRReader(){GridSampler={};GridSampler.checkAndNudgePoints=function(image,points){var width=qrcode.width;var height=qrcode.height;var nudged=true;for(var offset=0;offset<points.length&&nudged;offset+=2){var x=Math.floor(points[offset]);var y=Math.floor(points[offset+1]);if(x<-1||x>width||y<-1||y>height){throw"Error.checkAndNudgePoints "}nudged=false;if(x==-1){points[offset]=0;nudged=true}else{if(x==width){points[offset]=width-1;nudged=true}}if(y==-1){points[offset+1]=0;nudged=true}else{if(y==height){points[offset+1]=height-1;nudged=true}}}nudged=true;for(var offset=points.length-2;offset>=0&&nudged;offset-=2){var x=Math.floor(points[offset]);var y=Math.floor(points[offset+1]);if(x<-1||x>width||y<-1||y>height){throw"Error.checkAndNudgePoints "}nudged=false;if(x==-1){points[offset]=0;nudged=true}else{if(x==width){points[offset]=width-1;nudged=true}}if(y==-1){points[offset+1]=0;nudged=true}else{if(y==height){points[offset+1]=height-1;nudged=true}}}};GridSampler.sampleGrid3=function(image,dimension,transform){var bits=new BitMatrix(dimension);var points=new Array(dimension<<1);for(var y=0;y<dimension;y++){var max=points.length;var iValue=y+0.5;for(var x=0;x<max;x+=2){points[x]=(x>>1)+0.5;points[x+1]=iValue}transform.transformPoints1(points);GridSampler.checkAndNudgePoints(image,points);try{for(var x=0;x<max;x+=2){var xpoint=(Math.floor(points[x])*4)+(Math.floor(points[x+1])*qrcode.width*4);var bit=image[Math.floor(points[x])+qrcode.width*Math.floor(points[x+1])];qrcode.imagedata.data[xpoint]=bit?255:0;qrcode.imagedata.data[xpoint+1]=bit?255:0;qrcode.imagedata.data[xpoint+2]=0;qrcode.imagedata.data[xpoint+3]=255;if(bit){bits.set_Renamed(x>>1,y)}}}catch(aioobe){throw"Error.checkAndNudgePoints"}}return bits};GridSampler.sampleGridx=function(image,dimension,p1ToX,p1ToY,p2ToX,p2ToY,p3ToX,p3ToY,p4ToX,p4ToY,p1FromX,p1FromY,p2FromX,p2FromY,p3FromX,p3FromY,p4FromX,p4FromY){var transform=PerspectiveTransform.quadrilateralToQuadrilateral(p1ToX,p1ToY,p2ToX,p2ToY,p3ToX,p3ToY,p4ToX,p4ToY,p1FromX,p1FromY,p2FromX,p2FromY,p3FromX,p3FromY,p4FromX,p4FromY);return GridSampler.sampleGrid3(image,dimension,transform)};function ECB(count,dataCodewords){this.count=count;this.dataCodewords=dataCodewords;this.__defineGetter__("Count",function(){return this.count});this.__defineGetter__("DataCodewords",function(){return this.dataCodewords})}function ECBlocks(ecCodewordsPerBlock,ecBlocks1,ecBlocks2){this.ecCodewordsPerBlock=ecCodewordsPerBlock;if(ecBlocks2){this.ecBlocks=new Array(ecBlocks1,ecBlocks2)}else{this.ecBlocks=new Array(ecBlocks1)}this.__defineGetter__("ECCodewordsPerBlock",function(){return this.ecCodewordsPerBlock});this.__defineGetter__("TotalECCodewords",function(){return this.ecCodewordsPerBlock*this.NumBlocks});this.__defineGetter__("NumBlocks",function(){var total=0;for(var i=0;i<this.ecBlocks.length;i++){total+=this.ecBlocks[i].length}return total});this.getECBlocks=function(){return this.ecBlocks}}function Version(versionNumber,alignmentPatternCenters,ecBlocks1,ecBlocks2,ecBlocks3,ecBlocks4){this.versionNumber=versionNumber;this.alignmentPatternCenters=alignmentPatternCenters;this.ecBlocks=new Array(ecBlocks1,ecBlocks2,ecBlocks3,ecBlocks4);var total=0;var ecCodewords=ecBlocks1.ECCodewordsPerBlock;var ecbArray=ecBlocks1.getECBlocks();for(var i=0;i<ecbArray.length;i++){var ecBlock=ecbArray[i];total+=ecBlock.Count*(ecBlock.DataCodewords+ecCodewords)}this.totalCodewords=total;this.__defineGetter__("VersionNumber",function(){return this.versionNumber});this.__defineGetter__("AlignmentPatternCenters",function(){return this.alignmentPatternCenters});this.__defineGetter__("TotalCodewords",function(){return this.totalCodewords});this.__defineGetter__("DimensionForVersion",function(){return 17+4*this.versionNumber});this.buildFunctionPattern=function(){var dimension=this.DimensionForVersion;var bitMatrix=new BitMatrix(dimension);bitMatrix.setRegion(0,0,9,9);bitMatrix.setRegion(dimension-8,0,8,9);bitMatrix.setRegion(0,dimension-8,9,8);var max=this.alignmentPatternCenters.length;for(var x=0;x<max;x++){var i=this.alignmentPatternCenters[x]-2;for(var y=0;y<max;y++){if((x==0&&(y==0||y==max-1))||(x==max-1&&y==0)){continue}bitMatrix.setRegion(this.alignmentPatternCenters[y]-2,i,5,5)}}bitMatrix.setRegion(6,9,1,dimension-17);bitMatrix.setRegion(9,6,dimension-17,1);if(this.versionNumber>6){bitMatrix.setRegion(dimension-11,0,3,6);bitMatrix.setRegion(0,dimension-11,6,3)}return bitMatrix};this.getECBlocksForLevel=function(ecLevel){return this.ecBlocks[ecLevel.ordinal()]}}Version.VERSION_DECODE_INFO=new Array(31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017);Version.VERSIONS=buildVersions();Version.getVersionForNumber=function(versionNumber){if(versionNumber<1||versionNumber>40){throw"ArgumentException"}return Version.VERSIONS[versionNumber-1]};Version.getProvisionalVersionForDimension=function(dimension){if(dimension%4!=1){throw"Error getProvisionalVersionForDimension"}try{return Version.getVersionForNumber((dimension-17)>>2)}catch(iae){throw"Error getVersionForNumber"}};Version.decodeVersionInformation=function(versionBits){var bestDifference=4294967295;var bestVersion=0;for(var i=0;i<Version.VERSION_DECODE_INFO.length;i++){var targetVersion=Version.VERSION_DECODE_INFO[i];if(targetVersion==versionBits){return this.getVersionForNumber(i+7)}var bitsDifference=FormatInformation.numBitsDiffering(versionBits,targetVersion);if(bitsDifference<bestDifference){bestVersion=i+7;bestDifference=bitsDifference}}if(bestDifference<=3){return this.getVersionForNumber(bestVersion)}return null};function buildVersions(){return new Array(new Version(1,new Array(),new ECBlocks(7,new ECB(1,19)),new ECBlocks(10,new ECB(1,16)),new ECBlocks(13,new ECB(1,13)),new ECBlocks(17,new ECB(1,9))),new Version(2,new Array(6,18),new ECBlocks(10,new ECB(1,34)),new ECBlocks(16,new ECB(1,28)),new ECBlocks(22,new ECB(1,22)),new ECBlocks(28,new ECB(1,16))),new Version(3,new Array(6,22),new ECBlocks(15,new ECB(1,55)),new ECBlocks(26,new ECB(1,44)),new ECBlocks(18,new ECB(2,17)),new ECBlocks(22,new ECB(2,13))),new Version(4,new Array(6,26),new ECBlocks(20,new ECB(1,80)),new ECBlocks(18,new ECB(2,32)),new ECBlocks(26,new ECB(2,24)),new ECBlocks(16,new ECB(4,9))),new Version(5,new Array(6,30),new ECBlocks(26,new ECB(1,108)),new ECBlocks(24,new ECB(2,43)),new ECBlocks(18,new ECB(2,15),new ECB(2,16)),new ECBlocks(22,new ECB(2,11),new ECB(2,12))),new Version(6,new Array(6,34),new ECBlocks(18,new ECB(2,68)),new ECBlocks(16,new ECB(4,27)),new ECBlocks(24,new ECB(4,19)),new ECBlocks(28,new ECB(4,15))),new Version(7,new Array(6,22,38),new ECBlocks(20,new ECB(2,78)),new ECBlocks(18,new ECB(4,31)),new ECBlocks(18,new ECB(2,14),new ECB(4,15)),new ECBlocks(26,new ECB(4,13),new ECB(1,14))),new Version(8,new Array(6,24,42),new ECBlocks(24,new ECB(2,97)),new ECBlocks(22,new ECB(2,38),new ECB(2,39)),new ECBlocks(22,new ECB(4,18),new ECB(2,19)),new ECBlocks(26,new ECB(4,14),new ECB(2,15))),new Version(9,new Array(6,26,46),new ECBlocks(30,new ECB(2,116)),new ECBlocks(22,new ECB(3,36),new ECB(2,37)),new ECBlocks(20,new ECB(4,16),new ECB(4,17)),new ECBlocks(24,new ECB(4,12),new ECB(4,13))),new Version(10,new Array(6,28,50),new ECBlocks(18,new ECB(2,68),new ECB(2,69)),new ECBlocks(26,new ECB(4,43),new ECB(1,44)),new ECBlocks(24,new ECB(6,19),new ECB(2,20)),new ECBlocks(28,new ECB(6,15),new ECB(2,16))),new Version(11,new Array(6,30,54),new ECBlocks(20,new ECB(4,81)),new ECBlocks(30,new ECB(1,50),new ECB(4,51)),new ECBlocks(28,new ECB(4,22),new ECB(4,23)),new ECBlocks(24,new ECB(3,12),new ECB(8,13))),new Version(12,new Array(6,32,58),new ECBlocks(24,new ECB(2,92),new ECB(2,93)),new ECBlocks(22,new ECB(6,36),new ECB(2,37)),new ECBlocks(26,new ECB(4,20),new ECB(6,21)),new ECBlocks(28,new ECB(7,14),new ECB(4,15))),new Version(13,new Array(6,34,62),new ECBlocks(26,new ECB(4,107)),new ECBlocks(22,new ECB(8,37),new ECB(1,38)),new ECBlocks(24,new ECB(8,20),new ECB(4,21)),new ECBlocks(22,new ECB(12,11),new ECB(4,12))),new Version(14,new Array(6,26,46,66),new ECBlocks(30,new ECB(3,115),new ECB(1,116)),new ECBlocks(24,new ECB(4,40),new ECB(5,41)),new ECBlocks(20,new ECB(11,16),new ECB(5,17)),new ECBlocks(24,new ECB(11,12),new ECB(5,13))),new Version(15,new Array(6,26,48,70),new ECBlocks(22,new ECB(5,87),new ECB(1,88)),new ECBlocks(24,new ECB(5,41),new ECB(5,42)),new ECBlocks(30,new ECB(5,24),new ECB(7,25)),new ECBlocks(24,new ECB(11,12),new ECB(7,13))),new Version(16,new Array(6,26,50,74),new ECBlocks(24,new ECB(5,98),new ECB(1,99)),new ECBlocks(28,new ECB(7,45),new ECB(3,46)),new ECBlocks(24,new ECB(15,19),new ECB(2,20)),new ECBlocks(30,new ECB(3,15),new ECB(13,16))),new Version(17,new Array(6,30,54,78),new ECBlocks(28,new ECB(1,107),new ECB(5,108)),new ECBlocks(28,new ECB(10,46),new ECB(1,47)),new ECBlocks(28,new ECB(1,22),new ECB(15,23)),new ECBlocks(28,new ECB(2,14),new ECB(17,15))),new Version(18,new Array(6,30,56,82),new ECBlocks(30,new ECB(5,120),new ECB(1,121)),new ECBlocks(26,new ECB(9,43),new ECB(4,44)),new ECBlocks(28,new ECB(17,22),new ECB(1,23)),new ECBlocks(28,new ECB(2,14),new ECB(19,15))),new Version(19,new Array(6,30,58,86),new ECBlocks(28,new ECB(3,113),new ECB(4,114)),new ECBlocks(26,new ECB(3,44),new ECB(11,45)),new ECBlocks(26,new ECB(17,21),new ECB(4,22)),new ECBlocks(26,new ECB(9,13),new ECB(16,14))),new Version(20,new Array(6,34,62,90),new ECBlocks(28,new ECB(3,107),new ECB(5,108)),new ECBlocks(26,new ECB(3,41),new ECB(13,42)),new ECBlocks(30,new ECB(15,24),new ECB(5,25)),new ECBlocks(28,new ECB(15,15),new ECB(10,16))),new Version(21,new Array(6,28,50,72,94),new ECBlocks(28,new ECB(4,116),new ECB(4,117)),new ECBlocks(26,new ECB(17,42)),new ECBlocks(28,new ECB(17,22),new ECB(6,23)),new ECBlocks(30,new ECB(19,16),new ECB(6,17))),new Version(22,new Array(6,26,50,74,98),new ECBlocks(28,new ECB(2,111),new ECB(7,112)),new ECBlocks(28,new ECB(17,46)),new ECBlocks(30,new ECB(7,24),new ECB(16,25)),new ECBlocks(24,new ECB(34,13))),new Version(23,new Array(6,30,54,74,102),new ECBlocks(30,new ECB(4,121),new ECB(5,122)),new ECBlocks(28,new ECB(4,47),new ECB(14,48)),new ECBlocks(30,new ECB(11,24),new ECB(14,25)),new ECBlocks(30,new ECB(16,15),new ECB(14,16))),new Version(24,new Array(6,28,54,80,106),new ECBlocks(30,new ECB(6,117),new ECB(4,118)),new ECBlocks(28,new ECB(6,45),new ECB(14,46)),new ECBlocks(30,new ECB(11,24),new ECB(16,25)),new ECBlocks(30,new ECB(30,16),new ECB(2,17))),new Version(25,new Array(6,32,58,84,110),new ECBlocks(26,new ECB(8,106),new ECB(4,107)),new ECBlocks(28,new ECB(8,47),new ECB(13,48)),new ECBlocks(30,new ECB(7,24),new ECB(22,25)),new ECBlocks(30,new ECB(22,15),new ECB(13,16))),new Version(26,new Array(6,30,58,86,114),new ECBlocks(28,new ECB(10,114),new ECB(2,115)),new ECBlocks(28,new ECB(19,46),new ECB(4,47)),new ECBlocks(28,new ECB(28,22),new ECB(6,23)),new ECBlocks(30,new ECB(33,16),new ECB(4,17))),new Version(27,new Array(6,34,62,90,118),new ECBlocks(30,new ECB(8,122),new ECB(4,123)),new ECBlocks(28,new ECB(22,45),new ECB(3,46)),new ECBlocks(30,new ECB(8,23),new ECB(26,24)),new ECBlocks(30,new ECB(12,15),new ECB(28,16))),new Version(28,new Array(6,26,50,74,98,122),new ECBlocks(30,new ECB(3,117),new ECB(10,118)),new ECBlocks(28,new ECB(3,45),new ECB(23,46)),new ECBlocks(30,new ECB(4,24),new ECB(31,25)),new ECBlocks(30,new ECB(11,15),new ECB(31,16))),new Version(29,new Array(6,30,54,78,102,126),new ECBlocks(30,new ECB(7,116),new ECB(7,117)),new ECBlocks(28,new ECB(21,45),new ECB(7,46)),new ECBlocks(30,new ECB(1,23),new ECB(37,24)),new ECBlocks(30,new ECB(19,15),new ECB(26,16))),new Version(30,new Array(6,26,52,78,104,130),new ECBlocks(30,new ECB(5,115),new ECB(10,116)),new ECBlocks(28,new ECB(19,47),new ECB(10,48)),new ECBlocks(30,new ECB(15,24),new ECB(25,25)),new ECBlocks(30,new ECB(23,15),new ECB(25,16))),new Version(31,new Array(6,30,56,82,108,134),new ECBlocks(30,new ECB(13,115),new ECB(3,116)),new ECBlocks(28,new ECB(2,46),new ECB(29,47)),new ECBlocks(30,new ECB(42,24),new ECB(1,25)),new ECBlocks(30,new ECB(23,15),new ECB(28,16))),new Version(32,new Array(6,34,60,86,112,138),new ECBlocks(30,new ECB(17,115)),new ECBlocks(28,new ECB(10,46),new ECB(23,47)),new ECBlocks(30,new ECB(10,24),new ECB(35,25)),new ECBlocks(30,new ECB(19,15),new ECB(35,16))),new Version(33,new Array(6,30,58,86,114,142),new ECBlocks(30,new ECB(17,115),new ECB(1,116)),new ECBlocks(28,new ECB(14,46),new ECB(21,47)),new ECBlocks(30,new ECB(29,24),new ECB(19,25)),new ECBlocks(30,new ECB(11,15),new ECB(46,16))),new Version(34,new Array(6,34,62,90,118,146),new ECBlocks(30,new ECB(13,115),new ECB(6,116)),new ECBlocks(28,new ECB(14,46),new ECB(23,47)),new ECBlocks(30,new ECB(44,24),new ECB(7,25)),new ECBlocks(30,new ECB(59,16),new ECB(1,17))),new Version(35,new Array(6,30,54,78,102,126,150),new ECBlocks(30,new ECB(12,121),new ECB(7,122)),new ECBlocks(28,new ECB(12,47),new ECB(26,48)),new ECBlocks(30,new ECB(39,24),new ECB(14,25)),new ECBlocks(30,new ECB(22,15),new ECB(41,16))),new Version(36,new Array(6,24,50,76,102,128,154),new ECBlocks(30,new ECB(6,121),new ECB(14,122)),new ECBlocks(28,new ECB(6,47),new ECB(34,48)),new ECBlocks(30,new ECB(46,24),new ECB(10,25)),new ECBlocks(30,new ECB(2,15),new ECB(64,16))),new Version(37,new Array(6,28,54,80,106,132,158),new ECBlocks(30,new ECB(17,122),new ECB(4,123)),new ECBlocks(28,new ECB(29,46),new ECB(14,47)),new ECBlocks(30,new ECB(49,24),new ECB(10,25)),new ECBlocks(30,new ECB(24,15),new ECB(46,16))),new Version(38,new Array(6,32,58,84,110,136,162),new ECBlocks(30,new ECB(4,122),new ECB(18,123)),new ECBlocks(28,new ECB(13,46),new ECB(32,47)),new ECBlocks(30,new ECB(48,24),new ECB(14,25)),new ECBlocks(30,new ECB(42,15),new ECB(32,16))),new Version(39,new Array(6,26,54,82,110,138,166),new ECBlocks(30,new ECB(20,117),new ECB(4,118)),new ECBlocks(28,new ECB(40,47),new ECB(7,48)),new ECBlocks(30,new ECB(43,24),new ECB(22,25)),new ECBlocks(30,new ECB(10,15),new ECB(67,16))),new Version(40,new Array(6,30,58,86,114,142,170),new ECBlocks(30,new ECB(19,118),new ECB(6,119)),new ECBlocks(28,new ECB(18,47),new ECB(31,48)),new ECBlocks(30,new ECB(34,24),new ECB(34,25)),new ECBlocks(30,new ECB(20,15),new ECB(61,16))))}function PerspectiveTransform(a11,a21,a31,a12,a22,a32,a13,a23,a33){this.a11=a11;this.a12=a12;this.a13=a13;this.a21=a21;this.a22=a22;this.a23=a23;this.a31=a31;this.a32=a32;this.a33=a33;this.transformPoints1=function(points){var max=points.length;var a11=this.a11;var a12=this.a12;var a13=this.a13;var a21=this.a21;var a22=this.a22;var a23=this.a23;var a31=this.a31;var a32=this.a32;var a33=this.a33;for(var i=0;i<max;i+=2){var x=points[i];var y=points[i+1];var denominator=a13*x+a23*y+a33;points[i]=(a11*x+a21*y+a31)/denominator;points[i+1]=(a12*x+a22*y+a32)/denominator}};this.transformPoints2=function(xValues,yValues){var n=xValues.length;for(var i=0;i<n;i++){var x=xValues[i];var y=yValues[i];var denominator=this.a13*x+this.a23*y+this.a33;xValues[i]=(this.a11*x+this.a21*y+this.a31)/denominator;yValues[i]=(this.a12*x+this.a22*y+this.a32)/denominator}};this.buildAdjoint=function(){return new PerspectiveTransform(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)};this.times=function(other){return new PerspectiveTransform(this.a11*other.a11+this.a21*other.a12+this.a31*other.a13,this.a11*other.a21+this.a21*other.a22+this.a31*other.a23,this.a11*other.a31+this.a21*other.a32+this.a31*other.a33,this.a12*other.a11+this.a22*other.a12+this.a32*other.a13,this.a12*other.a21+this.a22*other.a22+this.a32*other.a23,this.a12*other.a31+this.a22*other.a32+this.a32*other.a33,this.a13*other.a11+this.a23*other.a12+this.a33*other.a13,this.a13*other.a21+this.a23*other.a22+this.a33*other.a23,this.a13*other.a31+this.a23*other.a32+this.a33*other.a33)}}PerspectiveTransform.quadrilateralToQuadrilateral=function(x0,y0,x1,y1,x2,y2,x3,y3,x0p,y0p,x1p,y1p,x2p,y2p,x3p,y3p){var qToS=this.quadrilateralToSquare(x0,y0,x1,y1,x2,y2,x3,y3);var sToQ=this.squareToQuadrilateral(x0p,y0p,x1p,y1p,x2p,y2p,x3p,y3p);return sToQ.times(qToS)};PerspectiveTransform.squareToQuadrilateral=function(x0,y0,x1,y1,x2,y2,x3,y3){dy2=y3-y2;dy3=y0-y1+y2-y3;if(dy2==0&&dy3==0){return new PerspectiveTransform(x1-x0,x2-x1,x0,y1-y0,y2-y1,y0,0,0,1)}else{dx1=x1-x2;dx2=x3-x2;dx3=x0-x1+x2-x3;dy1=y1-y2;denominator=dx1*dy2-dx2*dy1;a13=(dx3*dy2-dx2*dy3)/denominator;a23=(dx1*dy3-dx3*dy1)/denominator;return new PerspectiveTransform(x1-x0+a13*x1,x3-x0+a23*x3,x0,y1-y0+a13*y1,y3-y0+a23*y3,y0,a13,a23,1)}};PerspectiveTransform.quadrilateralToSquare=function(x0,y0,x1,y1,x2,y2,x3,y3){return this.squareToQuadrilateral(x0,y0,x1,y1,x2,y2,x3,y3).buildAdjoint()};function DetectorResult(bits,points){this.bits=bits;this.points=points}function Detector(image){this.image=image;this.resultPointCallback=null;this.sizeOfBlackWhiteBlackRun=function(fromX,fromY,toX,toY){var steep=Math.abs(toY-fromY)>Math.abs(toX-fromX);if(steep){var temp=fromX;fromX=fromY;fromY=temp;temp=toX;toX=toY;toY=temp}var dx=Math.abs(toX-fromX);var dy=Math.abs(toY-fromY);var error=-dx>>1;var ystep=fromY<toY?1:-1;var xstep=fromX<toX?1:-1;var state=0;for(var x=fromX,y=fromY;x!=toX;x+=xstep){var realX=steep?y:x;var realY=steep?x:y;if(state==1){if(this.image[realX+realY*qrcode.width]){state++}}else{if(!this.image[realX+realY*qrcode.width]){state++}}if(state==3){var diffX=x-fromX;var diffY=y-fromY;return Math.sqrt((diffX*diffX+diffY*diffY))}error+=dy;if(error>0){if(y==toY){break}y+=ystep;error-=dx}}var diffX2=toX-fromX;var diffY2=toY-fromY;return Math.sqrt((diffX2*diffX2+diffY2*diffY2))};this.sizeOfBlackWhiteBlackRunBothWays=function(fromX,fromY,toX,toY){var result=this.sizeOfBlackWhiteBlackRun(fromX,fromY,toX,toY);var scale=1;var otherToX=fromX-(toX-fromX);if(otherToX<0){scale=fromX/(fromX-otherToX);otherToX=0}else{if(otherToX>=qrcode.width){scale=(qrcode.width-1-fromX)/(otherToX-fromX);otherToX=qrcode.width-1}}var otherToY=Math.floor(fromY-(toY-fromY)*scale);scale=1;if(otherToY<0){scale=fromY/(fromY-otherToY);otherToY=0}else{if(otherToY>=qrcode.height){scale=(qrcode.height-1-fromY)/(otherToY-fromY);otherToY=qrcode.height-1}}otherToX=Math.floor(fromX+(otherToX-fromX)*scale);result+=this.sizeOfBlackWhiteBlackRun(fromX,fromY,otherToX,otherToY);return result-1};this.calculateModuleSizeOneWay=function(pattern,otherPattern){var moduleSizeEst1=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(pattern.X),Math.floor(pattern.Y),Math.floor(otherPattern.X),Math.floor(otherPattern.Y));var moduleSizeEst2=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(otherPattern.X),Math.floor(otherPattern.Y),Math.floor(pattern.X),Math.floor(pattern.Y));if(isNaN(moduleSizeEst1)){return moduleSizeEst2/7}if(isNaN(moduleSizeEst2)){return moduleSizeEst1/7}return(moduleSizeEst1+moduleSizeEst2)/14};this.calculateModuleSize=function(topLeft,topRight,bottomLeft){return(this.calculateModuleSizeOneWay(topLeft,topRight)+this.calculateModuleSizeOneWay(topLeft,bottomLeft))/2};this.distance=function(pattern1,pattern2){xDiff=pattern1.X-pattern2.X;yDiff=pattern1.Y-pattern2.Y;return Math.sqrt((xDiff*xDiff+yDiff*yDiff))};this.computeDimension=function(topLeft,topRight,bottomLeft,moduleSize){var tltrCentersDimension=Math.round(this.distance(topLeft,topRight)/moduleSize);var tlblCentersDimension=Math.round(this.distance(topLeft,bottomLeft)/moduleSize);var dimension=((tltrCentersDimension+tlblCentersDimension)>>1)+7;switch(dimension&3){case 0:dimension++;break;case 2:dimension--;break;case 3:throw"Error"}return dimension};this.findAlignmentInRegion=function(overallEstModuleSize,estAlignmentX,estAlignmentY,allowanceFactor){var allowance=Math.floor(allowanceFactor*overallEstModuleSize);var alignmentAreaLeftX=Math.max(0,estAlignmentX-allowance);var alignmentAreaRightX=Math.min(qrcode.width-1,estAlignmentX+allowance);if(alignmentAreaRightX-alignmentAreaLeftX<overallEstModuleSize*3){throw"Error"}var alignmentAreaTopY=Math.max(0,estAlignmentY-allowance);var alignmentAreaBottomY=Math.min(qrcode.height-1,estAlignmentY+allowance);var alignmentFinder=new AlignmentPatternFinder(this.image,alignmentAreaLeftX,alignmentAreaTopY,alignmentAreaRightX-alignmentAreaLeftX,alignmentAreaBottomY-alignmentAreaTopY,overallEstModuleSize,this.resultPointCallback);return alignmentFinder.find()};this.createTransform=function(topLeft,topRight,bottomLeft,alignmentPattern,dimension){var dimMinusThree=dimension-3.5;var bottomRightX;var bottomRightY;var sourceBottomRightX;var sourceBottomRightY;if(alignmentPattern!=null){bottomRightX=alignmentPattern.X;bottomRightY=alignmentPattern.Y;sourceBottomRightX=sourceBottomRightY=dimMinusThree-3}else{bottomRightX=(topRight.X-topLeft.X)+bottomLeft.X;bottomRightY=(topRight.Y-topLeft.Y)+bottomLeft.Y;sourceBottomRightX=sourceBottomRightY=dimMinusThree}var transform=PerspectiveTransform.quadrilateralToQuadrilateral(3.5,3.5,dimMinusThree,3.5,sourceBottomRightX,sourceBottomRightY,3.5,dimMinusThree,topLeft.X,topLeft.Y,topRight.X,topRight.Y,bottomRightX,bottomRightY,bottomLeft.X,bottomLeft.Y);return transform};this.sampleGrid=function(image,transform,dimension){var sampler=GridSampler;return sampler.sampleGrid3(image,dimension,transform)};this.processFinderPatternInfo=function(info){var topLeft=info.TopLeft;var topRight=info.TopRight;var bottomLeft=info.BottomLeft;var moduleSize=this.calculateModuleSize(topLeft,topRight,bottomLeft);if(moduleSize<1){throw"Error"}var dimension=this.computeDimension(topLeft,topRight,bottomLeft,moduleSize);var provisionalVersion=Version.getProvisionalVersionForDimension(dimension);var modulesBetweenFPCenters=provisionalVersion.DimensionForVersion-7;var alignmentPattern=null;if(provisionalVersion.AlignmentPatternCenters.length>0){var bottomRightX=topRight.X-topLeft.X+bottomLeft.X;var bottomRightY=topRight.Y-topLeft.Y+bottomLeft.Y;var correctionToTopLeft=1-3/modulesBetweenFPCenters;var estAlignmentX=Math.floor(topLeft.X+correctionToTopLeft*(bottomRightX-topLeft.X));var estAlignmentY=Math.floor(topLeft.Y+correctionToTopLeft*(bottomRightY-topLeft.Y));for(var i=4;i<=16;i<<=1){alignmentPattern=this.findAlignmentInRegion(moduleSize,estAlignmentX,estAlignmentY,i);break}}var transform=this.createTransform(topLeft,topRight,bottomLeft,alignmentPattern,dimension);var bits=this.sampleGrid(this.image,transform,dimension);var points;if(alignmentPattern==null){points=new Array(bottomLeft,topLeft,topRight)}else{points=new Array(bottomLeft,topLeft,topRight,alignmentPattern)}return new DetectorResult(bits,points)};this.detect=function(){var info=new FinderPatternFinder().findFinderPattern(this.image);return this.processFinderPatternInfo(info)}}var FORMAT_INFO_MASK_QR=21522;var FORMAT_INFO_DECODE_LOOKUP=new Array(new Array(21522,0),new Array(20773,1),new Array(24188,2),new Array(23371,3),new Array(17913,4),new Array(16590,5),new Array(20375,6),new Array(19104,7),new Array(30660,8),new Array(29427,9),new Array(32170,10),new Array(30877,11),new Array(26159,12),new Array(25368,13),new Array(27713,14),new Array(26998,15),new Array(5769,16),new Array(5054,17),new Array(7399,18),new Array(6608,19),new Array(1890,20),new Array(597,21),new Array(3340,22),new Array(2107,23),new Array(13663,24),new Array(12392,25),new Array(16177,26),new Array(14854,27),new Array(9396,28),new Array(8579,29),new Array(11994,30),new Array(11245,31));var BITS_SET_IN_HALF_BYTE=new Array(0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4);function FormatInformation(formatInfo){this.errorCorrectionLevel=ErrorCorrectionLevel.forBits((formatInfo>>3)&3);this.dataMask=(formatInfo&7);this.__defineGetter__("ErrorCorrectionLevel",function(){return this.errorCorrectionLevel});this.__defineGetter__("DataMask",function(){return this.dataMask});this.GetHashCode=function(){return(this.errorCorrectionLevel.ordinal()<<3)|dataMask};this.Equals=function(o){var other=o;return this.errorCorrectionLevel==other.errorCorrectionLevel&&this.dataMask==other.dataMask}}FormatInformation.numBitsDiffering=function(a,b){a^=b;return BITS_SET_IN_HALF_BYTE[a&15]+BITS_SET_IN_HALF_BYTE[(URShift(a,4)&15)]+BITS_SET_IN_HALF_BYTE[(URShift(a,8)&15)]+BITS_SET_IN_HALF_BYTE[(URShift(a,12)&15)]+BITS_SET_IN_HALF_BYTE[(URShift(a,16)&15)]+BITS_SET_IN_HALF_BYTE[(URShift(a,20)&15)]+BITS_SET_IN_HALF_BYTE[(URShift(a,24)&15)]+BITS_SET_IN_HALF_BYTE[(URShift(a,28)&15)]};FormatInformation.decodeFormatInformation=function(maskedFormatInfo){var formatInfo=FormatInformation.doDecodeFormatInformation(maskedFormatInfo);if(formatInfo!=null){return formatInfo}return FormatInformation.doDecodeFormatInformation(maskedFormatInfo^FORMAT_INFO_MASK_QR)};FormatInformation.doDecodeFormatInformation=function(maskedFormatInfo){var bestDifference=4294967295;var bestFormatInfo=0;for(var i=0;i<FORMAT_INFO_DECODE_LOOKUP.length;i++){var decodeInfo=FORMAT_INFO_DECODE_LOOKUP[i];var targetInfo=decodeInfo[0];if(targetInfo==maskedFormatInfo){return new FormatInformation(decodeInfo[1])}var bitsDifference=this.numBitsDiffering(maskedFormatInfo,targetInfo);if(bitsDifference<bestDifference){bestFormatInfo=decodeInfo[1];bestDifference=bitsDifference}}if(bestDifference<=3){return new FormatInformation(bestFormatInfo)}return null};function ErrorCorrectionLevel(ordinal,bits,name){this.ordinal_Renamed_Field=ordinal;this.bits=bits;this.name=name;this.__defineGetter__("Bits",function(){return this.bits});this.__defineGetter__("Name",function(){return this.name});this.ordinal=function(){return this.ordinal_Renamed_Field}}ErrorCorrectionLevel.forBits=function(bits){if(bits<0||bits>=FOR_BITS.length){throw"ArgumentException"}return FOR_BITS[bits]};var L=new ErrorCorrectionLevel(0,1,"L");var M=new ErrorCorrectionLevel(1,0,"M");var Q=new ErrorCorrectionLevel(2,3,"Q");var H=new ErrorCorrectionLevel(3,2,"H");var FOR_BITS=new Array(M,L,H,Q);function BitMatrix(width,height){if(!height){height=width}if(width<1||height<1){throw"Both dimensions must be greater than 0"}this.width=width;this.height=height;var rowSize=width>>5;if((width&31)!=0){rowSize++}this.rowSize=rowSize;this.bits=new Array(rowSize*height);for(var i=0;i<this.bits.length;i++){this.bits[i]=0}this.__defineGetter__("Width",function(){return this.width});this.__defineGetter__("Height",function(){return this.height});this.__defineGetter__("Dimension",function(){if(this.width!=this.height){throw"Can't call getDimension() on a non-square matrix"}return this.width});this.get_Renamed=function(x,y){var offset=y*this.rowSize+(x>>5);return((URShift(this.bits[offset],(x&31)))&1)!=0};this.set_Renamed=function(x,y){var offset=y*this.rowSize+(x>>5);this.bits[offset]|=1<<(x&31)};this.flip=function(x,y){var offset=y*this.rowSize+(x>>5);this.bits[offset]^=1<<(x&31)};this.clear=function(){var max=this.bits.length;for(var i=0;i<max;i++){this.bits[i]=0}};this.setRegion=function(left,top,width,height){if(top<0||left<0){throw"Left and top must be nonnegative"}if(height<1||width<1){throw"Height and width must be at least 1"}var right=left+width;var bottom=top+height;if(bottom>this.height||right>this.width){throw"The region must fit inside the matrix"}for(var y=top;y<bottom;y++){var offset=y*this.rowSize;for(var x=left;x<right;x++){this.bits[offset+(x>>5)]|=1<<(x&31)}}}}function DataBlock(numDataCodewords,codewords){this.numDataCodewords=numDataCodewords;this.codewords=codewords;this.__defineGetter__("NumDataCodewords",function(){return this.numDataCodewords});this.__defineGetter__("Codewords",function(){return this.codewords})}DataBlock.getDataBlocks=function(rawCodewords,version,ecLevel){if(rawCodewords.length!=version.TotalCodewords){throw"ArgumentException"}var ecBlocks=version.getECBlocksForLevel(ecLevel);var totalBlocks=0;var ecBlockArray=ecBlocks.getECBlocks();for(var i=0;i<ecBlockArray.length;i++){totalBlocks+=ecBlockArray[i].Count}var result=new Array(totalBlocks);var numResultBlocks=0;for(var j=0;j<ecBlockArray.length;j++){var ecBlock=ecBlockArray[j];for(var i=0;i<ecBlock.Count;i++){var numDataCodewords=ecBlock.DataCodewords;var numBlockCodewords=ecBlocks.ECCodewordsPerBlock+numDataCodewords;result[numResultBlocks++]=new DataBlock(numDataCodewords,new Array(numBlockCodewords))}}var shorterBlocksTotalCodewords=result[0].codewords.length;var longerBlocksStartAt=result.length-1;while(longerBlocksStartAt>=0){var numCodewords=result[longerBlocksStartAt].codewords.length;if(numCodewords==shorterBlocksTotalCodewords){break}longerBlocksStartAt--}longerBlocksStartAt++;var shorterBlocksNumDataCodewords=shorterBlocksTotalCodewords-ecBlocks.ECCodewordsPerBlock;var rawCodewordsOffset=0;for(var i=0;i<shorterBlocksNumDataCodewords;i++){for(var j=0;j<numResultBlocks;j++){result[j].codewords[i]=rawCodewords[rawCodewordsOffset++]}}for(var j=longerBlocksStartAt;j<numResultBlocks;j++){result[j].codewords[shorterBlocksNumDataCodewords]=rawCodewords[rawCodewordsOffset++]}var max=result[0].codewords.length;for(var i=shorterBlocksNumDataCodewords;i<max;i++){for(var j=0;j<numResultBlocks;j++){var iOffset=j<longerBlocksStartAt?i:i+1;result[j].codewords[iOffset]=rawCodewords[rawCodewordsOffset++]}}return result};function BitMatrixParser(bitMatrix){var dimension=bitMatrix.Dimension;if(dimension<21||(dimension&3)!=1){throw"Error BitMatrixParser"}this.bitMatrix=bitMatrix;this.parsedVersion=null;this.parsedFormatInfo=null;this.copyBit=function(i,j,versionBits){return this.bitMatrix.get_Renamed(i,j)?(versionBits<<1)|1:versionBits<<1};this.readFormatInformation=function(){if(this.parsedFormatInfo!=null){return this.parsedFormatInfo}var formatInfoBits=0;for(var i=0;i<6;i++){formatInfoBits=this.copyBit(i,8,formatInfoBits)}formatInfoBits=this.copyBit(7,8,formatInfoBits);formatInfoBits=this.copyBit(8,8,formatInfoBits);formatInfoBits=this.copyBit(8,7,formatInfoBits);for(var j=5;j>=0;j--){formatInfoBits=this.copyBit(8,j,formatInfoBits)}this.parsedFormatInfo=FormatInformation.decodeFormatInformation(formatInfoBits);if(this.parsedFormatInfo!=null){return this.parsedFormatInfo}var dimension=this.bitMatrix.Dimension;formatInfoBits=0;var iMin=dimension-8;for(var i=dimension-1;i>=iMin;i--){formatInfoBits=this.copyBit(i,8,formatInfoBits)}for(var j=dimension-7;j<dimension;j++){formatInfoBits=this.copyBit(8,j,formatInfoBits)}this.parsedFormatInfo=FormatInformation.decodeFormatInformation(formatInfoBits);if(this.parsedFormatInfo!=null){return this.parsedFormatInfo}throw"Error readFormatInformation"};this.readVersion=function(){if(this.parsedVersion!=null){return this.parsedVersion}var dimension=this.bitMatrix.Dimension;var provisionalVersion=(dimension-17)>>2;if(provisionalVersion<=6){return Version.getVersionForNumber(provisionalVersion)}var versionBits=0;var ijMin=dimension-11;for(var j=5;j>=0;j--){for(var i=dimension-9;i>=ijMin;i--){versionBits=this.copyBit(i,j,versionBits)}}this.parsedVersion=Version.decodeVersionInformation(versionBits);if(this.parsedVersion!=null&&this.parsedVersion.DimensionForVersion==dimension){return this.parsedVersion}versionBits=0;for(var i=5;i>=0;i--){for(var j=dimension-9;j>=ijMin;j--){versionBits=this.copyBit(i,j,versionBits)}}this.parsedVersion=Version.decodeVersionInformation(versionBits);if(this.parsedVersion!=null&&this.parsedVersion.DimensionForVersion==dimension){return this.parsedVersion}throw"Error readVersion"};this.readCodewords=function(){var formatInfo=this.readFormatInformation();var version=this.readVersion();var dataMask=DataMask.forReference(formatInfo.DataMask);var dimension=this.bitMatrix.Dimension;dataMask.unmaskBitMatrix(this.bitMatrix,dimension);var functionPattern=version.buildFunctionPattern();var readingUp=true;var result=new Array(version.TotalCodewords);var resultOffset=0;var currentByte=0;var bitsRead=0;for(var j=dimension-1;j>0;j-=2){if(j==6){j--}for(var count=0;count<dimension;count++){var i=readingUp?dimension-1-count:count;for(var col=0;col<2;col++){if(!functionPattern.get_Renamed(j-col,i)){bitsRead++;currentByte<<=1;if(this.bitMatrix.get_Renamed(j-col,i)){currentByte|=1}if(bitsRead==8){result[resultOffset++]=currentByte;bitsRead=0;currentByte=0}}}}readingUp^=true}if(resultOffset!=version.TotalCodewords){throw"Error readCodewords"}return result}}DataMask={};DataMask.forReference=function(reference){if(reference<0||reference>7){throw"System.ArgumentException"}return DataMask.DATA_MASKS[reference]};function DataMask000(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++){for(var j=0;j<dimension;j++){if(this.isMasked(i,j)){bits.flip(j,i)}}}};this.isMasked=function(i,j){return((i+j)&1)==0}}function DataMask001(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++){for(var j=0;j<dimension;j++){if(this.isMasked(i,j)){bits.flip(j,i)}}}};this.isMasked=function(i,j){return(i&1)==0}}function DataMask010(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++){for(var j=0;j<dimension;j++){if(this.isMasked(i,j)){bits.flip(j,i)}}}};this.isMasked=function(i,j){return j%3==0}}function DataMask011(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++){for(var j=0;j<dimension;j++){if(this.isMasked(i,j)){bits.flip(j,i)}}}};this.isMasked=function(i,j){return(i+j)%3==0}}function DataMask100(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++){for(var j=0;j<dimension;j++){if(this.isMasked(i,j)){bits.flip(j,i)}}}};this.isMasked=function(i,j){return(((URShift(i,1))+(j/3))&1)==0}}function DataMask101(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++){for(var j=0;j<dimension;j++){if(this.isMasked(i,j)){bits.flip(j,i)}}}};this.isMasked=function(i,j){var temp=i*j;return(temp&1)+(temp%3)==0}}function DataMask110(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++){for(var j=0;j<dimension;j++){if(this.isMasked(i,j)){bits.flip(j,i)}}}};this.isMasked=function(i,j){var temp=i*j;return(((temp&1)+(temp%3))&1)==0}}function DataMask111(){this.unmaskBitMatrix=function(bits,dimension){for(var i=0;i<dimension;i++){for(var j=0;j<dimension;j++){if(this.isMasked(i,j)){bits.flip(j,i)}}}};this.isMasked=function(i,j){return((((i+j)&1)+((i*j)%3))&1)==0}}DataMask.DATA_MASKS=new Array(new DataMask000(),new DataMask001(),new DataMask010(),new DataMask011(),new DataMask100(),new DataMask101(),new DataMask110(),new DataMask111());function ReedSolomonDecoder(field){this.field=field;this.decode=function(received,twoS){var poly=new GF256Poly(this.field,received);var syndromeCoefficients=new Array(twoS);for(var i=0;i<syndromeCoefficients.length;i++){syndromeCoefficients[i]=0}var dataMatrix=false;var noError=true;for(var i=0;i<twoS;i++){var eval=poly.evaluateAt(this.field.exp(dataMatrix?i+1:i));syndromeCoefficients[syndromeCoefficients.length-1-i]=eval;if(eval!=0){noError=false}}if(noError){return}var syndrome=new GF256Poly(this.field,syndromeCoefficients);var sigmaOmega=this.runEuclideanAlgorithm(this.field.buildMonomial(twoS,1),syndrome,twoS);var sigma=sigmaOmega[0];var omega=sigmaOmega[1];var errorLocations=this.findErrorLocations(sigma);var errorMagnitudes=this.findErrorMagnitudes(omega,errorLocations,dataMatrix);for(var i=0;i<errorLocations.length;i++){var position=received.length-1-this.field.log(errorLocations[i]);if(position<0){throw"ReedSolomonException Bad error location"}received[position]=GF256.addOrSubtract(received[position],errorMagnitudes[i])}};this.runEuclideanAlgorithm=function(a,b,R){if(a.Degree<b.Degree){var temp=a;a=b;b=temp}var rLast=a;var r=b;var sLast=this.field.One;var s=this.field.Zero;var tLast=this.field.Zero;var t=this.field.One;while(r.Degree>=Math.floor(R/2)){var rLastLast=rLast;var sLastLast=sLast;var tLastLast=tLast;rLast=r;sLast=s;tLast=t;if(rLast.Zero){throw"r_{i-1} was zero"}r=rLastLast;var q=this.field.Zero;var denominatorLeadingTerm=rLast.getCoefficient(rLast.Degree);var dltInverse=this.field.inverse(denominatorLeadingTerm);while(r.Degree>=rLast.Degree&&!r.Zero){var degreeDiff=r.Degree-rLast.Degree;var scale=this.field.multiply(r.getCoefficient(r.Degree),dltInverse);q=q.addOrSubtract(this.field.buildMonomial(degreeDiff,scale));r=r.addOrSubtract(rLast.multiplyByMonomial(degreeDiff,scale))}s=q.multiply1(sLast).addOrSubtract(sLastLast);t=q.multiply1(tLast).addOrSubtract(tLastLast)}var sigmaTildeAtZero=t.getCoefficient(0);if(sigmaTildeAtZero==0){throw"ReedSolomonException sigmaTilde(0) was zero"}var inverse=this.field.inverse(sigmaTildeAtZero);var sigma=t.multiply2(inverse);var omega=r.multiply2(inverse);return new Array(sigma,omega)};this.findErrorLocations=function(errorLocator){var numErrors=errorLocator.Degree;if(numErrors==1){return new Array(errorLocator.getCoefficient(1))}var result=new Array(numErrors);var e=0;for(var i=1;i<256&&e<numErrors;i++){if(errorLocator.evaluateAt(i)==0){result[e]=this.field.inverse(i);e++}}if(e!=numErrors){throw"Error locator degree does not match number of roots"}return result};this.findErrorMagnitudes=function(errorEvaluator,errorLocations,dataMatrix){var s=errorLocations.length;var result=new Array(s);for(var i=0;i<s;i++){var xiInverse=this.field.inverse(errorLocations[i]);var denominator=1;for(var j=0;j<s;j++){if(i!=j){denominator=this.field.multiply(denominator,GF256.addOrSubtract(1,this.field.multiply(errorLocations[j],xiInverse)))}}result[i]=this.field.multiply(errorEvaluator.evaluateAt(xiInverse),this.field.inverse(denominator));if(dataMatrix){result[i]=this.field.multiply(result[i],xiInverse)}}return result}}function GF256Poly(field,coefficients){if(coefficients==null||coefficients.length==0){throw"System.ArgumentException"}this.field=field;var coefficientsLength=coefficients.length;if(coefficientsLength>1&&coefficients[0]==0){var firstNonZero=1;while(firstNonZero<coefficientsLength&&coefficients[firstNonZero]==0){firstNonZero++}if(firstNonZero==coefficientsLength){this.coefficients=field.Zero.coefficients}else{this.coefficients=new Array(coefficientsLength-firstNonZero);for(var i=0;i<this.coefficients.length;i++){this.coefficients[i]=0}for(var ci=0;ci<this.coefficients.length;ci++){this.coefficients[ci]=coefficients[firstNonZero+ci]}}}else{this.coefficients=coefficients}this.__defineGetter__("Zero",function(){return this.coefficients[0]==0});this.__defineGetter__("Degree",function(){return this.coefficients.length-1});this.__defineGetter__("Coefficients",function(){return this.coefficients});this.getCoefficient=function(degree){return this.coefficients[this.coefficients.length-1-degree]};this.evaluateAt=function(a){if(a==0){return this.getCoefficient(0)}var size=this.coefficients.length;if(a==1){var result=0;for(var i=0;i<size;i++){result=GF256.addOrSubtract(result,this.coefficients[i])}return result}var result2=this.coefficients[0];for(var i=1;i<size;i++){result2=GF256.addOrSubtract(this.field.multiply(a,result2),this.coefficients[i])}return result2};this.addOrSubtract=function(other){if(this.field!=other.field){throw"GF256Polys do not have same GF256 field"}if(this.Zero){return other}if(other.Zero){return this}var smallerCoefficients=this.coefficients;var largerCoefficients=other.coefficients;if(smallerCoefficients.length>largerCoefficients.length){var temp=smallerCoefficients;smallerCoefficients=largerCoefficients;largerCoefficients=temp}var sumDiff=new Array(largerCoefficients.length);var lengthDiff=largerCoefficients.length-smallerCoefficients.length;for(var ci=0;ci<lengthDiff;ci++){sumDiff[ci]=largerCoefficients[ci]}for(var i=lengthDiff;i<largerCoefficients.length;i++){sumDiff[i]=GF256.addOrSubtract(smallerCoefficients[i-lengthDiff],largerCoefficients[i])}return new GF256Poly(field,sumDiff)};this.multiply1=function(other){if(this.field!=other.field){throw"GF256Polys do not have same GF256 field"}if(this.Zero||other.Zero){return this.field.Zero}var aCoefficients=this.coefficients;var aLength=aCoefficients.length;var bCoefficients=other.coefficients;var bLength=bCoefficients.length;var product=new Array(aLength+bLength-1);for(var i=0;i<aLength;i++){var aCoeff=aCoefficients[i];for(var j=0;j<bLength;j++){product[i+j]=GF256.addOrSubtract(product[i+j],this.field.multiply(aCoeff,bCoefficients[j]))}}return new GF256Poly(this.field,product)};this.multiply2=function(scalar){if(scalar==0){return this.field.Zero}if(scalar==1){return this}var size=this.coefficients.length;var product=new Array(size);for(var i=0;i<size;i++){product[i]=this.field.multiply(this.coefficients[i],scalar)}return new GF256Poly(this.field,product)};this.multiplyByMonomial=function(degree,coefficient){if(degree<0){throw"System.ArgumentException"}if(coefficient==0){return this.field.Zero}var size=this.coefficients.length;var product=new Array(size+degree);for(var i=0;i<product.length;i++){product[i]=0}for(var i=0;i<size;i++){product[i]=this.field.multiply(this.coefficients[i],coefficient)}return new GF256Poly(this.field,product)};this.divide=function(other){if(this.field!=other.field){throw"GF256Polys do not have same GF256 field"}if(other.Zero){throw"Divide by 0"}var quotient=this.field.Zero;var remainder=this;var denominatorLeadingTerm=other.getCoefficient(other.Degree);var inverseDenominatorLeadingTerm=this.field.inverse(denominatorLeadingTerm);while(remainder.Degree>=other.Degree&&!remainder.Zero){var degreeDifference=remainder.Degree-other.Degree;var scale=this.field.multiply(remainder.getCoefficient(remainder.Degree),inverseDenominatorLeadingTerm);var term=other.multiplyByMonomial(degreeDifference,scale);var iterationQuotient=this.field.buildMonomial(degreeDifference,scale);quotient=quotient.addOrSubtract(iterationQuotient);remainder=remainder.addOrSubtract(term)}return new Array(quotient,remainder)}}function GF256(primitive){this.expTable=new Array(256);this.logTable=new Array(256);var x=1;for(var i=0;i<256;i++){this.expTable[i]=x;x<<=1;if(x>=256){x^=primitive}}for(var i=0;i<255;i++){this.logTable[this.expTable[i]]=i}var at0=new Array(1);at0[0]=0;this.zero=new GF256Poly(this,new Array(at0));var at1=new Array(1);at1[0]=1;this.one=new GF256Poly(this,new Array(at1));this.__defineGetter__("Zero",function(){return this.zero});this.__defineGetter__("One",function(){return this.one});this.buildMonomial=function(degree,coefficient){if(degree<0){throw"System.ArgumentException"}if(coefficient==0){return zero}var coefficients=new Array(degree+1);for(var i=0;i<coefficients.length;i++){coefficients[i]=0}coefficients[0]=coefficient;return new GF256Poly(this,coefficients)};this.exp=function(a){return this.expTable[a]};this.log=function(a){if(a==0){throw"System.ArgumentException"}return this.logTable[a]};this.inverse=function(a){if(a==0){throw"System.ArithmeticException"}return this.expTable[255-this.logTable[a]]};this.multiply=function(a,b){if(a==0||b==0){return 0}if(a==1){return b}if(b==1){return a}return this.expTable[(this.logTable[a]+this.logTable[b])%255]}}GF256.QR_CODE_FIELD=new GF256(285);GF256.DATA_MATRIX_FIELD=new GF256(301);GF256.addOrSubtract=function(a,b){return a^b};Decoder={};Decoder.rsDecoder=new ReedSolomonDecoder(GF256.QR_CODE_FIELD);Decoder.correctErrors=function(codewordBytes,numDataCodewords){var numCodewords=codewordBytes.length;var codewordsInts=new Array(numCodewords);for(var i=0;i<numCodewords;i++){codewordsInts[i]=codewordBytes[i]&255}var numECCodewords=codewordBytes.length-numDataCodewords;try{Decoder.rsDecoder.decode(codewordsInts,numECCodewords)}catch(rse){throw rse}for(var i=0;i<numDataCodewords;i++){codewordBytes[i]=codewordsInts[i]}};Decoder.decode=function(bits){var parser=new BitMatrixParser(bits);var version=parser.readVersion();var ecLevel=parser.readFormatInformation().ErrorCorrectionLevel;var codewords=parser.readCodewords();var dataBlocks=DataBlock.getDataBlocks(codewords,version,ecLevel);var totalBytes=0;for(var i=0;i<dataBlocks.length;i++){totalBytes+=dataBlocks[i].NumDataCodewords}var resultBytes=new Array(totalBytes);var resultOffset=0;for(var j=0;j<dataBlocks.length;j++){var dataBlock=dataBlocks[j];var codewordBytes=dataBlock.Codewords;var numDataCodewords=dataBlock.NumDataCodewords;Decoder.correctErrors(codewordBytes,numDataCodewords);for(var i=0;i<numDataCodewords;i++){resultBytes[resultOffset++]=codewordBytes[i]}}var reader=new QRCodeDataBlockReader(resultBytes,version.VersionNumber,ecLevel.Bits);return reader};qrcode={};qrcode.imagedata=null;qrcode.width=0;qrcode.height=0;qrcode.qrCodeSymbol=null;qrcode.debug=false;qrcode.maxImgSize=1024*1024;qrcode.sizeOfDataLengthInfo=[[10,9,8,8],[12,11,16,10],[14,13,16,12]];qrcode.decode=function(src,successCallback,failCallback){var image=new Image();image.onload=function(){var canvas_qr=document.createElement("canvas");var context=canvas_qr.getContext("2d");var nheight=image.height;var nwidth=image.width;if(image.width*image.height>qrcode.maxImgSize){var ir=image.width/image.height;nheight=Math.sqrt(qrcode.maxImgSize/ir);nwidth=ir*nheight}canvas_qr.width=nwidth;canvas_qr.height=nheight;context.drawImage(image,0,0,canvas_qr.width,canvas_qr.height);qrcode.width=canvas_qr.width;qrcode.height=canvas_qr.height;try{qrcode.imagedata=context.getImageData(0,0,canvas_qr.width,canvas_qr.height)}catch(e){if(failCallback){failCallback("Cross domain image reading not supported in your browser! Save it to your computer then drag and drop the file!")}return}try{qrcode.result=qrcode.process(context);if(successCallback){successCallback(qrcode.result)}}catch(e){if(failCallback){failCallback(""+e)}}};image.src=src};qrcode.isUrl=function(s){var regexp=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return regexp.test(s)};qrcode.decode_url=function(s){var escaped="";try{escaped=escape(s)}catch(e){tvg.game.log.debug("qrcode.decode_url unable to escape: "+s+", "+e);escaped=s}var ret="";try{ret=decodeURIComponent(escaped)}catch(e){tvg.game.log.debug("qrcode.decode_url unable to decodeURIComponent: "+escaped+", "+e);ret=escaped}return ret};qrcode.decode_utf8=function(s){if(qrcode.isUrl(s)){return qrcode.decode_url(s)}else{return s}};qrcode.process=function(ctx){var start=new Date().getTime();var image=qrcode.grayScaleToBitmap(qrcode.grayscale());if(qrcode.debug){for(var y=0;y<qrcode.height;y++){for(var x=0;x<qrcode.width;x++){var point=(x*4)+(y*qrcode.width*4);qrcode.imagedata.data[point]=image[x+y*qrcode.width]?0:0;qrcode.imagedata.data[point+1]=image[x+y*qrcode.width]?0:0;qrcode.imagedata.data[point+2]=image[x+y*qrcode.width]?255:0}}ctx.putImageData(qrcode.imagedata,0,0)}var detector=new Detector(image);var qRCodeMatrix=detector.detect();if(qrcode.debug){ctx.putImageData(qrcode.imagedata,0,0)}var reader=Decoder.decode(qRCodeMatrix.bits);var data=reader.DataByte;var str="";for(var i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++){str+=String.fromCharCode(data[i][j])}}var end=new Date().getTime();var time=end-start;return qrcode.decode_utf8(str)};qrcode.getPixel=function(x,y){if(qrcode.width<x){throw"point error"}if(qrcode.height<y){throw"point error"}point=(x*4)+(y*qrcode.width*4);p=(qrcode.imagedata.data[point]*33+qrcode.imagedata.data[point+1]*34+qrcode.imagedata.data[point+2]*33)/100;return p};qrcode.binarize=function(th){var ret=new Array(qrcode.width*qrcode.height);for(var y=0;y<qrcode.height;y++){for(var x=0;x<qrcode.width;x++){var gray=qrcode.getPixel(x,y);ret[x+y*qrcode.width]=gray<=th?true:false}}return ret};qrcode.getMiddleBrightnessPerArea=function(image){var numSqrtArea=4;var areaWidth=Math.floor(qrcode.width/numSqrtArea);var areaHeight=Math.floor(qrcode.height/numSqrtArea);var minmax=new Array(numSqrtArea);for(var i=0;i<numSqrtArea;i++){minmax[i]=new Array(numSqrtArea);for(var i2=0;i2<numSqrtArea;i2++){minmax[i][i2]=new Array(0,0)}}for(var ay=0;ay<numSqrtArea;ay++){for(var ax=0;ax<numSqrtArea;ax++){minmax[ax][ay][0]=255;for(var dy=0;dy<areaHeight;dy++){for(var dx=0;dx<areaWidth;dx++){var target=image[areaWidth*ax+dx+(areaHeight*ay+dy)*qrcode.width];if(target<minmax[ax][ay][0]){minmax[ax][ay][0]=target}if(target>minmax[ax][ay][1]){minmax[ax][ay][1]=target}}}}}var middle=new Array(numSqrtArea);for(var i3=0;i3<numSqrtArea;i3++){middle[i3]=new Array(numSqrtArea)}for(var ay=0;ay<numSqrtArea;ay++){for(var ax=0;ax<numSqrtArea;ax++){middle[ax][ay]=Math.floor((minmax[ax][ay][0]+minmax[ax][ay][1])/2)}}return middle};qrcode.grayScaleToBitmap=function(grayScale){var middle=qrcode.getMiddleBrightnessPerArea(grayScale);var sqrtNumArea=middle.length;var areaWidth=Math.floor(qrcode.width/sqrtNumArea);var areaHeight=Math.floor(qrcode.height/sqrtNumArea);var bitmap=new Array(qrcode.height*qrcode.width);for(var ay=0;ay<sqrtNumArea;ay++){for(var ax=0;ax<sqrtNumArea;ax++){for(var dy=0;dy<areaHeight;dy++){for(var dx=0;dx<areaWidth;dx++){bitmap[areaWidth*ax+dx+(areaHeight*ay+dy)*qrcode.width]=(grayScale[areaWidth*ax+dx+(areaHeight*ay+dy)*qrcode.width]<middle[ax][ay])?true:false}}}}return bitmap};qrcode.grayscale=function(){var ret=new Array(qrcode.width*qrcode.height);for(var y=0;y<qrcode.height;y++){for(var x=0;x<qrcode.width;x++){var gray=qrcode.getPixel(x,y);ret[x+y*qrcode.width]=gray}}return ret};function URShift(number,bits){if(number>=0){return number>>bits}else{return(number>>bits)+(2<<~bits)}}Array.prototype.remove=function(from,to){var rest=this.slice((to||from)+1||this.length);this.length=from<0?this.length+from:from;return this.push.apply(this,rest)};var MIN_SKIP=3;var MAX_MODULES=57;var INTEGER_MATH_SHIFT=8;var CENTER_QUORUM=2;qrcode.orderBestPatterns=function(patterns){function distance(pattern1,pattern2){xDiff=pattern1.X-pattern2.X;yDiff=pattern1.Y-pattern2.Y;return Math.sqrt((xDiff*xDiff+yDiff*yDiff))}function crossProductZ(pointA,pointB,pointC){var bX=pointB.x;var bY=pointB.y;return((pointC.x-bX)*(pointA.y-bY))-((pointC.y-bY)*(pointA.x-bX))}var zeroOneDistance=distance(patterns[0],patterns[1]);var oneTwoDistance=distance(patterns[1],patterns[2]);var zeroTwoDistance=distance(patterns[0],patterns[2]);var pointA,pointB,pointC;if(oneTwoDistance>=zeroOneDistance&&oneTwoDistance>=zeroTwoDistance){pointB=patterns[0];pointA=patterns[1];pointC=patterns[2]}else{if(zeroTwoDistance>=oneTwoDistance&&zeroTwoDistance>=zeroOneDistance){pointB=patterns[1];pointA=patterns[0];pointC=patterns[2]}else{pointB=patterns[2];pointA=patterns[0];pointC=patterns[1]}}if(crossProductZ(pointA,pointB,pointC)<0){var temp=pointA;pointA=pointC;pointC=temp}patterns[0]=pointA;patterns[1]=pointB;patterns[2]=pointC};function FinderPattern(posX,posY,estimatedModuleSize){this.x=posX;this.y=posY;this.count=1;this.estimatedModuleSize=estimatedModuleSize;this.__defineGetter__("EstimatedModuleSize",function(){return this.estimatedModuleSize});this.__defineGetter__("Count",function(){return this.count});this.__defineGetter__("X",function(){return this.x});this.__defineGetter__("Y",function(){return this.y});this.incrementCount=function(){this.count++};this.aboutEquals=function(moduleSize,i,j){if(Math.abs(i-this.y)<=moduleSize&&Math.abs(j-this.x)<=moduleSize){var moduleSizeDiff=Math.abs(moduleSize-this.estimatedModuleSize);return moduleSizeDiff<=1||moduleSizeDiff/this.estimatedModuleSize<=1}return false}}function FinderPatternInfo(patternCenters){this.bottomLeft=patternCenters[0];this.topLeft=patternCenters[1];this.topRight=patternCenters[2];this.__defineGetter__("BottomLeft",function(){return this.bottomLeft});this.__defineGetter__("TopLeft",function(){return this.topLeft});this.__defineGetter__("TopRight",function(){return this.topRight})}function FinderPatternFinder(){this.image=null;this.possibleCenters=[];this.hasSkipped=false;this.crossCheckStateCount=new Array(0,0,0,0,0);this.resultPointCallback=null;this.__defineGetter__("CrossCheckStateCount",function(){this.crossCheckStateCount[0]=0;this.crossCheckStateCount[1]=0;this.crossCheckStateCount[2]=0;this.crossCheckStateCount[3]=0;this.crossCheckStateCount[4]=0;return this.crossCheckStateCount});this.foundPatternCross=function(stateCount){var totalModuleSize=0;for(var i=0;i<5;i++){var count=stateCount[i];if(count==0){return false}totalModuleSize+=count}if(totalModuleSize<7){return false}var moduleSize=Math.floor((totalModuleSize<<INTEGER_MATH_SHIFT)/7);var maxVariance=Math.floor(moduleSize/2);return Math.abs(moduleSize-(stateCount[0]<<INTEGER_MATH_SHIFT))<maxVariance&&Math.abs(moduleSize-(stateCount[1]<<INTEGER_MATH_SHIFT))<maxVariance&&Math.abs(3*moduleSize-(stateCount[2]<<INTEGER_MATH_SHIFT))<3*maxVariance&&Math.abs(moduleSize-(stateCount[3]<<INTEGER_MATH_SHIFT))<maxVariance&&Math.abs(moduleSize-(stateCount[4]<<INTEGER_MATH_SHIFT))<maxVariance};this.centerFromEnd=function(stateCount,end){return(end-stateCount[4]-stateCount[3])-stateCount[2]/2};this.crossCheckVertical=function(startI,centerJ,maxCount,originalStateCountTotal){var image=this.image;var maxI=qrcode.height;var stateCount=this.CrossCheckStateCount;var i=startI;while(i>=0&&image[centerJ+i*qrcode.width]){stateCount[2]++;i--}if(i<0){return NaN}while(i>=0&&!image[centerJ+i*qrcode.width]&&stateCount[1]<=maxCount){stateCount[1]++;i--}if(i<0||stateCount[1]>maxCount){return NaN}while(i>=0&&image[centerJ+i*qrcode.width]&&stateCount[0]<=maxCount){stateCount[0]++;i--}if(stateCount[0]>maxCount){return NaN}i=startI+1;while(i<maxI&&image[centerJ+i*qrcode.width]){stateCount[2]++;i++}if(i==maxI){return NaN}while(i<maxI&&!image[centerJ+i*qrcode.width]&&stateCount[3]<maxCount){stateCount[3]++;i++}if(i==maxI||stateCount[3]>=maxCount){return NaN}while(i<maxI&&image[centerJ+i*qrcode.width]&&stateCount[4]<maxCount){stateCount[4]++;i++}if(stateCount[4]>=maxCount){return NaN}var stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2]+stateCount[3]+stateCount[4];if(5*Math.abs(stateCountTotal-originalStateCountTotal)>=2*originalStateCountTotal){return NaN}return this.foundPatternCross(stateCount)?this.centerFromEnd(stateCount,i):NaN};this.crossCheckHorizontal=function(startJ,centerI,maxCount,originalStateCountTotal){var image=this.image;var maxJ=qrcode.width;var stateCount=this.CrossCheckStateCount;var j=startJ;while(j>=0&&image[j+centerI*qrcode.width]){stateCount[2]++;j--}if(j<0){return NaN}while(j>=0&&!image[j+centerI*qrcode.width]&&stateCount[1]<=maxCount){stateCount[1]++;j--}if(j<0||stateCount[1]>maxCount){return NaN}while(j>=0&&image[j+centerI*qrcode.width]&&stateCount[0]<=maxCount){stateCount[0]++;j--}if(stateCount[0]>maxCount){return NaN}j=startJ+1;while(j<maxJ&&image[j+centerI*qrcode.width]){stateCount[2]++;j++}if(j==maxJ){return NaN}while(j<maxJ&&!image[j+centerI*qrcode.width]&&stateCount[3]<maxCount){stateCount[3]++;j++}if(j==maxJ||stateCount[3]>=maxCount){return NaN}while(j<maxJ&&image[j+centerI*qrcode.width]&&stateCount[4]<maxCount){stateCount[4]++;j++}if(stateCount[4]>=maxCount){return NaN}var stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2]+stateCount[3]+stateCount[4];if(5*Math.abs(stateCountTotal-originalStateCountTotal)>=originalStateCountTotal){return NaN}return this.foundPatternCross(stateCount)?this.centerFromEnd(stateCount,j):NaN};this.handlePossibleCenter=function(stateCount,i,j){var stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2]+stateCount[3]+stateCount[4];var centerJ=this.centerFromEnd(stateCount,j);var centerI=this.crossCheckVertical(i,Math.floor(centerJ),stateCount[2],stateCountTotal);if(!isNaN(centerI)){centerJ=this.crossCheckHorizontal(Math.floor(centerJ),Math.floor(centerI),stateCount[2],stateCountTotal);if(!isNaN(centerJ)){var estimatedModuleSize=stateCountTotal/7;var found=false;var max=this.possibleCenters.length;for(var index=0;index<max;index++){var center=this.possibleCenters[index];if(center.aboutEquals(estimatedModuleSize,centerI,centerJ)){center.incrementCount();found=true;break}}if(!found){var point=new FinderPattern(centerJ,centerI,estimatedModuleSize);this.possibleCenters.push(point);if(this.resultPointCallback!=null){this.resultPointCallback.foundPossibleResultPoint(point)}}return true}}return false};this.selectBestPatterns=function(){var startSize=this.possibleCenters.length;if(startSize<3){throw"Couldn't find enough finder patterns"}if(startSize>3){var totalModuleSize=0;var square=0;for(var i=0;i<startSize;i++){var centerValue=this.possibleCenters[i].EstimatedModuleSize;totalModuleSize+=centerValue;square+=(centerValue*centerValue)}var average=totalModuleSize/startSize;this.possibleCenters.sort(function(center1,center2){var dA=Math.abs(center2.EstimatedModuleSize-average);var dB=Math.abs(center1.EstimatedModuleSize-average);if(dA<dB){return(-1)}else{if(dA==dB){return 0}else{return 1}}});var stdDev=Math.sqrt(square/startSize-average*average);var limit=Math.max(0.2*average,stdDev);for(var i=0;i<this.possibleCenters.length&&this.possibleCenters.length>3;i++){var pattern=this.possibleCenters[i];if(Math.abs(pattern.EstimatedModuleSize-average)>limit){this.possibleCenters.remove(i);i--}}}if(this.possibleCenters.length>3){this.possibleCenters.sort(function(a,b){if(a.count>b.count){return -1}if(a.count<b.count){return 1}return 0})}return new Array(this.possibleCenters[0],this.possibleCenters[1],this.possibleCenters[2])};this.findRowSkip=function(){var max=this.possibleCenters.length;if(max<=1){return 0}var firstConfirmedCenter=null;for(var i=0;i<max;i++){var center=this.possibleCenters[i];if(center.Count>=CENTER_QUORUM){if(firstConfirmedCenter==null){firstConfirmedCenter=center}else{this.hasSkipped=true;return Math.floor((Math.abs(firstConfirmedCenter.X-center.X)-Math.abs(firstConfirmedCenter.Y-center.Y))/2)}}}return 0};this.haveMultiplyConfirmedCenters=function(){var confirmedCount=0;var totalModuleSize=0;var max=this.possibleCenters.length;for(var i=0;i<max;i++){var pattern=this.possibleCenters[i];if(pattern.Count>=CENTER_QUORUM){confirmedCount++;totalModuleSize+=pattern.EstimatedModuleSize}}if(confirmedCount<3){return false}var average=totalModuleSize/max;var totalDeviation=0;for(var i=0;i<max;i++){pattern=this.possibleCenters[i];totalDeviation+=Math.abs(pattern.EstimatedModuleSize-average)}return totalDeviation<=0.05*totalModuleSize};this.findFinderPattern=function(image){var tryHarder=false;this.image=image;var maxI=qrcode.height;var maxJ=qrcode.width;var iSkip=Math.floor((3*maxI)/(4*MAX_MODULES));if(iSkip<MIN_SKIP||tryHarder){iSkip=MIN_SKIP}var done=false;var stateCount=new Array(5);for(var i=iSkip-1;i<maxI&&!done;i+=iSkip){stateCount[0]=0;stateCount[1]=0;stateCount[2]=0;stateCount[3]=0;stateCount[4]=0;var currentState=0;for(var j=0;j<maxJ;j++){if(image[j+i*qrcode.width]){if((currentState&1)==1){currentState++}stateCount[currentState]++}else{if((currentState&1)==0){if(currentState==4){if(this.foundPatternCross(stateCount)){var confirmed=this.handlePossibleCenter(stateCount,i,j);if(confirmed){iSkip=2;if(this.hasSkipped){done=this.haveMultiplyConfirmedCenters()}else{var rowSkip=this.findRowSkip();if(rowSkip>stateCount[2]){i+=rowSkip-stateCount[2]-iSkip;j=maxJ-1}}}else{do{j++}while(j<maxJ&&!image[j+i*qrcode.width]);j--}currentState=0;stateCount[0]=0;stateCount[1]=0;stateCount[2]=0;stateCount[3]=0;stateCount[4]=0}else{stateCount[0]=stateCount[2];stateCount[1]=stateCount[3];stateCount[2]=stateCount[4];stateCount[3]=1;stateCount[4]=0;currentState=3}}else{stateCount[++currentState]++}}else{stateCount[currentState]++}}}if(this.foundPatternCross(stateCount)){var confirmed=this.handlePossibleCenter(stateCount,i,maxJ);if(confirmed){iSkip=stateCount[0];if(this.hasSkipped){done=haveMultiplyConfirmedCenters()}}}}var patternInfo=this.selectBestPatterns();qrcode.orderBestPatterns(patternInfo);return new FinderPatternInfo(patternInfo)}}function AlignmentPattern(posX,posY,estimatedModuleSize){this.x=posX;this.y=posY;this.count=1;this.estimatedModuleSize=estimatedModuleSize;this.__defineGetter__("EstimatedModuleSize",function(){return this.estimatedModuleSize});this.__defineGetter__("Count",function(){return this.count});this.__defineGetter__("X",function(){return Math.floor(this.x)});this.__defineGetter__("Y",function(){return Math.floor(this.y)});this.incrementCount=function(){this.count++};this.aboutEquals=function(moduleSize,i,j){if(Math.abs(i-this.y)<=moduleSize&&Math.abs(j-this.x)<=moduleSize){var moduleSizeDiff=Math.abs(moduleSize-this.estimatedModuleSize);return moduleSizeDiff<=1||moduleSizeDiff/this.estimatedModuleSize<=1}return false}}function AlignmentPatternFinder(image,startX,startY,width,height,moduleSize,resultPointCallback){this.image=image;this.possibleCenters=new Array();this.startX=startX;this.startY=startY;this.width=width;this.height=height;this.moduleSize=moduleSize;this.crossCheckStateCount=new Array(0,0,0);this.resultPointCallback=resultPointCallback;this.centerFromEnd=function(stateCount,end){return(end-stateCount[2])-stateCount[1]/2};this.foundPatternCross=function(stateCount){var moduleSize=this.moduleSize;var maxVariance=moduleSize/2;for(var i=0;i<3;i++){if(Math.abs(moduleSize-stateCount[i])>=maxVariance){return false}}return true};this.crossCheckVertical=function(startI,centerJ,maxCount,originalStateCountTotal){var image=this.image;var maxI=qrcode.height;var stateCount=this.crossCheckStateCount;stateCount[0]=0;stateCount[1]=0;stateCount[2]=0;var i=startI;while(i>=0&&image[centerJ+i*qrcode.width]&&stateCount[1]<=maxCount){stateCount[1]++;i--}if(i<0||stateCount[1]>maxCount){return NaN}while(i>=0&&!image[centerJ+i*qrcode.width]&&stateCount[0]<=maxCount){stateCount[0]++;i--}if(stateCount[0]>maxCount){return NaN}i=startI+1;while(i<maxI&&image[centerJ+i*qrcode.width]&&stateCount[1]<=maxCount){stateCount[1]++;i++}if(i==maxI||stateCount[1]>maxCount){return NaN}while(i<maxI&&!image[centerJ+i*qrcode.width]&&stateCount[2]<=maxCount){stateCount[2]++;i++}if(stateCount[2]>maxCount){return NaN}var stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2];if(5*Math.abs(stateCountTotal-originalStateCountTotal)>=2*originalStateCountTotal){return NaN}return this.foundPatternCross(stateCount)?this.centerFromEnd(stateCount,i):NaN};this.handlePossibleCenter=function(stateCount,i,j){var stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2];var centerJ=this.centerFromEnd(stateCount,j);var centerI=this.crossCheckVertical(i,Math.floor(centerJ),2*stateCount[1],stateCountTotal);if(!isNaN(centerI)){var estimatedModuleSize=(stateCount[0]+stateCount[1]+stateCount[2])/3;var max=this.possibleCenters.length;for(var index=0;index<max;index++){var center=this.possibleCenters[index];if(center.aboutEquals(estimatedModuleSize,centerI,centerJ)){return new AlignmentPattern(centerJ,centerI,estimatedModuleSize)}}var point=new AlignmentPattern(centerJ,centerI,estimatedModuleSize);this.possibleCenters.push(point);if(this.resultPointCallback!=null){this.resultPointCallback.foundPossibleResultPoint(point)}}return null};this.find=function(){var startX=this.startX;var height=this.height;var maxJ=startX+width;var middleI=startY+(height>>1);var stateCount=new Array(0,0,0);for(var iGen=0;iGen<height;iGen++){var i=middleI+((iGen&1)==0?((iGen+1)>>1):-((iGen+1)>>1));stateCount[0]=0;stateCount[1]=0;stateCount[2]=0;var j=startX;while(j<maxJ&&!image[j+qrcode.width*i]){j++}var currentState=0;while(j<maxJ){if(image[j+i*qrcode.width]){if(currentState==1){stateCount[currentState]++}else{if(currentState==2){if(this.foundPatternCross(stateCount)){var confirmed=this.handlePossibleCenter(stateCount,i,j);if(confirmed!=null){return confirmed}}stateCount[0]=stateCount[2];stateCount[1]=1;stateCount[2]=0;currentState=1}else{stateCount[++currentState]++}}}else{if(currentState==1){currentState++}stateCount[currentState]++}j++}if(this.foundPatternCross(stateCount)){var confirmed=this.handlePossibleCenter(stateCount,i,maxJ);if(confirmed!=null){return confirmed}}}if(!(this.possibleCenters.length==0)){return this.possibleCenters[0]}throw"Couldn't find enough alignment patterns"}}function QRCodeDataBlockReader(blocks,version,numErrorCorrectionCode){this.blockPointer=0;this.bitPointer=7;this.dataLength=0;this.blocks=blocks;this.numErrorCorrectionCode=numErrorCorrectionCode;if(version<=9){this.dataLengthMode=0}else{if(version>=10&&version<=26){this.dataLengthMode=1}else{if(version>=27&&version<=40){this.dataLengthMode=2}}}this.getNextBits=function(numBits){var bits=0;if(numBits<this.bitPointer+1){var mask=0;for(var i=0;i<numBits;i++){mask+=(1<<i)}mask<<=(this.bitPointer-numBits+1);bits=(this.blocks[this.blockPointer]&mask)>>(this.bitPointer-numBits+1);this.bitPointer-=numBits;return bits}else{if(numBits<this.bitPointer+1+8){var mask1=0;for(var i=0;i<this.bitPointer+1;i++){mask1+=(1<<i)}bits=(this.blocks[this.blockPointer]&mask1)<<(numBits-(this.bitPointer+1));this.blockPointer++;bits+=((this.blocks[this.blockPointer])>>(8-(numBits-(this.bitPointer+1))));this.bitPointer=this.bitPointer-numBits%8;if(this.bitPointer<0){this.bitPointer=8+this.bitPointer}return bits}else{if(numBits<this.bitPointer+1+16){var mask1=0;var mask3=0;for(var i=0;i<this.bitPointer+1;i++){mask1+=(1<<i)}var bitsFirstBlock=(this.blocks[this.blockPointer]&mask1)<<(numBits-(this.bitPointer+1));this.blockPointer++;var bitsSecondBlock=this.blocks[this.blockPointer]<<(numBits-(this.bitPointer+1+8));this.blockPointer++;for(var i=0;i<numBits-(this.bitPointer+1+8);i++){mask3+=(1<<i)}mask3<<=8-(numBits-(this.bitPointer+1+8));var bitsThirdBlock=(this.blocks[this.blockPointer]&mask3)>>(8-(numBits-(this.bitPointer+1+8)));bits=bitsFirstBlock+bitsSecondBlock+bitsThirdBlock;this.bitPointer=this.bitPointer-(numBits-8)%8;if(this.bitPointer<0){this.bitPointer=8+this.bitPointer}return bits}else{return 0}}}};this.NextMode=function(){if((this.blockPointer>this.blocks.length-this.numErrorCorrectionCode-2)){return 0}else{return this.getNextBits(4)}};this.getDataLength=function(modeIndicator){var index=0;while(true){if((modeIndicator>>index)==1){break}index++}return this.getNextBits(qrcode.sizeOfDataLengthInfo[this.dataLengthMode][index])};this.getRomanAndFigureString=function(dataLength){var length=dataLength;var intData=0;var strData="";var tableRomanAndFigure=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":");do{if(length>1){intData=this.getNextBits(11);var firstLetter=Math.floor(intData/45);var secondLetter=intData%45;strData+=tableRomanAndFigure[firstLetter];strData+=tableRomanAndFigure[secondLetter];length-=2}else{if(length==1){intData=this.getNextBits(6);strData+=tableRomanAndFigure[intData];length-=1}}}while(length>0);return strData};this.getFigureString=function(dataLength){var length=dataLength;var intData=0;var strData="";do{if(length>=3){intData=this.getNextBits(10);if(intData<100){strData+="0"}if(intData<10){strData+="0"}length-=3}else{if(length==2){intData=this.getNextBits(7);if(intData<10){strData+="0"}length-=2}else{if(length==1){intData=this.getNextBits(4);length-=1}}}strData+=intData}while(length>0);return strData};this.get8bitByteArray=function(dataLength){var length=dataLength;var intData=0;var output=new Array();do{intData=this.getNextBits(8);output.push(intData);length--}while(length>0);return output};this.getKanjiString=function(dataLength){var length=dataLength;var intData=0;var unicodeString="";do{intData=getNextBits(13);var lowerByte=intData%192;var higherByte=intData/192;var tempWord=(higherByte<<8)+lowerByte;var shiftjisWord=0;if(tempWord+33088<=40956){shiftjisWord=tempWord+33088}else{shiftjisWord=tempWord+49472}unicodeString+=String.fromCharCode(shiftjisWord);length--}while(length>0);return unicodeString};this.__defineGetter__("DataByte",function(){var output=new Array();var MODE_NUMBER=1;var MODE_ROMAN_AND_NUMBER=2;var MODE_8BIT_BYTE=4;var MODE_KANJI=8;do{var mode=this.NextMode();if(mode==0){if(output.length>0){break}else{throw"Empty data block"}}if(mode!=MODE_NUMBER&&mode!=MODE_ROMAN_AND_NUMBER&&mode!=MODE_8BIT_BYTE&&mode!=MODE_KANJI){throw"Invalid mode: "+mode+" in (block:"+this.blockPointer+" bit:"+this.bitPointer+")"}dataLength=this.getDataLength(mode);if(dataLength<1){throw"Invalid data length: "+dataLength}switch(mode){case MODE_NUMBER:var temp_str=this.getFigureString(dataLength);var ta=new Array(temp_str.length);for(var j=0;j<temp_str.length;j++){ta[j]=temp_str.charCodeAt(j)}output.push(ta);break;case MODE_ROMAN_AND_NUMBER:var temp_str=this.getRomanAndFigureString(dataLength);var ta=new Array(temp_str.length);for(var j=0;j<temp_str.length;j++){ta[j]=temp_str.charCodeAt(j)}output.push(ta);break;case MODE_8BIT_BYTE:var temp_sbyteArray3=this.get8bitByteArray(dataLength);output.push(temp_sbyteArray3);break;case MODE_KANJI:var temp_str=this.getKanjiString(dataLength);output.push(temp_str);break}}while(true);return output})}this.decode=function decode(src,successCallback,failCallback){qrcode.decode(src,successCallback,failCallback)}})();var base=arguments.callee.prototype;var internal={};internal.instance=null;internal.onEncodedCallback=null;internal.encodedImageContainer=null;internal.renderingTimer=null;this.init=function init(){internal.instance=this;internal.encodedImageContainer=document.createElement("div");internal.renderingTimer=-1;return this};this.release=function release(){internal=null};this.encode=function encode(text,callback,width,height,colorDark,colorLight,correctLevel){internal.onEncodedCallback=callback;new QRCode(internal.encodedImageContainer,{text:text,width:(width|0),height:(height|0),colorDark:colorDark,colorLight:colorLight,correctLevel:(correctLevel|0)});if(internal.renderingTimer!=-1){clearInterval(internal.renderingTimer);internal.renderingTimer=-1}internal.renderingTimer=setInterval(internal.rendering,100)};this.decode=function decode(src,successCallback,failCallback){QRReader.decode(src,successCallback,failCallback)};internal.rendering=function rendering(){if(internal.encodedImageContainer.getElementsByTagName("img").length==0){return}var img=internal.encodedImageContainer.getElementsByTagName("img")[0];if(img.src==""){return}internal.encodedImageContainer.innerHTML="";clearInterval(internal.renderingTimer);internal.renderingTimer=-1;internal.onEncodedCallback.call(internal.instance,""+img.src)};return this.init.apply(this,arguments)};return tvg})(tvg);tvg=(function(b){b.client.util.classes.Translator=function a(g){var e={};this.init=function d(h){e.strings=h;this.language=b.client.data.Driver.current.get("language","en");if(!e.strings[this.language]){if(!e.strings.en){return}this.language="en"}this.languages={en:"English",sr:"Srpski"};return this};this.release=function f(){e=null};this.get=function c(h){if(e.strings[this.language][h]){return e.strings[this.language][h]}if(e.strings.en&&e.strings.en[h]){return e.strings.en[h]}return""};return this.init.apply(this,arguments)};return b})(tvg);tvg=(function(c){c.client.net.classes.server=function b(){var f={};this.url=null;this.session=null;this.playerId=null;this.lastSyncedFrame=null;this.onStateUpdated=null;this.init=function e(s){c.game.log.information("Initializing network client "+s+".");this.url=s?""+s:null;this.session=null;f.previousStateReceived=null;this.playerId=null;this.lastSyncedFrame=null;this.onStateUpdated=null;return this};this.release=function m(){this.url=null;this.session=null;f.previousStateReceived=null;this.playerId=null;this.lastSyncedFrame=null;this.onStateUpdated=null;f=null};this.getPlayer=function d(){if(this.session&&this.playerId){return this.session.state.players[this.playerId]}return null};this.startGame=function n(u,t,v,s){c.game.log.information("Starting game "+u+", "+t+".");this.invokeRaw("startGame",[null,null,u,t],this.onGameJoined,s,v)};this.joinGame=function i(u,t,v,s){c.game.log.information("Game "+u+", player "+t+" joining.");this.invokeRaw("joinGame",[u,null,t],this.onGameJoined,s,v)};this.onGameJoined=function k(t,s){var u=performance.now();c.game.log.information("Game "+t.state.id+", joined.");this.session=new c.game.classes.session(t.state);f.previousStateReceived=null;this.lastSyncedFrame=this.session.state.frame;c.game.kernel.addSession(this.session);this.session.startTime=u-this.session.state.time;this.playerId=t.playerId;if(s){s.call(this,t)}this.sync()};this.leaveGame=function j(s){if(!this.session){c.game.log.warning("leaveGame called, but not in a game.");if(s){s.call(this,null)}return}c.game.log.information("Game "+this.session.id+", leaving.");this.invoke("leaveGame",[this.playerId],this.onGameLeft,this.onGameLeft,s)};this.onGameLeft=function l(s,t){if(this.session){c.game.log.information("Game "+this.session.id+", left.");this.session=null}f.previousStateReceived=null;this.playerId=null;this.lastSyncedFrame=null;f.running=false;if(t){t.call(this,s)}};this.sync=function o(){if(!this.session){return}this.invokeRaw("getState",[this.session.id,this.lastSyncedFrame,this.playerId],this.syncSucceeded,this.syncFailed)};this.syncSucceeded=function r(s){if(!this.session){return}var u=performance.now();if(f.previousStateReceived){this.session.loadState(f.previousStateReceived)}this.session.loadState(s);f.previousStateReceived=this.session.saveState();var t=u-this.session.state.time;if(t<this.session.startTime){this.session.startTime=t}this.lastSyncedFrame=this.session.state.frame;if(this.onStateUpdated){this.onStateUpdated(this.session.state)}this.sync()};this.syncFailed=function q(s){if(!this.session){return}if(s&&s.error=="Time out."){this.sync()}};this.invokeRaw=function h(s,t,y,u,x){var z=new XMLHttpRequest();var v=this;z.onreadystatechange=function w(){if(z.readyState==4){if(z.status==200){if(y){y.call(v,JSON.parse(z.responseText?z.responseText:"{}"),x,z.status)}}else{if(u){u.call(v,JSON.parse(z.responseText?z.responseText:"{}"),x,z.status)}}}};z.open("POST",this.url+s,true);z.setRequestHeader("Content-Type","application/json");z.send(JSON.stringify(t))};this.invoke=function g(s,t,w,u,v){if(!t){t=[]}t.unshift(null);t.unshift(this.session.id);this.invokeRaw(s,t,w,u,v)};return this.init.apply(this,arguments)};c.client.net.classes.server.detected={host:null,appName:null};c.client.net.classes.server.detect=function a(d){var e=document.createElement("script");e.type="text/javascript";e.src="http://"+d+":8069/detectApp?";document.getElementsByTagName("head")[0].appendChild(e)};return c})(tvg);tvg.product={};tvg.product.pah={Nickname:"Anonymous",game:{},screen:{},sfx:{samples:{},load:function load(b,a){if(tvg.product.pah.sfx.samples[b]){return}tvg.product.pah.sfx.samples[b]=new tvg.client.sfx.classes.SimpleSound(b,a)},play:function play(a){if(!tvg.product.pah.sfx.samples[a]){return}tvg.product.pah.sfx.samples[a].play()}}};tvg=(function(b){b.product.pah.screen.PahScreen=function a(){var c=arguments.callee.prototype;this.init=function d(g){c.init.call(this,g);this.fontSize={heading:{large:1800,medium:1400,small:1000},text:{large:900,medium:700,small:500}};return this};this.release=function f(){c.release.call(this)};this.onClick=function e(i,g){i.eventHandlers.PointerClick=function h(k,j){new b.client.gfx.classes.Animation(i,"y",i.y+250,150,b.client.gfx.classes.Animation.animationFunction.bounce,g)}};return this.init.apply(this,arguments)};b.product.pah.screen.PahScreen.prototype=new b.client.gfx.classes.Screen();return b})(tvg);tvg=(function(b){b.product.pah.screen.ConfigureScreen=function a(){var c=arguments.callee.prototype;var e={};e.strings=new b.client.util.classes.Translator({en:{Calibrate:"Calibration",Language:"Language",Back:"Back"},sr:{Calibrate:"Kalibracija",Language:"Jezik",Back:"Nazad"}});this.init=function d(){c.init.call(this,"ConfigureScreen");e.background=new b.client.gfx.classes.Sprite("configure.background",0,0,12000,16000,"120x160-blank.png");e.background.alpha=false;e.background.show();this.addChild(e.background);e.calibrateMenuItem=new b.client.gfx.classes.Text("configure.calibrateMenuItem",1000,4000,10000,this.fontSize.heading.large+500,e.strings.get("Calibrate"),"CaptionFont, sans-serif","#8f2",this.fontSize.heading.large,"center middle");this.onClick(e.calibrateMenuItem,e.onCalibrate);e.calibrateMenuItem.show();this.addChild(e.calibrateMenuItem);e.languageMenuItem=new b.client.gfx.classes.Text("configure.languageMenuItem",1000,6000,10000,this.fontSize.heading.large+500,e.strings.get("Language"),"CaptionFont, sans-serif","#8f2",this.fontSize.heading.large,"center middle");this.onClick(e.languageMenuItem,e.onLanguage);e.languageMenuItem.show();this.addChild(e.languageMenuItem);e.doneButton=new b.client.gfx.classes.Text("configure.back",1000,12000,10000,this.fontSize.heading.medium+500,e.strings.get("Back"),"CaptionFont, sans-serif","#f00",this.fontSize.heading.medium,"center middle");e.doneButton.show();this.addChild(e.doneButton);this.onClick(e.doneButton,e.onDone);this.eventHandlers.KeyDown=e.onKeyDown;return this};this.release=function j(){e=null;c.release.call(this)};e.onCalibrate=function f(n,m){b.product.pah.sfx.play("key");b.product.pah.PahApplication.showScreen(b.product.pah.screen.CalibrateScreen)};e.onLanguage=function i(n,m){b.product.pah.sfx.play("key");b.product.pah.PahApplication.showScreen(b.product.pah.screen.LanguageScreen)};e.onDone=function g(){b.product.pah.sfx.play("ack");e.showMainMenuScreen()};e.showMainMenuScreen=function k(){b.product.pah.PahApplication.showScreen(b.product.pah.screen.MainMenuScreen)};e.onKeyDown=function h(n,m){if(m.name=="Escape"){e.showMainMenuScreen()}else{if(m.name=="Enter"){e.onDone()}}};this.tick=function l(m){if(!b.client.input.Orientation.supported&&e.calibrateMenuItem.visible){e.calibrateMenuItem.hide()}};return this.init.apply(this,arguments)};b.product.pah.screen.ConfigureScreen.prototype=new b.product.pah.screen.PahScreen();return b})(tvg);tvg=(function(b){b.product.pah.screen.CalibrateScreen=function a(){var e=arguments.callee.prototype;var i={};i.currentBackgroundSprite=0;i.step=0;i.timeoutId=null;i.strings=new b.client.util.classes.Translator({en:{"Put me face-up on the table.":"Put me face-up on the table.","You're on!":"You're on!",Back:"Back","In your hand?":"In your hand?","Face-up on the table?":"Face-up on the table?","Face-down on the table?":"Face-down on the table?","Wait, calibrating...":"Wait, calibrating...","Rotate me 90 degrees clockwise.":"Rotate me 90 degrees clockwise.","Rotated!":"Rotated!","Put me face-down on the table!":"Put me face-down on the table!","Unable to calibrate.":"Unable to calibrate."},sr:{"Put me face-up on the table.":"Spusti me licem dole na sto.","You're on!":"Spušten!",Back:"Nazad","In your hand?":"U ruci?","Face-up on the table?":"Licem gore na stolu?","Face-down on the table?":"Licem dole na stolu?","Wait, calibrating...":"Čekaj, kalibrišem...","Rotate me 90 degrees clockwise.":"Zarotiraj me za 90 stepeni u smeru kazaljke.","Rotated!":"Zarotiran!","Put me face-down on the table!":"Spusti me licem dole na sto!","Unable to calibrate.":"Ne mogu da kalibrišem."}});this.init=function h(){e.init.call(this,"CalibrateScreen");i.background=new b.client.gfx.classes.Sprite("calibrate.background",0,0,12000,16000,"120x160-blank.png");i.background.alpha=false;i.background.show();this.addChild(i.background);i.orientationText=new b.client.gfx.classes.Text("calibrate.orientationText",1000,2000,10000,this.fontSize.text.small+100," ","RegularFont, sans-serif","#eff",this.fontSize.text.small,"center middle");i.orientationText.show();this.addChild(i.orientationText);i.instructionText=new b.client.gfx.classes.Text("calibrate.instructionText",1000,3000,10000,this.fontSize.text.small+100,i.strings.get("Put me face-up on the table."),"RegularFont, sans-serif","#eff",this.fontSize.text.small,"center middle");i.instructionText.show();this.addChild(i.instructionText);i.sensorText=new b.client.gfx.classes.Text("calibrate.sensorText",3000,5000,6000,2000," ","Helvetica, sans-serif","#eff",this.fontSize.text.small,"left middle");i.sensorText.show();this.addChild(i.sensorText);i.calibrateMenuItem=new b.client.gfx.classes.Text("calibrate.calibrateMenuItem",1000,8000,10000,this.fontSize.heading.large+500,i.strings.get("You're on!"),"CaptionFont, sans-serif","#8f2",this.fontSize.heading.large,"center middle");i.calibrateMenuItem.show();this.onClick(i.calibrateMenuItem,i.onCalibrate);this.addChild(i.calibrateMenuItem);i.backMenuItem=new b.client.gfx.classes.Text("calibrate.backMenuItem",1000,13000,10000,this.fontSize.heading.medium+100,i.strings.get("Back"),"CaptionFont, sans-serif","#f00",this.fontSize.heading.medium,"center middle");i.backMenuItem.show();this.onClick(i.backMenuItem,i.onBack);this.addChild(i.backMenuItem);this.eventHandlers.KeyDown=i.onKeyDown;this.eventHandlers.OrientationChanged=i.onOrientationChanged;i.onOrientationChanged();return this};this.release=function r(){if(i&&i.timeoutId){clearTimeout(i.timeoutId)}i=null;e.release.call(this)};i.samples={position1:{alpha:null,beta:null,gamma:null},position2:{alpha:null,beta:null,gamma:null},position3:{alpha:null,beta:null,gamma:null},deviation1:{alpha:null,beta:null,gamma:null},deviation2:{alpha:null,beta:null,gamma:null},deviation3:{alpha:null,beta:null,gamma:null}};this.tick=function t(u){if(i.step!=0){i.sensorText.setText("? "+(Math.round(b.client.input.Orientation.mean.alpha*100)/100)+"\nß "+(Math.round(b.client.input.Orientation.mean.beta*100)/100)+"\n? "+(Math.round(b.client.input.Orientation.mean.gamma*100)/100))}};i.onOrientationChanged=function o(v,u){switch(u?u.orientation:b.client.input.Orientation.current){case b.client.input.Orientations.Moving:i.orientationText.setText(i.strings.get("In your hand?"));break;case b.client.input.Orientations.FaceUp:i.orientationText.setText(i.strings.get("Face-up on the table?"));break;case b.client.input.Orientations.FaceDown:i.orientationText.setText(i.strings.get("Face-down on the table?"));break}};i.onCalibrate=function n(){b.product.pah.sfx.play("ack");switch(i.step){case 0:i.instructionText.setText(i.strings.get("Wait, calibrating..."));i.calibrateMenuItem.hide();i.timeoutId=setTimeout(i.onFirstStepComplete,2000);break;case 1:i.instructionText.setText(i.strings.get("Wait, calibrating..."));i.calibrateMenuItem.hide();i.timeoutId=setTimeout(i.onSecondStepComplete,2000);break}i.step++};i.angleDiff=function d(u,v){if(u<0){u+=360}if(v<0){v+=360}return Math.abs(((u-v+180+360)%360)-180)};i.angleAvg=function c(u,v){if(u<0){u+=360}if(v<0){v+=360}var w=Math.atan2(Math.sin(u*(Math.PI/180))+Math.sin(v*(Math.PI/180)),Math.cos(u*(Math.PI/180))+Math.cos(v*(Math.PI/180)))*(180/Math.PI);return isNaN(w)?0:w};i.onFirstStepComplete=function l(){i.samples.position1.alpha=b.client.input.Orientation.mean.alpha;i.samples.position1.beta=b.client.input.Orientation.mean.beta;i.samples.position1.gamma=b.client.input.Orientation.mean.gamma;i.samples.deviation1.alpha=b.client.input.Orientation.deviation.alpha;i.samples.deviation1.beta=b.client.input.Orientation.deviation.beta;i.samples.deviation1.gamma=b.client.input.Orientation.deviation.gamma;i.instructionText.setText(i.strings.get("Rotate me 90 degrees clockwise."));i.calibrateMenuItem.setText(i.strings.get("Rotated!"));i.calibrateMenuItem.show();i.timeoutId=null};i.onSecondStepComplete=function q(){i.samples.position2.alpha=b.client.input.Orientation.mean.alpha;i.samples.position2.beta=b.client.input.Orientation.mean.beta;i.samples.position2.gamma=b.client.input.Orientation.mean.gamma;i.samples.deviation2.alpha=b.client.input.Orientation.deviation.alpha;i.samples.deviation2.beta=b.client.input.Orientation.deviation.beta;i.samples.deviation2.gamma=b.client.input.Orientation.deviation.gamma;i.finalStep()};i.finalStep=function g(){b.product.pah.sfx.play("ack");i.instructionText.setText(i.strings.get("Put me face-down on the table!"));i.calibrateMenuItem.hide();i.timeoutId=setTimeout(i.onCalibrationComplete,8000)};i.doCalibrate=function f(y){var C=null,A=null;var B=null,z=null;for(var u=0;u<360;u+=90){var v=i.angleDiff(i.samples.position1[y],u);var w=i.angleDiff(i.samples.position2[y],u);var x=i.angleDiff(i.samples.position3[y],u);if(v<15&&w<15&&x<15){C=A=u;B=z=1+Math.max(v,w,x)+3*Math.max(i.samples.deviation1[y],i.samples.deviation2[y],i.samples.deviation3[y])}else{if(v<15&&w<15){C=u;B=1+Math.max(v,w)+3*Math.max(i.samples.deviation1[y],i.samples.deviation2[y])}else{if(x<15){A=u;z=1+x+3*i.samples.deviation3[y]}}}}b.client.input.Orientation.calibration.faceUp.mean[y]=C===null?0:C;b.client.input.Orientation.calibration.faceUp.deviation[y]=B===null?180:Math.max(2,B,z);b.client.input.Orientation.calibration.faceDown.mean[y]=A===null?0:A;b.client.input.Orientation.calibration.faceDown.deviation[y]=z===null?180:Math.max(2,B,z);i.saveCalibration(y)};i.saveCalibration=function s(u){b.client.data.Driver.current.set("calibration.faceUp.mean."+u,b.client.input.Orientation.calibration.faceUp.mean[u]);b.client.data.Driver.current.set("calibration.faceUp.deviation."+u,b.client.input.Orientation.calibration.faceUp.deviation[u]);b.client.data.Driver.current.set("calibration.faceDown.mean."+u,b.client.input.Orientation.calibration.faceDown.mean[u]);b.client.data.Driver.current.set("calibration.faceDown.deviation."+u,b.client.input.Orientation.calibration.faceDown.deviation[u])};i.onCalibrationComplete=function k(){b.product.pah.sfx.play("ack");i.samples.position3.alpha=b.client.input.Orientation.mean.alpha;i.samples.position3.beta=b.client.input.Orientation.mean.beta;i.samples.position3.gamma=b.client.input.Orientation.mean.gamma;i.samples.deviation3.alpha=b.client.input.Orientation.deviation.alpha;i.samples.deviation3.beta=b.client.input.Orientation.deviation.beta;i.samples.deviation3.gamma=b.client.input.Orientation.deviation.gamma;var x="N = ?";var u=i.angleDiff(i.samples.position1.alpha,i.samples.position2.alpha);var v=i.angleDiff(i.samples.position1.beta,i.samples.position2.beta);var w=i.angleDiff(i.samples.position1.gamma,i.samples.position2.gamma);i.instructionText.setText();if(u<15&&v<15&&w<15){i.instructionText.setText(i.strings.get("Unable to calibrate."))}else{if(v<15&&w<15){x="N = ? (+-"+(Math.round(u*100)/100)+")";b.client.input.Orientation.calibration.faceUp.mean.alpha=b.client.input.Orientation.calibration.faceDown.mean.alpha=0;b.client.input.Orientation.calibration.faceUp.deviation.alpha=b.client.input.Orientation.calibration.faceDown.deviation.alpha=180;i.saveCalibration("alpha");i.doCalibrate("beta");i.doCalibrate("gamma")}else{if(u<15&&w<15){x="N = ß (+-"+(Math.round(v*100)/100)+")";i.doCalibrate("alpha");b.client.input.Orientation.calibration.faceUp.mean.beta=b.client.input.Orientation.calibration.faceDown.mean.beta=0;b.client.input.Orientation.calibration.faceUp.deviation.beta=b.client.input.Orientation.calibration.faceDown.deviation.beta=180;i.saveCalibration("beta");i.doCalibrate("gamma")}else{if(u<15&&v<15){x="N = ? (+-"+(Math.round(w*100)/100)+")";i.doCalibrate("alpha");i.doCalibrate("beta");b.client.input.Orientation.calibration.faceUp.mean.gamma=b.client.input.Orientation.calibration.faceDown.mean.gamma=0;b.client.input.Orientation.calibration.faceUp.deviation.gamma=b.client.input.Orientation.calibration.faceDown.deviation.gamma=180;i.saveCalibration("gamma")}}}}i.sensorText.setText(x+"\n?^ "+(b.client.input.Orientation.calibration.faceUp.mean.alpha|0)+"(+-"+(b.client.input.Orientation.calibration.faceUp.deviation.alpha|0)+")\nß^ "+(b.client.input.Orientation.calibration.faceUp.mean.beta|0)+"(+-"+(b.client.input.Orientation.calibration.faceUp.deviation.beta|0)+")\n?^ "+(b.client.input.Orientation.calibration.faceUp.mean.gamma|0)+"(+-"+(b.client.input.Orientation.calibration.faceUp.deviation.gamma|0)+")\n?ˇ "+(b.client.input.Orientation.calibration.faceDown.mean.alpha|0)+"(+-"+(b.client.input.Orientation.calibration.faceDown.deviation.alpha|0)+")\nßˇ "+(b.client.input.Orientation.calibration.faceDown.mean.beta|0)+"(+-"+(b.client.input.Orientation.calibration.faceDown.deviation.beta|0)+")\n?ˇ "+(b.client.input.Orientation.calibration.faceDown.mean.gamma|0)+"(+-"+(b.client.input.Orientation.calibration.faceDown.deviation.gamma|0)+")");i.timeoutId=null;i.step=0};i.onBack=function j(){b.product.pah.sfx.play("key");b.product.pah.PahApplication.showScreen(b.product.pah.screen.MainMenuScreen)};i.onKeyDown=function m(v,u){if(u.name=="Escape"){i.onBack()}};return this.init.apply(this,arguments)};b.product.pah.screen.CalibrateScreen.prototype=new b.product.pah.screen.PahScreen();return b})(tvg);tvg=(function(b){b.product.pah.screen.LanguageScreen=function a(){var c=arguments.callee.prototype;var e={};e.strings=new b.client.util.classes.Translator({en:{"Select language:":"Select language:",Back:"Back"},sr:{"Select language:":"Izaberi jezik:",Back:"Nazad"}});this.init=function d(){c.init.call(this,"LanguageScreen");e.background=new b.client.gfx.classes.Sprite("languages.background",0,0,12000,16000,"120x160-blank.png");e.background.alpha=false;e.background.show();this.addChild(e.background);e.infoText=new b.client.gfx.classes.Text("languages.infoText",1000,2000,10000,this.fontSize.text.small+100,e.strings.get("Select language:"),"RegularFont, sans-serif","#eff",this.fontSize.text.small,"center middle");e.infoText.show();this.addChild(e.infoText);e.menu=new b.client.gfx.classes.List("languages.menu",1000,3500,10000,8000,0);e.menu.show();this.addChild(e.menu);for(var j in e.strings.languages){e.menu.addItem(new b.client.gfx.classes.Text("languages.language"+j+"MenuItem",1000,0,10000,this.fontSize.heading.large+500,e.strings.languages[j],"CaptionFont, sans-serif","#8f2",this.fontSize.heading.large,"center middle"),e.onSelected)}e.backMenuItem=new b.client.gfx.classes.Text("language.backMenuItem",1000,13000,10000,this.fontSize.heading.medium+100,e.strings.get("Back"),"CaptionFont, sans-serif","#f00",this.fontSize.heading.medium,"center middle");this.onClick(e.backMenuItem,e.showMainMenuScreen);e.backMenuItem.show();this.addChild(e.backMenuItem);this.eventHandlers.KeyDown=e.onKeyDown;return this};this.release=function h(){e=null;c.release.call(this)};e.onSelected=function g(){b.product.pah.sfx.play("ack");for(var j in e.strings.languages){if(e.strings.languages[j]==this.text){b.client.data.Driver.current.set("language",j)}}e.showMainMenuScreen()};e.showMainMenuScreen=function i(){b.product.pah.sfx.play("key");b.product.pah.PahApplication.showScreen(b.product.pah.screen.MainMenuScreen)};e.onKeyDown=function f(k,j){if(j.name=="Escape"){e.showMainMenuScreen()}};return this.init.apply(this,arguments)};b.product.pah.screen.LanguageScreen.prototype=new b.product.pah.screen.PahScreen();return b})(tvg);tvg=(function(b){b.product.pah.screen.MainMenuScreen=function a(){var c=arguments.callee.prototype;var e={};e.strings=new b.client.util.classes.Translator({en:{Configure:"Configuration",Start:"Start",Join:"Join"},sr:{Configure:"Konfiguracija",Start:"Pokreni",Join:"Uključi se"}});this.init=function d(){c.init.call(this,"MainMenuScreen");e.background=new b.client.gfx.classes.Sprite("menu.background",0,0,12000,16000,"120x160-blank.png");e.background.alpha=false;e.background.show();this.addChild(e.background);e.configureMenuItem=new b.client.gfx.classes.Text("menu.configureMenuItem",1000,2000,10000,this.fontSize.heading.small+200,e.strings.get("Configure"),"CaptionFont, sans-serif","#8f2",this.fontSize.heading.small,"center middle");this.onClick(e.configureMenuItem,e.onConfigure);e.configureMenuItem.show();this.addChild(e.configureMenuItem);e.NicknameMenuItem=new b.client.gfx.classes.Text("menu.NicknameMenuItem",1000,6500,10000,this.fontSize.text.large+100,""+b.product.pah.Nickname,"RegularFont, sans-serif","#8f2",this.fontSize.text.large,"center middle");this.onClick(e.NicknameMenuItem,e.onNickname);e.NicknameMenuItem.show();this.addChild(e.NicknameMenuItem);var k=b.game.configuration.simpleJoinMode&&b.client.net.classes.server.detected.host;e.startGameMenuItem=new b.client.gfx.classes.Text("menu.startGameMenuItem",1000,k?11500:9500,10000,this.fontSize.heading.large+500,e.strings.get("Start"),"CaptionFont, sans-serif","#8f2",this.fontSize.heading.large,"center middle");this.onClick(e.startGameMenuItem,e.onStartGame);e.startGameMenuItem.show();this.addChild(e.startGameMenuItem);if(!k){e.joinGameMenuItem=new b.client.gfx.classes.Text("menu.joinGameMenuItem",1000,11500,10000,this.fontSize.heading.large+500,e.strings.get("Join")," CaptionFont, sans-serif","#8f2",this.fontSize.heading.large,"center middle");this.onClick(e.joinGameMenuItem,e.onJoinGame);e.joinGameMenuItem.show();this.addChild(e.joinGameMenuItem)}this.eventHandlers.KeyDown=e.onKeyDown;return this};this.release=function j(){e=null;c.release.call(this)};e.onNickname=function h(k){b.product.pah.sfx.play("key");b.product.pah.PahApplication.showScreen(b.product.pah.screen.PickaNickScreen)};e.onConfigure=function f(l,k){b.product.pah.sfx.play("key");b.product.pah.PahApplication.showScreen(b.product.pah.screen.ConfigureScreen)};e.onStartGame=function i(l,k){b.product.pah.sfx.play("key");b.product.pah.PahApplication.showScreen(b.product.pah.screen.StartGameScreen)};e.onJoinGame=function i(l,k){b.product.pah.sfx.play("key");b.product.pah.PahApplication.showScreen(b.product.pah.screen.JoinGameScreen)};e.onKeyDown=function g(l,k){if(k.name=="Escape"){b.client.quit()}};return this.init.apply(this,arguments)};b.product.pah.screen.MainMenuScreen.prototype=new b.product.pah.screen.PahScreen();return b})(tvg);tvg=(function(b){b.product.pah.screen.SplashScreen=function a(){var c=arguments.callee.prototype;var e={};this.init=function d(){c.init.call(this,"SplashScreen");e.background=new b.client.gfx.classes.Sprite("splash.background",0,0,12000,16000,"120x160-splash.png");e.background.alpha=false;e.background.show();this.addChild(e.background);e.CaptionText=new b.client.gfx.classes.Text("splash.CaptionText",3000,13000,6000,this.fontSize.heading.small+200," ","CaptionFont, sans-serif","#fff",this.fontSize.heading.small,"center middle");e.CaptionText.show();this.addChild(e.CaptionText);e.RegularText=new b.client.gfx.classes.Text("splash.RegularText",3000,13000,6000,this.fontSize.text.small+100," ","RegularFont, sans-serif","#fff",this.fontSize.text.small,"center middle");e.RegularText.show();this.addChild(e.RegularText);this.eventHandlers.KeyDown=e.onKeyDown;this.eventHandlers.PointerClick=e.onPointerDown;e.timeout=setTimeout(e.showMainMenuScreen,3000);b.product.pah.sfx.load("key","tvg-key");b.product.pah.sfx.load("ack","tvg-ack");b.product.pah.sfx.load("turn","tvg-turn");return this};this.release=function h(){if(e.timeout){clearTimeout(e.timeout)}e=null;c.release.call(this)};e.onKeyDown=function f(k,j){switch(j.code){case b.client.input.classes.KeyboardDriver.keyCode.Enter:case b.client.input.classes.KeyboardDriver.keyCode.Escape:case b.client.input.classes.KeyboardDriver.keyCode.Space:e.showMainMenuScreen();break;default:break}};e.onPointerDown=function g(k,j){e.showMainMenuScreen()};e.showMainMenuScreen=function i(){clearTimeout(e.timeout);e.timeout;b.product.pah.PahApplication.showScreen(b.product.pah.Nickname=="Anonymous"?b.product.pah.screen.PickaNickScreen:b.product.pah.screen.MainMenuScreen)};return this.init.apply(this,arguments)};b.product.pah.screen.SplashScreen.prototype=new b.product.pah.screen.PahScreen();return b})(tvg);tvg=(function(b){b.product.pah.screen.PickaNickScreen=function a(){var c=arguments.callee.prototype;var e={};e.strings=new b.client.util.classes.Translator({en:{"Select a nickname:":"Select a nickname:",Anonymous:"Anonymous",Done:"Done"},sr:{"Select a nickname:":"Izaberi nadimak:",Anonymous:"Anonymous",Done:"Gotovo"}});this.init=function d(){c.init.call(this,"PickaNickScreen");e.background=new b.client.gfx.classes.Sprite("picknick.background",0,0,12000,16000,"120x160-blank.png");e.background.alpha=false;e.background.show();this.addChild(e.background);e.infoText=new b.client.gfx.classes.Text("picknick.infoText",1000,2000,10000,this.fontSize.text.small+100,e.strings.get("Select a nickname:"),"RegularFont, sans-serif","#eff",this.fontSize.text.small,"center middle");e.infoText.show();this.addChild(e.infoText);e.nicknameTextInput=new b.client.gfx.classes.TextInput("picknick.textInput",1000,3500,10000,2000,b.product.pah.Nickname?b.product.pah.Nickname:e.strings.get("Anonymous"),"RegularFont, sans-serif","#8f2",900,"center middle");e.nicknameTextInput.show();e.nicknameTextInput.setFocus(true);e.nicknameTextInput.eventHandlers.PointerClick=function j(){e.nicknameTextInput.setFocus(true)};this.addChild(e.nicknameTextInput);e.doneButton=new b.client.gfx.classes.Text("picknick.ok",1000,12000,10000,this.fontSize.heading.large+500,e.strings.get("Done"),"CaptionFont, sans-serif","#8f2",this.fontSize.heading.large,"center middle");e.doneButton.show();this.addChild(e.doneButton);this.onClick(e.doneButton,e.onDone);this.eventHandlers.KeyDown=e.onKeyDown;this.eventHandlers.PointerClick=function k(){e.nicknameTextInput.setFocus(false)};return this};this.release=function h(){e=null;c.release.call(this)};e.onDone=function f(){b.product.pah.sfx.play("ack");b.product.pah.Nickname=e.nicknameTextInput.text?e.nicknameTextInput.text:e.strings.get("Anonymous");b.client.data.Driver.current.set("pah.Nickname",b.product.pah.Nickname);e.showMainMenuScreen()};e.showMainMenuScreen=function i(){b.product.pah.PahApplication.showScreen(b.product.pah.screen.MainMenuScreen)};e.onKeyDown=function g(k,j){if(j.name=="Escape"){e.showMainMenuScreen()}else{if(j.name=="Enter"){e.onDone()}}};return this.init.apply(this,arguments)};b.product.pah.screen.PickaNickScreen.prototype=new b.product.pah.screen.PahScreen();return b})(tvg);tvg=(function(b){b.product.pah.screen.StartGameScreen=function a(){var c=arguments.callee.prototype;var e={};e.strings=new b.client.util.classes.Translator({en:{"Select a server:":"Select a server:",Start:"Start","Starting game...":"Starting game...",Back:"Back","Unable to start game":"Unable to start game","*blackCards*":"What would grandma find disturbing, yet oddly charming?\nA romantic, candlelit dinner would be incomplete without _.\nMaybe she's born with it. Maybe it's _.\nWhy am I sticky?\nNext from J. K. Rowling: Harry Potter and the Chamber of _.\nWhat's that sound?\nWhat's my secret power?\nLife for American Indians was forever changed when White Man introduced them to _.\nDear Abby, I'm having some trouble with _ and would like your advice.\nWhat helps Obama unwind?\nWhat gives me uncontrollable gas?\nWhy can't I sleep at night?\nWhat gets better with age?\nWhat are my parents hiding from me?\n_: good to the last drop.\n_. Betcha can't have just one!\nWhen I am President of the United States, I will create the Department of _.\nWhy do I hurt all over?\nBut before I kill you Mr. Bond, I must show you _.\nWhat's there a ton of in heaven?\n_. It's a trap!\n_. That's how I want to die.\nWhat did I bring back from Mexico?\nComing to Brodway this season, _: The Musical.\nWhat's George W. Bush thinking about right now?\nWhen I am a billionare, I shall erect a 50-foot statue to commemorate _.\nAfter the earthquake, Sean Penn brought _ to the people of Haiti.\nMTV's new reality show features eight washed-up celebrities living with _.\nWhite people like _.\nWhat never fails to liven up the party?\nAlternative medicine is now embracing the curative powers of _.\nHow am I maintaining my relationship status?\nWhat don't you want to find in your Kung Pao chicken?\nThe class field trip was completely ruined by _.\n_: kid-tested, mother-approved.\nWhat did Vin Diesel eat for dinner?\nI do not know with what weapons World War III will be fought, but World War IV will be fought with _.\nWhat's the next Happy Meal toy?\nWhat's my anti-drug?\nInstead of coal, Santa now gives the bad children _.\nFun tip! When your man asks you to go down on him, try suprising him with _ instead.\nI get by with a little help from _.\nIt's a pity that kids these days are all getting involved with _.\nThe Smithsonian Museum of Natural History has just opened an interactive exhibit on _.\nIn the new Disney Channel Original Movie, Hannah Montana struggles with _ for the first time.\nWar! What is it good for?\nWhat did the U. S. airdrop to the children of Afghanistan?\n_. High five, bro.\nDuring sex, I like to think about _.\nWhat's that smell?\nI'm sorry, Professor, but I couldn't complete my homework because of _.\nIn 1000 years, when paper money is a distant memory, how will we pay for goods and services?\nHow did I lose my virginity?\nWhat will I bring back in time to convince people that I am a powerful wizard?\nI drink to forget _.\nIntroducing Xtreme Baseball! It's like baseball, but with _!\nWhat ended my last relationship?\nWhat will always get you laid?\nI got 99 problems but _ ain't one.\nDaddy, why is mommy crying?\nA recent laboratory study shows that undergraduates have 50% less sex after being exposed to _.\nWhat's a girl's best friend?\nWhat is Batman's guilty pleasure?\nIn L. A. County Jail, word is you can trade 200 cigarettes for _.\n","*whiteCards*":"Amputees\nSurprise sex!\nBeing fabulous\nFlying sex snakes\nCentaurs\nOld-people smell\nGetting naked and watching Nickelodeon\nPuppies!\nBlack people\nThe Care Bear Stare\nThe Holy Bible\nA defective condom\nSkeletor\nA time travel paradox\nDick fingers\nA salty surprise\nHip hop jewels\nA sassy black woman\n8 oz. of sweet Mexican black-tar heroin\nExtremly tight pants\nSaying 'I love you'\nStalin\nWifely duties\nKeanu Reeves\nSunshine and rainbows\nA tribe of warrior women\nA sea of troubles\nExactly what you'd expect\nKanye West\nNazis\nConsensual sex\nNicolas Cage\nBATMAN!!!\nA bucket of fish heads\nMy vagina\nThe Chinese gymnastic team\nInvading Poland\nMichael Jackson\nItalians\nKids with ass cancer\nSexy pillow fights\nSilence\nThe Blood of Christ\n72 virgins\nA micropenis\nSniffing glue\nGeese\nLactation\nInserting mason jar into my anus\nA bitch slap\nThe Big Bang\nErectile dysfunction\nRunning out of semen\nBeing fat and stupid\nDead parents\nFiery poops\nSexual peeing\nThe miracle of childbirth\nA sad handjob\nBalls\nBeing on fire\nA stray pube\nMultiple stab wounds\nTaking off your shirt\nDark and mysterious forces beyond our control\nTesticular torsion\nSean Penn\nThe milk man\nLand mines\nBattlefield amputations\nDying\nAn ugly face\nCatapults\nThe World of Warcraft\nA man on the brink of orgasm\nChunks of dead hitchiker\nPoor people\nPolice brutality\nAll-you-can-eat shrimp for 4.99\nThree dicks at the same time\nNot wearing pants\nAn icepick lobotomy\nHorrifying laser hair removal accidents\nWhipping it out\nThe pirate's life\nFinger painting\nEmbryonic stem cells\nAn endless stream of diarrhea\nThe heart of a child\nCrucifixion\nWhite people\nDoin' it in the butt\nA fetus\nShiny objects\nAuschwitz\nFriendly fire\nA super Soaker full of cat pee\nA falcon with a cap on its head\nHeartwarming orphans\nForeskin\nScientology\nThe Great Depression\nThe gays\nFlightless birds\nA subscription to Men's Fitness\nThe wonders of Orient\nVehicular manslaughter\nYeast\nChild beauty pageants\nGrowing a pair\nSame-sex ice dancing\nUnfathomable stupidity\nThe Pope\nHistorically black colleges\nThird base\nYOU MUST CONSTRUCT ADDITIONAL PYLONS\nSmallpox blankets\nA Fleshlight\nThe Make-A-Wish Foundation\nThe Trail of Tears\nCybernetic enhancements\nThe wrath of Vladimir Putin\nThe homosexual agenda\nSoup that is too hot\nA robust mongoloid\nObject permanence\nThe Patriarchy\nPixelated bukkake\nA live studio audience\nMy humps\nMaking a pouty face\nSerfdom\nMuhammad (Praise Be Unto Him)\nThe Rapture\nTake-backsies\nWilliam Shatner\nInappropriate yodeling\nFrolicking\nSynergistic management solutions\nThe American Dream\nPuberty\nThe rhythms of Africa\nGenghis Khan\nNickelback\nWomen's suffrage\nFiggy pudding\nA murder most foul\nGrandma\nFear itself\nVigorous jazz hands\nJohn Wilkes Booth\nOompa-Loompas\nA mating display\nDick Cheney\nHelplessly giggling at the mention of Hutus and Tutsis\nSwooping\nMr Clean right behind you\nRacially-biased SAT questions\nThe Kool-Aid Man\nAaron Burr\nFive-Dollar Footlongs\nFunky fresh rhymes\nLockjaw\nOne trillion dollars\nSmegma\nEugenics\nVigilante justice\nDry heaving\nFancy Feast\nFormer President George WBush\nJudge Judy\nCrippling debt\nFeeding Rosie O'Donnell\nThe Little Engine That Could\nAn Oedipus complex\nRepression\nBill Nye the Science Guy\nNatural male enhancement\nQueefing\nA zesty breakfast burrito\nThe folly of man\nHospice care\nA mopey zoo lion\nJoe Biden\nThe token minority\nNew Age music\nSwitching to Geico\nThe Three-Fifths compromise\nToni Morrison's vagina\nThe Hustle\nHer Majesty, Queen Elizabeth II\nCount Chocula\nSarah Palin\nThe Hamburglar\nRonald Reagan\nClassist undertones\nA pyramid of severed heads\nWhite privilege\nCuddling\nSeppuku\nPraying the gay away\nHurricane Katrina\nMechaHitler\nMutually-assured destruction\nThe South\nAdderall\nPrancing\nOpposable thumbs\nBoogers\nRoad head\nBrown people\nNecrophilia\nTasteful sideboob\nWet dreams\nThe Tempur-Pedic Swedish Sleep System\nPooping back and fort Forever\nConcealing a boner\nBeing a motherfucking sorcerer\nChild abuse\nThe Rev. Dr. Martin Luther King, Jr.\nShaquille O'Neal's acting career\nSelf-loathing\nAsians who aren't good at math\nYour weird brother\nEating the last known bison\nPassive-aggressive Post-it notes\nNot giving a shit about the Third World\nCheating in the Special Olympics\nJobs\nMy relationship status\n"},sr:{"Select a server:":"Izaberi server:",Start:"Pokreni","Starting game...":"Počinjem igru...",Back:"Nazad","Unable to start game":"Ne mogu da počnem igru","*blackCards*":"Šta pomaže Vučiću da se opusti?\nŠta bi najbolje upotpunilo romantičnu večeru?\nDa sam predsednik Srbije, osnovao/la bih Ministarstvo za _.\nU Zabeli kruži priča da možeš da đoraš 200 pljuga za _.\nMožda je rođena sa tim, a možda je to _.\nTatice, šta je to rasplakalo mamicu?\nPredstavljamo vam extremne banatske šore. Slične su kao i obične šore, samo im još dodaš _.\nPijem da zaboravim na _.\nSapletoh se na _ i izgubih nevinost.\nŠta to dismr?\nDok se bambusam uglavnom mislim na _.\nUmesto da kleče na kukuruzu, bezobrazna deca danas moraju da kleknu na _.\nŠta je sledeća igračka iz Happy meal-a?\nŠta je Ivan Ivanović pojeo za večeru?\n_ - deca testirala, majke odobrile.\nŠta mi je upropastilo ekskurziju?\nNe želiš da nađeš _ u svojoj punjenoj paprici?\n_ održava strast u mojoj vezi.\n_ uvek zapali atmosferu na žurci.\nMoji roditelji i dalje kriju od mene _.\nBeograđani vole _.\nPosle velikih poplava, Velja Ilić je doneo Obrenovčanima _ na poklon.\nŠta je Ivici Dačiću u glavi?\nŠta sam doneo iz Pirota kao suvenir?\nŠta bi baki iz komšiluka bilo uznemirujuće a opet nekako slatko?\nŠta se to čuje?\n_ mi ne da da zaspim noćima.\n_ mi stvara otrovne gasove.\n_ zaobilazim u širokom luku za vreme posta.\nŠta je moja skrivena super moć?\nŠta postaje bolje s' godinama?\nAli, pre no što Vas ubijem gospdine Bond, moram da Vam pokažem _.\n_ od toga želim da umrem.\nAlternativna medicina trenutno veoma veliča lekovita svojstva koja ima _.\nŠta je moj protivotrov?\nZa hiljadu godina kada i sećanje na papirni novac izbledi, valuta za plaćanje robe i usluga biće _.\nKada bih putovao kroz vreme nazad u prošlost, sa sobom bih poneo _ da ubedim ljude da sam veliki čarobnjak.\nŠta je uništilo moju poslednju vezu?\nImam dosta problema u životu, ali _ nije jedan od njih.\nŠta je devojčin najbolji prijatelj?\n_ me uvek strašno uzbudi.\n_ mi pomaže da preguram dan.\nU novom rijalitiju: _ u društvu 10 raspalih starleta.\n...Kale, Kalemegdan...Kale je _.\nJedino da se _ i ja teleprontujemo iz Kruševca do nekog aerodroma. \n_ prati Marijanu Mateus.\nŠta je to u ćemu Betmen potajno uživa?\nNovo izdanje Kreativnog centra: \"Milica i _ u rođendaonici\".\nA u raju malo, malo pa _.\nMrcvari me _.\n_ dobro do poslednje kapi.\nŠta me je skroz ulepilo?\n_- jednom nije dovoljno.\nDok su se Rusija i Amerika trkale do Meseca, Srbija je uložila milione istražujući šta je _.\nDraga Saveta, moj problem je _. Pomozi mi.\nSa snagom i prostranošću novog Yuga 3000 _ će biti sa Vama gde god poželite.\nNovo na Areni2:_ svetsko prvenstvo.\n_, mora da je zamka.\nOve sezone u pozorištu na Terazijama:_ - mjuzikl.\nKad se obogatim ima da dignem spomenik da se pamti _.\nVrlo je popularna dijeta u kojoj se jede samo _ u toku dana.\n_, baci kosku brate!\nSrbijo, najlepša bajko. Srbijo, oče i majko. Bog nek' ti pruži spas, jer mi te volimo, k'o što ti voliš _.\nTajni sastojak Tomine domaće je _.\n","*whiteCards*":"pirsing na bradavici\nđavo glavom i bradom\ngomila beskućnika\nspontano samospaljivanje\nNikola Đuričko\nĆele-kula\nmuda od labuda\nmesina\nčika na rolerima\nabortus ofingerom\nAnica Dobra\nrasizam\nDragan Nikolić\nvreme za sebe\neksplozija\nklića\n3XL lizalica\nmoj seksualni život\nerotska fantazija o drvoseči\nglas Miće Tatića\nmasturbiranje\nkobasicijada\nsvršavanje u bazen pun dečijih suza\nslatki maleni konjić\nizblajhani čmar\nvreća čarobnog pasulja\nmuškarci\npedofili\nzamrzivač pun organa\npropali rođendan\nBog\nkad prdneš a malo izleti napolje\nkorišćene gaćice\nporno piškenje\nlažna briga\nbiti bogat\nveliki crni kobas\nBeograd na vodi\nblagoslov rađanja\nloš životni izbor\njaja mi poplavela\ndobar cim\nRobokap\nChuck Norris\nplavuša\nono kad sedneš na dete i prdiš po njemu\nuništavanje dokaza\nmoja duša\nChristopher Walken\nnauka\ngoblini\nkad si drkadžija prema deci\nmoj mali\nkad sam se usr'o\nbedno drkanje\nbrisanje njene guze\nto što sam debela budala\ngaženje kolima\nmir u svetu\nmrtvi roditelji\nugroženost ljudskih prava\nduh plavo oko\nokean sperme\nrad na njivi\ntri debela Nemca\nprirodna selekcija\npun šleper govana\nmatori perverznjak\nmoj polni organ\nBiba Struja\njestive gaćice\nDarth Vader-ova svetlosna sablja\nbacanje devica u vulkan\nroj pčela\nafrička šljiva\nslatki čmar Milana Stankovića\nkad prdneš pa pobegneš\npar Jehovinih svedoka\ndete na uzici\nrak mozga\nRaša Popov priča prljavštine\nepi napad\ndebela svinja\njezik brži od pameti\npantomimičar koji doživljava srčku\ndooobar skank\nmoja dlakava bulja\ntrudnoća u osnovnoj\nhor Kolibri\nšto je čekala do braka\nneuzvraćen oral\nbičarke na travi\n"}});e.servers=[];this.init=function d(){c.init.call(this,"StartGameScreen");e.background=new b.client.gfx.classes.Sprite("start.background",0,0,12000,16000,"120x160-connect.png");e.background.alpha=false;e.background.show();this.addChild(e.background);e.infoText=new b.client.gfx.classes.Text("start.infoText",1000,2000,10000,this.fontSize.text.small+100,e.strings.get("Select a server:"),"RegularFont, sans-serif","#eff",this.fontSize.text.small,"center middle");e.infoText.show();this.addChild(e.infoText);if(b.client.net.classes.server.detected.host){try{b.product.pah.sfx.play("ack");e.infoText.setText(e.strings.get("Starting game..."));b.product.pah.PahApplication.server.url="http://"+b.client.net.classes.server.detected.host+":8069/";b.product.pah.PahApplication.server.startGame(b.product.pah.Nickname,"heartPah",e.onStarted)}catch(m){e.infoText.setText(" ")}}else{e.serverTextInput=new b.client.gfx.classes.TextInput("start.serverTextInput",1000,3500,10000,2000,b.client.data.Driver.current.get("pah.server.0","192.168.1.42"),"RegularFont, sans-serif","#8f2",900,"center top");e.serverTextInput.show();e.serverTextInput.setFocus(true);e.serverTextInput.eventHandlers.PointerClick=function o(){e.serverTextInput.setFocus(true)};this.addChild(e.serverTextInput);e.menu=new b.client.gfx.classes.List("start.menu",1000,5500,10000,5500,this.fontSize.text.medium);e.menu.show();this.addChild(e.menu);e.servers=[b.client.data.Driver.current.get("pah.server.0","192.168.1.42"),b.client.data.Driver.current.get("pah.server.1","localhost"),b.client.data.Driver.current.get("pah.server.2","borinstan.no-ip.org"),b.client.data.Driver.current.get("pah.server.3","192.168.1.2"),b.client.data.Driver.current.get("pah.server.4","192.168.1.3"),b.client.data.Driver.current.get("pah.server.5","192.168.1.4"),b.client.data.Driver.current.get("pah.server.6","192.168.1.5"),b.client.data.Driver.current.get("pah.server.7","192.168.1.6")];for(var n=0;n<e.servers.length;n++){e.menu.addItem(new b.client.gfx.classes.Text("start.server"+n+"MenuItem",1000,0,10000,this.fontSize.text.medium+100,e.servers[n],"RegularFont, sans-serif","#eff",this.fontSize.text.medium,"center middle"),e.onSelected)}e.startButton=new b.client.gfx.classes.Text("start.start",1000,11000,10000,this.fontSize.heading.large+500,e.strings.get("Start"),"CaptionFont, sans-serif","#8f2",this.fontSize.heading.large,"center middle");e.startButton.show();this.addChild(e.startButton);this.onClick(e.startButton,e.onStart)}e.backMenuItem=new b.client.gfx.classes.Text("start.backMenuItem",1000,13000,10000,this.fontSize.heading.medium+100,e.strings.get("Back"),"CaptionFont, sans-serif","#f00",this.fontSize.heading.medium,"center middle");this.onClick(e.backMenuItem,e.showMainMenuScreen);e.backMenuItem.show();this.addChild(e.backMenuItem);this.eventHandlers.KeyDown=e.onKeyDown;return this};this.release=function k(){e=null;c.release.call(this)};e.onSelected=function h(){e.serverTextInput.setText(this.text)};e.onStart=function i(){b.product.pah.sfx.play("ack");e.infoText.setText(e.strings.get("Starting game..."));b.product.pah.PahApplication.server.url="http://"+e.serverTextInput.text+":8069/";b.product.pah.PahApplication.server.startGame(b.product.pah.Nickname,"heartPah",e.onStarted,e.onError)};e.onStarted=function j(){if(!b.client.net.classes.server.detected.host){var n=false;for(var m=0;m<e.servers.length;m++){if(e.servers[m]==e.serverTextInput.text){n=true;break}}if(!n){e.servers.unshift(e.serverTextInput.text);b.client.data.Driver.current.set("pah.server.0",e.servers[0]);b.client.data.Driver.current.set("pah.server.1",e.servers[1]);b.client.data.Driver.current.set("pah.server.2",e.servers[2]);b.client.data.Driver.current.set("pah.server.3",e.servers[3]);b.client.data.Driver.current.set("pah.server.4",e.servers[4]);b.client.data.Driver.current.set("pah.server.5",e.servers[5]);b.client.data.Driver.current.set("pah.server.6",e.servers[6]);b.client.data.Driver.current.set("pah.server.7",e.servers[7])}}b.product.pah.sfx.play("turn");b.product.pah.PahApplication.server.invokeRaw("addCards",[b.product.pah.PahApplication.server.session.id,null,e.strings.get("*blackCards*"),e.strings.get("*whiteCards*")],function(o){b.product.pah.PahApplication.showScreen(b.product.pah.screen.LobbyScreen)},e.onError)};e.showMainMenuScreen=function l(){b.product.pah.sfx.play("key");b.product.pah.PahApplication.showScreen(b.product.pah.screen.MainMenuScreen)};e.onKeyDown=function g(n,m){if(m.name=="Escape"){e.showMainMenuScreen()}};e.onError=function f(m){if(!e){return}if(m){e.infoText.setText(""+m)}else{e.infoText.setText(e.strings.get("Unable to start game"))}};return this.init.apply(this,arguments)};b.product.pah.screen.StartGameScreen.prototype=new b.product.pah.screen.PahScreen();return b})(tvg);tvg=(function(b){b.product.pah.screen.JoinGameScreen=function a(){var c=arguments.callee.prototype;var e={};e.currentBackgroundSprite=0;e.pendingImage=null;e.strings=new b.client.util.classes.Translator({en:{"Point to host QR:":"Point to QR code:",Manual:"Manual","Joining...":"Joining...","Join failed...":"Join failed..."},sr:{"Point to host QR:":"Uperi u QR kod:",Manual:"Ručno","Joining...":"Ulazim...","Join failed...":"Nisam uspeo..."}});this.init=function d(){c.init.call(this,"JoinGameScreen");e.qr=b.client.input.Driver.get("QrDriver");e.screen=this;e.background=new b.client.gfx.classes.Sprite("join.background",0,0,12000,16000,"120x160-connect-qr.png");e.background.alpha=false;e.background.show();this.addChild(e.background);e.errorTextLabel=new b.client.gfx.classes.Text("join.errorTextLabel",1000,2000,10000,this.fontSize.text.small+100,e.strings.get("Point to host QR:"),"RegularFont, sans-serif","#eff",this.fontSize.text.small,"center middle");e.errorTextLabel.show();this.addChild(e.errorTextLabel);e.backMenuItem=new b.client.gfx.classes.Text("join.backMenuItem",1000,13000,10000,this.fontSize.heading.medium+100,e.strings.get("Manual"),"CaptionFont, sans-serif","#8f2",this.fontSize.heading.medium,"center middle");e.backMenuItem.show();this.onClick(e.backMenuItem,e.onBack);this.addChild(e.backMenuItem);this.eventHandlers.KeyDown=e.onKeyDown;var n=window.location.hash.substr(1);if(n.length){e.onDetected("http://"+n);return}else{e.qr.scan(2500,4500,7000,7000,e.onDetected,e.onError)}return this};this.release=function l(){e=null;c.release.call(this)};this.stop=function m(){e.qr.abort();c.stop.call(this)};e.onBack=function f(){e.screen.stop.call(e.screen);b.product.pah.PahApplication.showScreen(b.product.pah.screen.JoinGameManualScreen)};e.onKeyDown=function k(o,n){if(n.name=="Escape"){e.screen.stop.call(e.screen);b.product.pah.sfx.play("key");b.product.pah.PahApplication.showScreen(b.product.pah.screen.MainMenuScreen)}};e.onError=function h(n){e.errorTextLabel.setText(""+n);e.background.setImage("120x160-red.png")};e.onDetected=function g(o){b.product.pah.sfx.play("key");e.errorTextLabel.setText(e.strings.get("Joining..."));var n=o.substr(o.indexOf("?")+1);b.product.pah.PahApplication.server.url=o.substr(0,o.indexOf("/?")+1);b.product.pah.PahApplication.server.joinGame(n,b.product.pah.Nickname,e.onJoined,e.onJoinFailed)};e.onJoined=function i(n){b.product.pah.sfx.play("ack");b.product.pah.PahApplication.showScreen(b.product.pah.screen.LobbyScreen)};e.onJoinFailed=function j(n){e.errorTextLabel.setText((n&&n.error)?(""+n.error):e.strings.get("Join failed..."));e.background.setImage("120x160-red.png")};return this.init.apply(this,arguments)};b.product.pah.screen.JoinGameScreen.prototype=new b.product.pah.screen.PahScreen();return b})(tvg);tvg=(function(b){b.product.pah.screen.JoinGameManualScreen=function a(){var c=arguments.callee.prototype;var e={};e.strings=new b.client.util.classes.Translator({en:{"Select host and game ID:":"Select host and game ID:",Join:"Join",Back:"Back","Joining...":"Joining...","Join failed...":"Join failed..."},sr:{"Select host and game ID:":"Izaberi server i ID igre:",Join:"Uđi",Back:"Nazad","Joining...":"Ulazim...","Join failed...":"Nisam uspeo..."}});this.init=function d(){c.init.call(this,"JoinGameManualScreen");e.background=new b.client.gfx.classes.Sprite("joinmanual.background",0,0,12000,16000,"120x160-connect.png");e.background.alpha=false;e.background.show();this.addChild(e.background);e.infoText=new b.client.gfx.classes.Text("joinmanual.infoText",1000,2000,10000,this.fontSize.text.small+100,e.strings.get("Select host and game ID:"),"RegularFont, sans-serif","#eff",this.fontSize.text.small,"center middle");e.infoText.show();this.addChild(e.infoText);e.hostnameTextInput=new b.client.gfx.classes.TextInput("joinmanual.hostnameTextInput",1000,3500,10000,1500,b.product.pah.Hostname?b.product.pah.Hostname:"borinstan.no-ip.org","RegularFont, sans-serif","#8f2",900,"center middle");e.hostnameTextInput.show();e.hostnameTextInput.setFocus(true);e.hostnameTextInput.eventHandlers.PointerClick=function n(){e.lastFocused="hostnameTextInput";e.hostnameTextInput.setFocus(true)};this.addChild(e.hostnameTextInput);e.gameIdTextInput=new b.client.gfx.classes.TextInput("joinmanual.gameIdTextInput",1000,5500,10000,1500,"0","RegularFont, sans-serif","#8f2",900,"center middle");e.gameIdTextInput.show();e.gameIdTextInput.setFocus(true);e.gameIdTextInput.eventHandlers.PointerClick=function m(){e.lastFocused="gameIdTextInput";e.gameIdTextInput.setFocus(true)};this.addChild(e.gameIdTextInput);e.doneButton=new b.client.gfx.classes.Text("joinmanual.ok",1000,11000,10000,this.fontSize.heading.large+500,e.strings.get("Join"),"CaptionFont, sans-serif","#8f2",this.fontSize.heading.large,"center middle");e.doneButton.show();this.addChild(e.doneButton);this.onClick(e.doneButton,e.onDone);e.backButton=new b.client.gfx.classes.Text("joinmanual.back",1000,13000,10000,this.fontSize.heading.medium+100,e.strings.get("Back"),"CaptionFont, sans-serif","#f00",this.fontSize.heading.medium,"center middle");e.backButton.show();this.addChild(e.backButton);this.onClick(e.backButton,e.onBack);this.eventHandlers.KeyDown=e.onKeyDown;this.eventHandlers.PointerClick=function o(){e.hostnameTextInput.setFocus(false)};e.lastFocused="gameIdTextInput";e.gameIdTextInput.setFocus(true);return this};this.release=function k(){e=null;c.release.call(this)};e.onDone=function g(){e.doneButton.hide();b.product.pah.sfx.play("ack");b.product.pah.Hostname=e.hostnameTextInput.text?e.hostnameTextInput.text:"borinstan.no-ip.org";b.client.data.Driver.current.set("pah.Hostname",b.product.pah.Hostname);b.product.pah.sfx.play("key");e.infoText.setText(e.strings.get("Joining..."));var m=e.gameIdTextInput.text|0;b.product.pah.PahApplication.server.url="http://"+b.product.pah.Hostname+":8069/";b.product.pah.PahApplication.server.joinGame(m,b.product.pah.Nickname,e.onJoined,e.onJoinFailed)};e.onBack=function f(){e.showMainMenuScreen()};e.onJoined=function h(m){b.product.pah.sfx.play("ack");b.product.pah.PahApplication.showScreen(b.product.pah.screen.LobbyScreen)};e.onJoinFailed=function i(m){e.infoText.setText((m&&m.error)?(""+m.error):e.strings.get("Join failed..."));e.doneButton.show()};e.showMainMenuScreen=function l(){b.product.pah.PahApplication.showScreen(b.product.pah.screen.MainMenuScreen)};e.onKeyDown=function j(n,m){if(m.name=="Escape"){e.showMainMenuScreen()}else{if(m.name=="Enter"){switch(e.lastFocused){case"hostnameTextInput":e.lastFocused="gameIdTextInput";e.gameIdTextInput.setFocus(true);break;case"gameIdTextInput":e.onDone();break}}}};return this.init.apply(this,arguments)};b.product.pah.screen.JoinGameManualScreen.prototype=new b.product.pah.screen.PahScreen();return b})(tvg);tvg=(function(b){b.product.pah.screen.LobbyScreen=function a(){var c=arguments.callee.prototype;var e={};e.strings=new b.client.util.classes.Translator({en:{"Tap screen or put phone down":"Tap screen or put phone down",Back:"Back","Wait for the other players":"Wait for the other players","Starting... Tap to cancel":"Starting... Tap to cancel","Long-press to start":"Long-press to start","Leaving game...":"Leaving game..."},sr:{"Tap screen or put phone down":"Dodirni ekran ili spusti telefon",Back:"Nazad","Wait for the other players":"Sačekaj ostale igrače","Starting... Tap to cancel":"Počinjem... Dodirni da otkažeš","Long-press to start":"Pritisni i drži za početak","Leaving game...":"Isključujem se..."}});this.init=function d(){c.init.call(this,"LobbyScreen");e.ready=false;e.screen=this;var o=b.game.configuration.simpleJoinMode&&b.client.net.classes.server.detected.host;e.background=new b.client.gfx.classes.Sprite("lobby.background",0,0,12000,16000,o?"120x160-connect.png":"120x160-connect-qr.png");e.background.alpha=false;e.background.show();this.addChild(e.background);e.infoText=new b.client.gfx.classes.Text("lobby.infoText",1000,1500,10000,this.fontSize.text.small+100,e.strings.get("Tap screen or put phone down"),"RegularFont, sans-serif","#eff",this.fontSize.text.small,"center middle");e.infoText.show();this.addChild(e.infoText);e.gameIdText=new b.client.gfx.classes.Text("lobby.gameIdText",1000,2500,10000,this.fontSize.text.small+100," ","RegularFont, sans-serif","#eff",this.fontSize.text.small,"center middle");e.gameIdText.show();this.addChild(e.gameIdText);e.backMenuItem=new b.client.gfx.classes.Text("lobby.backMenuItem",1000,13000,10000,this.fontSize.heading.medium+100,e.strings.get("Back"),"CaptionFont, sans-serif","#f00",this.fontSize.heading.medium,"center middle");e.backMenuItem.eventHandlers.PointerClick=e.showMainMenuScreen;e.backMenuItem.show();this.addChild(e.backMenuItem);this.eventHandlers.PointerClick=e.onClicked;if(!o){e.qrCodeUtility=new b.client.util.classes.QrCodeUtility();e.qrCodeUtility.encode(b.product.pah.PahApplication.server.url+"?"+b.product.pah.PahApplication.server.session.id,e.onQrReady,256,256,"#000","#fff")}b.product.pah.PahApplication.server.onStateUpdated=e.onStateUpdated;this.eventHandlers.OrientationChanged=e.onOrientationChanged;this.eventHandlers.KeyDown=e.onKeyDown;return this};this.release=function k(){e=null;c.release.call(this)};this.stop=function m(){b.product.pah.PahApplication.server.onStateUpdated=null;c.stop.call(this)};this.tick=function n(o){c.tick.call(this,o);if(b.product.pah.PahApplication.server.session&&b.product.pah.PahApplication.server.session.state.endTime){b.product.pah.PahApplication.server.onGameLeft();e.showMainMenuScreen()}};e.onStateUpdated=function j(r){var o=b.product.pah.PahApplication.server.getPlayer();if(!o||!e){return}if(r.lastJoinedPlayerId==o.id){if(Object.keys(r.players).length==1){e.infoText.setText(e.strings.get("Wait for the other players"))}else{e.infoText.setText(o.state.ready?e.strings.get("Starting... Tap to cancel"):e.strings.get("Long-press to start"))}}else{e.infoText.setText(e.strings.get("Wait for the other players"));if(!o.state.ready){b.product.pah.PahApplication.server.invoke("setReady",[o.id,true])}}if(o.state.ready){if(r.lastJoinedPlayerId==o.id){e.background.setImage("120x160-green.png");if(e.qrCode){e.qrCode.hide()}}else{e.background.setImage("120x160-green.png");if(e.qrCode){e.qrCode.hide()}}}else{if(r.lastJoinedPlayerId==o.id){var q=b.game.configuration.simpleJoinMode&&b.client.net.classes.server.detected.host;e.background.setImage(q?"120x160-connect.png":"120x160-connect-qr.png");if(e.qrCode){e.qrCode.show()}}else{e.background.setImage("120x160-connect.png");if(e.qrCode){e.qrCode.hide()}}}if(b.product.pah.PahApplication.server.session.state.roundStarted){b.product.pah.PahApplication.showScreen(b.product.pah.screen.GameScreen)}};e.onOrientationChanged=function h(r,o){var q=b.product.pah.PahApplication.server.getPlayer();if(!q){return}};e.onQrReady=function i(q){e.qrCode=new b.client.gfx.classes.Sprite("qrGenerate.qrCode",2500,4500,7000,7000,q);e.qrCode.comment=b.product.pah.PahApplication.server.url+"?"+b.product.pah.PahApplication.server.session.id;e.gameIdText.setText(b.product.pah.PahApplication.server.url.substr(7,b.product.pah.PahApplication.server.url.lastIndexOf(":")-7)+", "+b.product.pah.PahApplication.server.session.id);var o=b.product.pah.PahApplication.server.getPlayer();if(o&&b.product.pah.PahApplication.server.session.state.lastJoinedPlayerId!=o.id){e.qrCode.hide()}else{e.qrCode.show()}e.screen.addChild(e.qrCode)};e.onClicked=function f(r,o){var q=b.product.pah.PahApplication.server.getPlayer();if(!q){return}if(b.product.pah.PahApplication.server.session.state.lastJoinedPlayerId==q.id){if(q.state.ready){b.product.pah.sfx.play("key");b.product.pah.PahApplication.server.invoke("setReady",[q.id,false])}else{if(o.isLong){b.product.pah.sfx.play("ack");b.product.pah.PahApplication.server.invoke("setReady",[q.id,true])}}}};e.showMainMenuScreen=function l(){b.product.pah.sfx.play("key");e.infoText.setText(e.strings.get("Leaving game..."));b.product.pah.PahApplication.server.leaveGame(function o(){b.product.pah.sfx.play("ack");b.product.pah.PahApplication.showScreen(b.product.pah.screen.MainMenuScreen)})};e.onKeyDown=function g(q,o){if(o.name=="Escape"){e.showMainMenuScreen()}};return this.init.apply(this,arguments)};b.product.pah.screen.LobbyScreen.prototype=new b.product.pah.screen.PahScreen();return b})(tvg);tvg=(function(b){b.product.pah.screen.GameScreen=function a(){var c=arguments.callee.prototype;var h={};h.strings=new b.client.util.classes.Translator({en:{Scores:"Scores","Round started":"Round started","Leaving...":"Leaving...","Wait for others to pickup.":"Wait for others to pickup.","Pickup the phone.":"Pickup the phone.","Put an answer face down.":"Put an answer face down.","Drop the phone, face up.":"Drop the phone, face up.","Pickup the phone, long press.":"Pickup the phone, long press.","Put a question face up.":"Put a question face up.","Long press a question.":"Long press a question.","Wait for answers.":"Wait for answers.","Long press an answer.":"Long press an answer.","Wait for the question.":"Wait for the question.","Flip all answers.":"Flip all answers.","Long press to flip.":"Long press to flip.","Press and hold the best answer.":"Press and hold the best answer.","You're awesome!":"You're awesome!"," is awesome.":" is awesome."," hidden":" hidden"},sr:{Scores:"Poeni","Round started":"Partija je počela","Leaving...":"Odlazim...","Wait for others to pickup.":"Čekaj da ostali podignu.","Pickup the phone.":"Podigni telefon.","Put an answer face down.":"Spusti odgovor licem na dole.","Drop the phone, face up.":"Spusti telefon licem na gore.","Pickup the phone, long press.":"Podigni telefon, dodirni dugo ekran.","Put a question face up.":"Spusti pitanje licem na gore.","Long press a question.":"Dodirni i drži pitanje.","Wait for answers.":"Sačekaj odgovore.","Long press an answer.":"Dodirni i drži odgovor.","Wait for the question.":"Sačekaj pitanje.","Flip all answers.":"Obrni odgovore.","Long press to flip.":"Dodirni i drži da obrneš.","Press and hold the best answer.":"Dodirni i drži najbolji odgovor.","You're awesome!":"Ti si kul!"," is awesome.":" je kul."," hidden":" sakrivena"}});this.init=function g(){c.init.call(this,"GameScreen");h.screen=this;h.frame=0;h.phaseStartTime=b.client.app.Application.current.time;h.backgroundRegular=new b.client.gfx.classes.Sprite("game.background",0,0,12000,16000,"120x160-blank.png");h.backgroundRegular.alpha=false;h.backgroundRegular.show();this.addChild(h.backgroundRegular);h.backgroundWhite=new b.client.gfx.classes.Sprite("game.background.white",0,0,12000,16000,"120x160-white.png");h.backgroundWhite.alpha=false;this.addChild(h.backgroundWhite);h.nicknameText=new b.client.gfx.classes.Text("game.nicknameText",2500,1500,7000,this.fontSize.heading.large+500,b.product.pah.PahApplication.server.getPlayer().state.nickname,"CaptionFont, sans-serif","#eff",this.fontSize.heading.large,"center middle");this.addChild(h.nicknameText);h.hiddenText=new b.client.gfx.classes.Text("game.hiddenText",4500,2500,3000,this.fontSize.text.small+100," ","RegularFont, sans-serif","#eff",this.fontSize.text.small,"center middle");h.hiddenText.show();this.onClick(h.hiddenText,h.onUnhide);this.addChild(h.hiddenText);h.leaderLabel=new b.client.gfx.classes.Text("game.leaderLabel",2000,3500,8000,this.fontSize.heading.small+200," ","CaptionFont, sans-serif","#eff",this.fontSize.heading.small,"center top");h.leaderLabel.show();this.addChild(h.leaderLabel);h.leaderText=new b.client.gfx.classes.Text("game.leaderText",2000,5000,8000,7000," ","RegularFont, sans-serif","#eff",this.fontSize.text.medium,"center middle");h.leaderText.show();this.addChild(h.leaderText);h.hiScore=new b.client.gfx.classes.Layer("game.hiScore",3000,5000,7000,8000);h.hiScore.show();this.addChild(h.hiScore);h.hiScoreTitleText=new b.client.gfx.classes.Text("game.hiScore.Title",4000,5000,4000,this.fontSize.heading.small+200,h.strings.get("Scores"),"CaptionFont, sans-serif","#eff",this.fontSize.heading.small,"center middle");h.hiScore.addChild(h.hiScoreTitleText);h.hiScorePointsText=new b.client.gfx.classes.Text("game.hiScore.Points",3000,6500,1500,6500," ","CaptionFont, sans-serif","#eff",this.fontSize.heading.small,"center top");h.hiScore.addChild(h.hiScorePointsText);h.hiScorePlayersText=new b.client.gfx.classes.Text("game.hiScore.Players",4500,6500,5500,6500," ","CaptionFont, sans-serif","#eff",this.fontSize.heading.small,"left top");h.hiScore.addChild(h.hiScorePlayersText);h.infoText=new b.client.gfx.classes.Text("game.infoText",1000,13750,10000,this.fontSize.text.small+100,h.strings.get("Round started"),"RegularFont, sans-serif","#eff",this.fontSize.text.small,"center middle");h.infoText.show();this.addChild(h.infoText);b.product.pah.PahApplication.server.onStateUpdated=h.onStateUpdated;this.eventHandlers.OrientationChanged=h.onOrientationChanged;b.product.pah.PahApplication.server.invoke("orientationChanged",[b.product.pah.PahApplication.server.playerId,b.client.input.Orientation.current]);var H=b.product.pah.PahApplication.server.getPlayer();h.previousFlashing=H&&H.state.flashing;if(H&&H.state.host){b.product.pah.PahApplication.server.invoke("resetPoints",[b.product.pah.PahApplication.server.playerId])}this.eventHandlers.KeyDown=h.onKeyDown;h.onOrientationChanged();h.cardUi={};this.eventHandlers.PointerClick=h.onPointerClick;this.eventHandlers.PointerDown=h.onPointerDown;this.eventHandlers.PointerDrag=h.onPointerDrag;this.eventHandlers.PointerUp=h.onPointerUp;h.drag={x:0,y:0};h.hiddenCards=0;h.visibleCards=0;h.scoreBoardPoints={};h.refreshView();return this};this.release=function x(){h=null;c.release.call(this)};this.stop=function C(){b.product.pah.PahApplication.server.onStateUpdated=null;c.stop.call(this)};h.onOrientationChanged=function k(J,I){var H=I?I.orientation:b.client.input.Orientation.current;b.product.pah.PahApplication.server.invoke("orientationChanged",[b.product.pah.PahApplication.server.playerId,H])};h.onStateUpdated=function t(H){if(!h){return}h.updateBackground.call(h.screen);h.refreshView.call(h.screen,H)};h.pendingInfoText=null;h.getInfoText=function e(){if(h.pendingInfoText){return h.pendingInfoText}return h.infoText.text};h.setInfoText=function A(I){if(I==h.getInfoText()){return}if(h.getInfoText()==""){h.pendingInfoText=null;h.infoText.x=-8000;h.infoText.setText(I);h.infoText.show();new b.client.gfx.classes.Animation(h.infoText,"x",1000,400,b.client.gfx.classes.Animation.animationFunction.easeIn)}else{h.pendingInfoText=I;new b.client.gfx.classes.Animation(h.infoText,"x",10000,400,b.client.gfx.classes.Animation.animationFunction.easeOut,function H(){if(h&&h.infoText){h.infoText.text="";h.pendingInfoText=null;h.setInfoText(I)}})}};h.hasQuestions=function f(){return b.product.pah.PahApplication.server.session&&b.product.pah.PahApplication.server.session.state.currentPlayerId==b.product.pah.PahApplication.server.playerId};h.selectedAnswer=function y(){var H=b.product.pah.PahApplication.server.getPlayer();if(!H){return false}return H.state.selectedCardId||h.selectingAnswer};h.selectingAnswer=false;h.selectingAnswerDone=function z(){h.selectingAnswer=false};h.refreshView=function w(J){if(!J){if(!b.product.pah.PahApplication.server.session){return}J=b.product.pah.PahApplication.server.session.state}var I=b.product.pah.PahApplication.server.getPlayer();if(!I){return}if(!h.previousFlashing&&I.state.flashing){b.product.pah.sfx.play("key")}if(h.previousFlashing!=I.state.flashing){h.previousFlashing=I.state.flashing}if(I.state.flashing){h.backgroundRegular.hide();h.backgroundWhite.show()}else{h.backgroundRegular.show();h.backgroundWhite.hide()}for(cardId in I.state.cards){var H=I.state.cards[cardId];if(!H){continue}if(!h.cardUi[cardId]){h.cardUi[cardId]={id:cardId,visual:new b.client.gfx.classes.SpriteText("game.card."+cardId,0,0,7500,7500,H.state.type=="cardQuestion"?"120x160-card-black.png":"120x160-card-white.png",1,H.state.text.replace("_","________"),"RegularFont, sans-serif","#888",600,"center middle",500),visible:0,state:1};h.cardUi[cardId].visual.alpha=false;h.screen.addChild(h.cardUi[cardId].visual)}}h.hiddenCards=0;h.visibleCards=0;for(cardId in I.state.cards){var H=I.state.cards[cardId];if(!H){continue}if(h.hasQuestions()){if(H.state.type=="cardQuestion"&&h.cardUi[cardId].state==0){h.hiddenCards++}if(H.state.type=="cardQuestion"&&h.cardUi[cardId].state==1){h.visibleCards++}}else{if(H.state.type=="cardAnswer"&&h.cardUi[cardId].state==0){h.hiddenCards++}if(h.cardUi[cardId].state==1){h.visibleCards++}}}if(I.state.cards&&h.visibleCards==0){for(cardId in I.state.cards){if(!I.state.cards[cardId]){continue}h.cardUi[cardId].status=1;h.visibleCards++}h.hiddenCards=0}h.updateHiScores();h.hiddenText.setText(h.hiddenCards>0?(""+h.hiddenCards+h.strings.get(" hidden")):" ");if(h.determinePreviousAndNext(I)){h.updateCardPositions()}};h.updateHiScores=function G(){if(h.hiScore.visible){var R=false;if(!h.scoreBoardPoints){R=true}else{if(!b.product.pah.PahApplication.server.session){return}for(var M in b.product.pah.PahApplication.server.session.state.players){if((h.scoreBoardPoints[M]===undefined)||(h.scoreBoardPoints[M]!=b.product.pah.PahApplication.server.session.state.players[M].state.points)){R=true;break}}}if(!R){return}var Q=[];for(var M in b.product.pah.PahApplication.server.session.state.players){Q.push(M)}for(var H=0,S=false;H<Q.length;H++,S=false){for(var I=Q.length-1;I>H;I--){var K=b.product.pah.PahApplication.server.session.state.players[Q[I]];var L=b.product.pah.PahApplication.server.session.state.players[Q[I-1]];if((K.state.points|0)>(L.state.points|0)){var N=Q[I];Q[I]=Q[I-1];Q[I-1]=N;S=true}}if(!S){break}}h.scoreBoardPoints={};var P="",O="";for(var H=0;H<Q.length;H++){var J=b.product.pah.PahApplication.server.session.state.players[Q[H]];h.scoreBoardPoints[J.id]=J.state.points|0;P+=(P.length==0?"":"\r\n")+(J.state.points|0);O+=(O.length==0?"":"\r\n")+J.state.nickname}h.hiScorePointsText.setText(P);h.hiScorePointsText.show();h.hiScorePlayersText.setText(O);h.hiScorePlayersText.show()}};h.determinePreviousAndNext=function d(N){var M=h.previousCard,K=h.currentCard,L=h.nextCard;if(h.currentCard&&!N.state.cards[h.currentCard.id]){h.currentCard=null}if(h.previousCard&&!N.state.cards[h.previousCard.id]){h.previousCard=null}if(h.nextCard&&!N.state.cards[h.nextCard.id]){h.nextCard=null}if(!h.currentCard){for(cardId in N.state.cards){if(!N.state.cards[cardId]){continue}if(h.hasQuestions()&&N.state.cards[cardId].state.type!="cardQuestion"){continue}if(!h.currentCard&&h.cardUi[cardId].state!=0){h.currentCard=h.cardUi[cardId];break}}}if(h.currentCard){var O=null,H=null,J=null,I=false;for(cardId in N.state.cards){if(!N.state.cards[cardId]){continue}if(h.hasQuestions()&&N.state.cards[cardId].state.type!="cardQuestion"){continue}if(h.cardUi[cardId].state==0){h.cardUi[cardId].visible=0;continue}if(!I){O=H;H=h.cardUi[cardId];if(h.currentCard.id==cardId){I=true}}else{if(!J){J=h.cardUi[cardId];break}}}h.nextCard=J;h.previousCard=O;if(K&&K!=h.currentCard&&K!=h.previousCard&&K!=h.nextCard&&K.visible){K.visible=0}if(M&&M!=h.currentCard&&M!=h.previousCard&&M!=h.nextCard&&M.visible){M.visible=0}if(L&&L!=h.currentCard&&L!=h.previousCard&&L!=h.nextCard&&L.visible){L.visible=0}return true}return false};h.updateCardPositions=function F(){var K=b.product.pah.PahApplication.server.getPlayer();if(!K){return}var J=h.offsetX==0&&h.offsetY==0?1000:0;h.offsetX=Math.abs(h.drag.x)>Math.abs(h.drag.y)&&Math.abs(h.drag.x)>J?h.drag.x:0;h.offsetY=Math.abs(h.drag.x)<Math.abs(h.drag.y)&&Math.abs(h.drag.y)>J?h.drag.y:0;if(K.state.locked){h.offsetX=h.offsetY=0}if(h.currentCard&&h.currentCard.visual.id){h.currentCard.visual.y=(16000-7500)/2+750+h.offsetY;new b.client.gfx.classes.Animation(h.currentCard.visual,"x",(12000-7500)/2+h.offsetX,300,b.client.gfx.classes.Animation.animationFunction.easeOut);h.currentCard.visible=1;if(K.state.showCardText){h.currentCard.visual.setText(K.state.showCardText)}h.currentCard.visual.visible=K.state.showingCards;h.currentCard.visual.update()}if(h.nextCard&&h.nextCard.visual.id){h.nextCard.visual.x=h.currentCard.visual.x+8000;h.nextCard.visual.y=(16000-7500)/2+750;new b.client.gfx.classes.Animation(h.nextCard.visual,"x",(12000-7500)/2+8000+h.offsetX,300,b.client.gfx.classes.Animation.animationFunction.easeOut);switch(b.product.pah.PahApplication.server.session.state.phase){case b.game.classes.heartPah.phases.waitingForQuestion:h.nextCard.visible=1;h.nextCard.visual.visible=K.state.showingCards;break;case b.game.classes.heartPah.phases.waitingForAnswers:if(!h.hasQuestions()){h.nextCard.visible=1;h.nextCard.visual.visible=K.state.showingCards;break}default:h.nextCard.visible=0;h.nextCard.visual.visible=false;break}h.nextCard.visual.update()}if(h.previousCard&&h.previousCard.visual.id){h.previousCard.visual.x=h.currentCard.visual.x-8000;h.previousCard.visual.y=(16000-7500)/2+750;new b.client.gfx.classes.Animation(h.previousCard.visual,"x",(12000-7500)/2-8000+h.offsetX,300,b.client.gfx.classes.Animation.animationFunction.easeOut);switch(b.product.pah.PahApplication.server.session.state.phase){case b.game.classes.heartPah.phases.waitingForQuestion:h.previousCard.visible=1;h.previousCard.visual.visible=K.state.showingCards;break;case b.game.classes.heartPah.phases.waitingForAnswers:if(!h.hasQuestions()){h.previousCard.visible=1;h.previousCard.visual.visible=K.state.showingCards;break}default:h.previousCard.visible=0;h.previousCard.visual.visible=false;break}h.previousCard.visual.update()}for(var I in h.cardUi){var H=h.cardUi[I];if(H==h.previousCard||H==h.currentCard||H==h.nextCard||(!H.visual.id)){continue}if(H.visible&&K.state.showingCards){H.visual.show()}else{H.visual.hide()}}};h.onPointerClick=function l(J,H){if(!b.product.pah.PahApplication.server.session){return}switch(b.product.pah.PahApplication.server.session.state.phase){case b.game.classes.heartPah.phases.waitingToPickup:if(b.client.input.Orientation.current!=b.client.input.Orientations.Moving&&H.isLong){b.client.input.Orientation.current=b.client.input.Orientations.Moving;h.onOrientationChanged.call(h.screen)}break;case b.game.classes.heartPah.phases.waitingForBestAnswer:if(!h.hasQuestions()&&H.isLong){b.product.pah.sfx.play("key");b.product.pah.PahApplication.server.invoke("selectBestAnswer",[b.product.pah.PahApplication.server.playerId])}break;case b.game.classes.heartPah.phases.waitingForQuestion:if(h.hasQuestions()&&H.isLong&&!h.selectedAnswer()&&h.phaseDuration()>2000){b.client.input.Orientation.current=b.client.input.Orientations.FaceUp;h.onOrientationChanged.call(h.screen)}break;case b.game.classes.heartPah.phases.waitingForAnswers:if(!h.hasQuestions()&&H.isLong&&!h.selectedAnswer()&&h.phaseDuration()>300){b.client.input.Orientation.current=b.client.input.Orientations.FaceDown;h.onOrientationChanged.call(h.screen)}break;case b.game.classes.heartPah.phases.waitingToUnravel:var I=b.product.pah.PahApplication.server.getPlayer();if(I){if(!h.hasQuestions()&&H.isLong&&!I.state.showingCards){b.client.input.Orientation.current=b.client.input.Orientations.FaceUp;h.onOrientationChanged.call(h.screen);h.setInfoText(" ")}}break}};h.onPointerDown=function m(I,H){h.drag.x=h.drag.y=h.offsetX=h.offsetY=0;h.updateCardPositions()};h.onPointerDrag=function n(I,H){h.drag.x=(H.x-H.startX);h.drag.y=(H.y-H.startY);h.updateCardPositions()};h.onPointerUp=function o(K,H){var I=h.offsetX==0&&h.offsetY==0?1000:0;h.offsetX=Math.abs(h.drag.x)>Math.abs(h.drag.y)&&Math.abs(h.drag.x)>I?h.drag.x:0;h.offsetY=Math.abs(h.drag.x)<Math.abs(h.drag.y)&&Math.abs(h.drag.y)>I?h.drag.y:0;var J=b.product.pah.PahApplication.server.getPlayer();if(!J){return}if(J.state.locked){h.offsetX=h.offsetY=0}if(h.offsetX>3000){h.onScrollLeft()}else{if(h.offsetX<-3000){h.onScrollRight()}else{if(h.offsetY>3000){if(h.onDemote()){h.drag.x=h.drag.y=h.offsetX=h.offsetY=0;return}}else{if(h.offsetY<-3000){if(h.onPromote()){h.drag.x=h.drag.y=h.offsetX=h.offsetY=0;return}}}}}h.drag.x=h.drag.y=h.offsetX=h.offsetY=0;h.updateCardPositions()};h.onScrollLeft=function r(){if(!h.previousCard){return}h.currentCard=h.previousCard;h.refreshView()};h.onScrollRight=function s(){if(!h.nextCard){return}h.currentCard=h.nextCard;h.refreshView()};h.onPromote=function q(){switch(h.currentCard.state){case 0:return false;case 1:h.onUnhide();return true}};h.onDemote=function i(){switch(h.currentCard.state){case 0:return false;case 1:if(h.visibleCards>1){var H=h.currentCard.visual.x;new b.client.gfx.classes.Animation(h.currentCard.visual,"y",16000,300,b.client.gfx.classes.Animation.animationFunction.easeOut,h.refreshView);h.currentCard.state=0;h.currentCard=h.nextCard?h.nextCard:h.previousCard;new b.client.gfx.classes.Animation(h.currentCard.visual,"x",H,300,b.client.gfx.classes.Animation.animationFunction.easeOut)}return true}};h.onUnhide=function u(){var I=b.product.pah.PahApplication.server.getPlayer();if(!I){return}for(cardId in I.state.cards){if(!I.state.cards[cardId]){continue}h.cardUi[cardId].state=1}var J=h.previousCard,H=h.nextCard;h.determinePreviousAndNext(I);new b.client.gfx.classes.Animation(h.currentCard.visual,"y",(16000-7500)/2+750,300,b.client.gfx.classes.Animation.animationFunction.easeOut,h.refreshView);if(J!=h.previousCard){if(J){new b.client.gfx.classes.Animation(J.visual,"x",-8000,300,b.client.gfx.classes.Animation.animationFunction.easeIn)}h.previousCard.visual.x=(12000-7500)/2+h.offsetX;h.previousCard.visual.y=16000;h.previousCard.visual.show();new b.client.gfx.classes.Animation(h.previousCard.visual,"x",(12000-7500)/2-8000+h.offsetX,300,b.client.gfx.classes.Animation.animationFunction.easeOut);new b.client.gfx.classes.Animation(h.previousCard.visual,"y",(16000-7500)/2+750,300,b.client.gfx.classes.Animation.animationFunction.easeOut)}if(H!=h.nextCard){if(H){new b.client.gfx.classes.Animation(H.visual,"x",12000,300,b.client.gfx.classes.Animation.animationFunction.easeIn)}h.nextCard.visual.x=(12000-7500)/2+h.offsetX;h.nextCard.visual.y=16000;h.nextCard.visual.show();new b.client.gfx.classes.Animation(h.nextCard.visual,"x",(12000-7500)/2+8000+h.offsetX,300,b.client.gfx.classes.Animation.animationFunction.easeOut);new b.client.gfx.classes.Animation(h.nextCard.visual,"y",(16000-7500)/2+750,300,b.client.gfx.classes.Animation.animationFunction.easeOut)}};h.updateBackground=function E(){var H=b.product.pah.PahApplication.server.getPlayer();if(!H){return}if(!h.previousFlashing&&H.state.flashing){b.product.pah.sfx.play("key")}h.previousFlashing=H.state.flashing;if(H.state.flashing){h.backgroundRegular.hide();h.backgroundWhite.show()}else{h.backgroundRegular.show();h.backgroundWhite.hide()}};h.showMainMenuScreen=function B(){h.setInfoText(h.strings.get("Leaving..."));b.product.pah.PahApplication.server.leaveGame(function H(){b.product.pah.PahApplication.showScreen(b.product.pah.screen.MainMenuScreen)})};h.onKeyDown=function j(I,H){if(H.name=="Escape"){h.showMainMenuScreen()}};h.phaseDuration=function v(){return(b.client.app.Application.current.time-h.phaseStartTime)};this.tick=function D(N){c.tick.call(this,N);var L=b.product.pah.PahApplication.server.getPlayer();if(!L){return}switch(b.product.pah.PahApplication.server.session.state.phase){case b.game.classes.heartPah.phases.waitingToPickup:if(!h.nicknameText.visible){h.nicknameText.show()}if(h.leaderLabel.visible&&b.client.input.Orientation.current===b.client.input.Orientations.Moving){h.setInfoText(h.strings.get("Wait for others to pickup."));h.leaderLabel.hide()}else{if(!h.leaderLabel.visible&&b.client.input.Orientation.current!==b.client.input.Orientations.Moving){h.setInfoText(h.strings.get("Pickup the phone."));h.leaderLabel.show()}}if(!h.hiScore.visible){h.hiScore.show();h.updateHiScores()}break;case b.game.classes.heartPah.phases.waitingForQuestion:if(h.nicknameText.visible){h.nicknameText.hide()}if(h.hasQuestions()){if(!h.selectedAnswer()&&b.client.input.Orientation.current==b.client.input.Orientations.FaceUp&&h.phaseDuration()>2000){b.product.pah.sfx.play("key");h.selectingAnswer=true;b.product.pah.PahApplication.server.invoke("selectAnswer",[b.product.pah.PahApplication.server.playerId,h.currentCard.id],h.selectingAnswerDone,h.selectingAnswerDone)}else{if(h.hiScore.visible){h.hiScore.hide()}}}else{if(!h.hasQuestions()&&!h.hiScore.visible){h.hiScore.show();h.updateHiScores()}}break;case b.game.classes.heartPah.phases.waitingForAnswers:if(h.nicknameText.visible){h.nicknameText.hide()}if(h.hiScore.visible){h.hiScore.hide()}if(!h.hasQuestions()&&!h.selectedAnswer()&&(b.client.input.Orientation.current==b.client.input.Orientations.FaceUp||b.client.input.Orientation.current==b.client.input.Orientations.FaceDown)&&h.phaseDuration()>300){b.product.pah.sfx.play("key");h.selectingAnswer=true;b.product.pah.PahApplication.server.invoke("selectAnswer",[b.product.pah.PahApplication.server.playerId,h.currentCard.id],h.selectingAnswerDone,h.selectingAnswerDone);h.setInfoText(b.client.input.Orientation.supported?h.strings.get("Put an answer face down."):h.strings.get("Drop the phone, face up."))}break;case b.game.classes.heartPah.phases.waitingToUnravel:if(h.nicknameText.visible){h.nicknameText.hide()}break;case b.game.classes.heartPah.phases.waitingForBestAnswer:if(h.nicknameText.visible){h.nicknameText.hide()}break;case b.game.classes.heartPah.phases.bestAnswerSelected:if(!h.nicknameText.visible){h.nicknameText.show()}if(b.product.pah.PahApplication.server.session.state.bestPlayerId==b.product.pah.PahApplication.server.playerId){if((++h.frame)%6===0){if(((h.frame)/6)%2===0){h.leaderLabel.hide()}else{h.leaderLabel.show()}}}break;case b.game.classes.heartPah.phases.timeForNextQuestion:if(!h.nicknameText.visible){h.nicknameText.show()}if(!h.leaderLabel.visible){h.leaderLabel.show()}break}if(h.lastShowingCards!=L.state.showingCards||h.lastPhase!==b.product.pah.PahApplication.server.session.state.phase){h.refreshView()}if(h.lastPhase!==b.product.pah.PahApplication.server.session.state.phase){h.phaseStartTime=N;switch(b.product.pah.PahApplication.server.session.state.phase){case b.game.classes.heartPah.phases.waitingToPickup:if(h.hasQuestions()){h.backgroundRegular.hide();h.backgroundWhite.show()}h.setInfoText((b.client.input.Orientation.supported?h.strings.get("Pickup the phone"):h.strings.get("Pickup the phone, long press.")));break;case b.game.classes.heartPah.phases.waitingForQuestion:h.backgroundRegular.show();h.backgroundWhite.hide();h.hiddenText.show();h.setInfoText(h.hasQuestions()?(b.client.input.Orientation.supported?h.strings.get("Put a question face up."):h.strings.get("Long press a question.")):h.strings.get("Wait for the question."));h.leaderLabel.hide();break;case b.game.classes.heartPah.phases.waitingForAnswers:h.setInfoText(h.hasQuestions()?(b.client.input.Orientation.supported?h.strings.get("Wait for answers."):h.strings.get("Drop the phone, face up.")):(b.client.input.Orientation.supported?h.strings.get("Put an answer face down."):h.strings.get("Long press an answer.")));break;case b.game.classes.heartPah.phases.waitingToUnravel:h.setInfoText(h.hasQuestions()?h.strings.get("Flip all answers."):(b.client.input.Orientation.supported?" ":h.strings.get("Long press to flip.")));break;case b.game.classes.heartPah.phases.waitingForBestAnswer:h.hiddenText.hide();h.setInfoText(h.hasQuestions()?h.strings.get("Press and hold the best answer."):" ");break;case b.game.classes.heartPah.phases.bestAnswerSelected:h.setInfoText(" ");var M="",H="";for(var K in b.product.pah.PahApplication.server.session.state.players){var J=b.product.pah.PahApplication.server.session.state.players[K];var I=J.state.cards[J.state.selectedCardId];if(I&&I.state.type=="cardQuestion"){M=I&&I.state.text}else{if(b.product.pah.PahApplication.server.session.state.bestPlayerId==J.id){H=I&&I.state.text}}}M=M.replace("...","~#~");if(M.indexOf("_")==-1){M+=" "+H}else{M=M.replace("_",H)}M=M.replace("..",".").replace("?.","?").replace("!.","!").replace("~#~","...");if(L.id==b.product.pah.PahApplication.server.session.state.bestPlayerId){h.leaderLabel.setText(h.strings.get("You're awesome!"))}else{h.leaderLabel.setText(b.product.pah.PahApplication.server.session.state.players[b.product.pah.PahApplication.server.session.state.bestPlayerId].state.nickname+h.strings.get(" is awesome."))}h.leaderLabel.show();h.leaderText.setText(M);h.leaderText.show();if(b.product.pah.PahApplication.server.session.state.bestPlayerId==b.product.pah.PahApplication.server.playerId){b.product.pah.sfx.play("ack")}break;case b.game.classes.heartPah.phases.timeForNextQuestion:if(h.hiScore.visible){h.hiScore.hide()}if(!h.nicknameText.visible){h.nicknameText.show()}if(h.leaderText.visible){h.leaderText.hide()}if(L.state.host){b.product.pah.PahApplication.server.invokeRaw("roulette",[b.product.pah.PahApplication.server.session.id,b.product.pah.PahApplication.server.session.state.frame+(1000/b.game.kernel.frameDuration)|0,b.product.pah.PahApplication.server.playerId,true])}for(cardId in h.cardUi){this.removeChild(h.cardUi[cardId].visual.id);h.cardUi[cardId].visual.release()}h.cardUi={};break}h.lastPhase=b.product.pah.PahApplication.server.session.state.phase}h.lastShowingCards=L.state.showingCards};return this.init.apply(this,arguments)};b.product.pah.screen.GameScreen.prototype=new b.product.pah.screen.PahScreen();return b})(tvg);tvg=(function(b){var a=function a(){var c=arguments.callee.prototype;var e={};this.server=null;this.init=function d(){c.init.call(this);this.server=new b.client.net.classes.server();return this};this.release=function h(){e=null;this.server.release();this.server=null;c.release.call(this)};this.loadDrivers=function g(){c.loadDrivers.call(this);b.client.net.classes.server.detect("192.168.1.42");b.client.gfx.Driver.load(new b.product.pah.configuration.gfxDriver());b.client.sfx.Driver.load(new b.product.pah.configuration.sfxDriver());b.client.input.Driver.load(new b.product.pah.configuration.cameraDriver());b.client.input.Driver.load(new b.product.pah.configuration.qrDriver());b.client.input.Driver.load(new b.client.input.classes.KeyboardDriver());b.client.input.Driver.load(new b.product.pah.configuration.pointerDriver());b.client.input.Driver.load(new b.product.pah.configuration.orientationDriver());b.client.data.Driver.load(new b.product.pah.configuration.dataDriver())};this.loadApplicationState=function f(){c.loadApplicationState.call(this);b.product.pah.Nickname=b.client.data.Driver.current.get("pah.Nickname","Anonymous");b.game.log.information("pah.Nickname = "+b.product.pah.Nickname);b.product.pah.Hostname=b.client.data.Driver.current.get("pah.Hostname","borinstan.no-ip.org");b.game.log.information("pah.Hostname = "+b.product.pah.Hostname);b.client.input.Orientation.calibration.faceUp.mean.alpha=b.client.data.Driver.current.get("calibration.faceUp.mean.alpha",b.client.input.Orientation.calibration.faceUp.mean.alpha);b.client.input.Orientation.calibration.faceUp.mean.beta=b.client.data.Driver.current.get("calibration.faceUp.mean.beta",b.client.input.Orientation.calibration.faceUp.mean.beta);b.client.input.Orientation.calibration.faceUp.mean.gamma=b.client.data.Driver.current.get("calibration.faceUp.mean.gamma",b.client.input.Orientation.calibration.faceUp.mean.gamma);b.client.input.Orientation.calibration.faceUp.deviation.alpha=b.client.data.Driver.current.get("calibration.faceUp.deviation.alpha",b.client.input.Orientation.calibration.faceUp.deviation.alpha);b.client.input.Orientation.calibration.faceUp.deviation.beta=b.client.data.Driver.current.get("calibration.faceUp.deviation.beta",b.client.input.Orientation.calibration.faceUp.deviation.beta);b.client.input.Orientation.calibration.faceUp.deviation.gamma=b.client.data.Driver.current.get("calibration.faceUp.deviation.gamma",b.client.input.Orientation.calibration.faceUp.deviation.gamma);b.client.input.Orientation.calibration.faceDown.mean.alpha=b.client.data.Driver.current.get("calibration.faceDown.mean.alpha",b.client.input.Orientation.calibration.faceDown.mean.alpha);b.client.input.Orientation.calibration.faceDown.mean.beta=b.client.data.Driver.current.get("calibration.faceDown.mean.beta",b.client.input.Orientation.calibration.faceDown.mean.beta);b.client.input.Orientation.calibration.faceDown.mean.gamma=b.client.data.Driver.current.get("calibration.faceDown.mean.gamma",b.client.input.Orientation.calibration.faceDown.mean.gamma);b.client.input.Orientation.calibration.faceDown.deviation.alpha=b.client.data.Driver.current.get("calibration.faceDown.deviation.alpha",b.client.input.Orientation.calibration.faceDown.deviation.alpha);b.client.input.Orientation.calibration.faceDown.deviation.beta=b.client.data.Driver.current.get("calibration.faceDown.deviation.beta",b.client.input.Orientation.calibration.faceDown.deviation.beta);b.client.input.Orientation.calibration.faceDown.deviation.gamma=b.client.data.Driver.current.get("calibration.faceDown.deviation.gamma",b.client.input.Orientation.calibration.faceDown.deviation.gamma);b.game.log.information("calibration.faceUp.mean.alpha = "+b.client.input.Orientation.calibration.faceUp.mean.alpha);b.game.log.information("calibration.faceUp.mean.beta = "+b.client.input.Orientation.calibration.faceUp.mean.beta);b.game.log.information("calibration.faceUp.mean.gamma = "+b.client.input.Orientation.calibration.faceUp.mean.gamma);b.game.log.information("calibration.faceUp.deviation.alpha = "+b.client.input.Orientation.calibration.faceUp.deviation.alpha);b.game.log.information("calibration.faceUp.deviation.beta = "+b.client.input.Orientation.calibration.faceUp.deviation.beta);b.game.log.information("calibration.faceUp.deviation.gamma = "+b.client.input.Orientation.calibration.faceUp.deviation.gamma);b.game.log.information("calibration.faceDown.mean.alpha = "+b.client.input.Orientation.calibration.faceDown.mean.alpha);b.game.log.information("calibration.faceDown.mean.beta = "+b.client.input.Orientation.calibration.faceDown.mean.beta);b.game.log.information("calibration.faceDown.mean.gamma = "+b.client.input.Orientation.calibration.faceDown.mean.gamma);b.game.log.information("calibration.faceDown.deviation.alpha = "+b.client.input.Orientation.calibration.faceDown.deviation.alpha);b.game.log.information("calibration.faceDown.deviation.beta = "+b.client.input.Orientation.calibration.faceDown.deviation.beta);b.game.log.information("calibration.faceDown.deviation.gamma = "+b.client.input.Orientation.calibration.faceDown.deviation.gamma)};this.showStartingScreen=function i(){c.showStartingScreen.call(this);this.showScreen(b.product.pah.screen.SplashScreen)};return this.init.apply(this,arguments)};a.prototype=new b.client.app.classes.Application();b.product.pah.PahApplication=new a();return b})(tvg);tvg=(function(b){b.game.classes.heartPah=function a(){var c=arguments.callee.prototype;var f={};this.init=function e(){c.init.call(this);return this};this.release=function h(){c.release.call(this)};f.shuffle=function i(r,k){var q=b.game.classes.entity.lastId;for(playerId in r.players){q+=(playerId|0+1)*(r.players[playerId].state.points|0)}var n=new b.game.classes.randomizer(q);for(var o=0;o<3;o++){for(var m,s,l=k.length;l;m=Math.round(n.generate(l-1)),s=k[--l],k[l]=k[m],k[m]=s){}}return k};f.phaseDuration=function g(j){return j.time-j.phaseStartTime};this.beat=function d(u){c.beat.call(this,u);var s=Object.keys(u.players);if(!u.phase){u.phase=b.game.classes.heartPah.phases.timeForNextQuestion;u.phaseStartTime=u.time}var t=u.phase;switch(u.phase){case b.game.classes.heartPah.phases.waitingToPickup:var j=true;for(var n=0;j&&n<s.length;n++){j&=(u.players[s[n]].state.orientation==0)}if(j&&u.roundStarted&&u.currentPlayerId!==undefined){u.phase=b.game.classes.heartPah.phases.waitingForQuestion}break;case b.game.classes.heartPah.phases.waitingForQuestion:for(var n=0;n<s.length;n++){var q=u.players[s[n]];if(q.id==u.currentPlayerId){if(!q.state.showingCards||q.state.locked){q.state.showingCards=true;q.state.locked=false}if(q.state.orientation==1){if(q.state.selected=!!q.state.selectedCardId){u.phase=b.game.classes.heartPah.phases.waitingForAnswers}}}else{if(q.state.showingCards||!q.state.locked){q.state.showingCards=false;q.state.locked=true}}}break;case b.game.classes.heartPah.phases.waitingForAnswers:var k=true;for(var n=0;n<s.length;n++){var q=u.players[s[n]];if(q.id==u.currentPlayerId){if(!q.state.showingCards||!q.state.locked){q.state.showingCards=true;q.state.locked=true}}else{if(!q.state.selected){if(q.state.orientation==0&&(!q.state.showingCards||q.state.locked)){q.state.showingCards=true;q.state.locked=false}else{if(q.state.orientation!=0&&(q.state.showingCards||!q.state.locked||q.state.selected!=!!q.state.selectedCardId)){q.state.showingCards=false;q.state.locked=true;q.state.selected=!!q.state.selectedCardId}}}else{if(q.state.orientation==0&&(!q.state.showingCards||q.state.locked||q.state.selected||q.state.selectedCardId)){q.state.showingCards=true;q.state.locked=false;q.state.selected=false;q.state.selectedCardId=null;delete q.state.selectedCardId}else{if(q.state.orientation!=0&&(q.state.showingCards||!q.state.locked)){q.state.showingCards=false;q.state.locked=true}}}k&=q.state.selected}}if(k){var o=[];var r=[];for(var n=0;n<s.length;n++){var q=u.players[s[n]];if(q.id==u.currentPlayerId){continue}o.push(q.id);r.push(q.state.selectedCardId)}r=f.shuffle(u,r);for(var n=0;n<o.length;n++){var q=u.players[o[n]];var m=r[n];u.players[o[n]].state.showCardText=u.deck.state.cards[m].state.text}u.phase=b.game.classes.heartPah.phases.waitingToUnravel}break;case b.game.classes.heartPah.phases.waitingToUnravel:var l=true;for(var n=0;n<s.length;n++){var q=u.players[s[n]];if(q.id!=u.currentPlayerId){if(!q.state.showingCards&&q.state.orientation==1&&!q.state.showingCards){q.state.showingCards=true}else{if(q.state.showingCards&&q.state.orientation!=1&&q.state.showingCards){q.state.showingCards=false}}l&=q.state.showingCards}}if(l){u.phase=b.game.classes.heartPah.phases.waitingForBestAnswer}break;case b.game.classes.heartPah.phases.waitingForBestAnswer:break;case b.game.classes.heartPah.phases.bestAnswerSelected:for(var n=0;n<s.length;n++){var q=u.players[s[n]];if(q.state.showingCards){q.state.showingCards=false}}if(u.frame>=u.phaseEndFrame){u.phase=b.game.classes.heartPah.phases.timeForNextQuestion}break;case b.game.classes.heartPah.phases.timeForNextQuestion:break}if(u.phase!=t){u.phaseStartTime=u.time;switch(u.phase){case b.game.classes.heartPah.phases.waitingToPickup:b.game.log.information("Game "+u.id+", phase changed to waitingToPickup.");break;case b.game.classes.heartPah.phases.waitingForQuestion:b.game.log.information("Game "+u.id+", phase changed to waitingForQuestion.");break;case b.game.classes.heartPah.phases.waitingForAnswers:b.game.log.information("Game "+u.id+", phase changed to waitingForAnswers.");break;case b.game.classes.heartPah.phases.waitingToUnravel:b.game.log.information("Game "+u.id+", phase changed to waitingToUnravel.");break;case b.game.classes.heartPah.phases.waitingForBestAnswer:b.game.log.information("Game "+u.id+", phase changed to waitingForBestAnswer.");break;case b.game.classes.heartPah.phases.bestAnswerSelected:b.game.log.information("Game "+u.id+", phase changed to bestAnswerSelected.");break;case b.game.classes.heartPah.phases.timeForNextQuestion:b.game.log.information("Game "+u.id+", phase changed to timeForNextQuestion.");break}}};return this.init.apply(this,arguments)};b.game.classes.heartPah.prototype=new b.game.classes.heart();b.game.classes.heartPah.phases={waitingToPickup:5,waitingForQuestion:1,waitingForAnswers:2,waitingToUnravel:3,waitingForBestAnswer:4,bestAnswerSelected:6,timeForNextQuestion:7};return b})(tvg);tvg=(function(b){b.game.classes.deck=function a(j){var c=arguments.callee.prototype;var f={};this.state.sessionId=null;this.state.cards=null;this.init=function e(l){c.init.call(this,"deck");this.state.sessionId=""+l;this.state.cards={};return this};this.release=function h(){c.release.call(this)};f.shuffle=function k(l){var r=b.game.classes.entity.lastId;var o=new b.game.classes.randomizer(r);for(var q=0;q<3;q++){for(var n,s,m=l.length;m;n=Math.round(o.generate(m-1)),s=l[--m],l[m]=l[n],l[n]=s){}}return l};this.load=function g(u,l){var m=f.shuffle(u.split("\n"));b.game.log.information("Game "+this.state.sessionId+", loading "+m.length+" questions to the card deck.");var o=0,q=0;for(var r=0;r<m.length;r++){if(!m[r]||m[r].trim()===""){q++;continue}var s=false;for(var t in this.state.cards){if(this.state.cards[t].type==="cardQuestion"&&this.state.cards[t]===m[r]){s=true;break}}if(s){o++;continue}var n=new b.game.classes.cardQuestion(m[r]);this.state.cards[n.id]=n}b.game.log.information("Game "+this.state.sessionId+", "+o+" duplicates, "+q+" blanks rejected, "+(m.length-o-q)+" new questions added, deck size "+(Object.keys(this.state.cards).length)+".");o=0,q=0;m=f.shuffle(l.split("\n"));b.game.log.information("Game "+this.state.sessionId+", loading "+m.length+" answers to the card deck.");for(var r=0;r<m.length;r++){if(!m[r]||m[r].trim()===""){q++;continue}var s=false;for(var t in this.state.cards){if(this.state.cards[t].type==="cardAnswer"&&this.state.cards[t]===m[r]){s=true;break}}if(s){continue}var n=new b.game.classes.cardAnswer(m[r]);this.state.cards[n.id]=n}b.game.log.information("Game "+this.state.sessionId+", "+o+" duplicates, "+q+" blanks rejected, "+(m.length-o-q)+" new answers added, deck size "+(Object.keys(this.state.cards).length)+".")};this.draw=function d(o,n){for(var m in this.state.cards){var l=this.state.cards[m];if(l.state.type===o&&l.state.position===b.game.classes.card.position.deck){if(!n.state.cards){n.state.cards={}}l.draw(n.id);n.state.cards[l.id]=l;return l}}return null};this.reset=function i(){for(var l in this.state.cards){this.state.cards[l].reset()}};return this.init.apply(this,arguments)};b.game.classes.deck.prototype=new b.game.classes.entity();return b})(tvg);tvg=(function(b){b.game.classes.card=function a(l,i){var c=arguments.callee.prototype;this.state.text=null;this.state.position=null;this.init=function f(n,m){c.init.call(this,n);this.state.text=m?""+m:null;this.state.position=b.game.classes.card.position.deck;return this};this.release=function g(){c.release.call(this)};this.draw=function d(){switch(this.state.position){case b.game.classes.card.position.deck:this.state.position=b.game.classes.card.position.player;break;default:break}};this.throwFaceUp=function k(){switch(this.state.position){case b.game.classes.card.position.player:this.state.position=b.game.classes.card.position.faceUp;break;default:break}};this.throwFaceDown=function j(){switch(this.state.position){case b.game.classes.card.position.player:this.state.position=b.game.classes.card.position.faceDown;break;default:break}};this.flip=function e(){switch(this.state.position){case b.game.classes.card.position.faceUp:this.state.position=b.game.classes.card.position.faceDown;break;case b.game.classes.card.position.faceDown:this.state.position=b.game.classes.card.position.faceUp;break;default:break}};this.reset=function h(){switch(this.state.position){case b.game.classes.card.position.player:case b.game.classes.card.position.faceUp:case b.game.classes.card.position.faceDown:this.state.position=b.game.classes.card.position.deck;this.state.position=b.game.classes.card.position.deck;break;default:break}};return this.init.apply(this,arguments)};b.game.classes.card.prototype=new b.game.classes.entity();b.game.classes.card.position={deck:0,player:1,faceUp:2,faceDown:3};return b})(tvg);tvg=(function(b){b.game.classes.cardQuestion=function a(f){var c=arguments.callee.prototype;this.init=function d(g){c.init.call(this,"cardQuestion",g);return this};this.release=function e(){c.release.call(this)};return this.init.apply(this,arguments)};b.game.classes.cardQuestion.prototype=new b.game.classes.card();return b})(tvg);tvg=(function(b){b.game.classes.cardAnswer=function a(f){var c=arguments.callee.prototype;this.init=function d(g){c.init.call(this,"cardAnswer",g);return this};this.release=function e(){c.release.call(this)};return this.init.apply(this,arguments)};b.game.classes.cardAnswer.prototype=new b.game.classes.card();return b})(tvg);tvg=(function(b){b.game.command.classes.flashPlayerScreen=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"flashPlayerScreen",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(i,g){if(!this.session){b.game.log.warning("Game ?, can't flashPlayerScreen("+i+", "+g+").");this.failed("Invalid session");return}if(!this.session.state.players[i]){b.game.log.warning("Game "+this.session.id+", player "+i+", can't set flashing to "+g+", player not in the game.");this.failed("Invalid player ID: "+i);return}if(g){b.game.log.information("Game "+this.session.id+", player "+i+", flashing.")}else{b.game.log.information("Game "+this.session.id+", player "+i+", unflashing.")}for(var h in this.session.state.players){this.session.state.players[h].state.flashing=h==i&&g}this.succeeded({})};return this.init.apply(this,arguments)};b.game.command.classes.flashPlayerScreen.prototype=new b.game.command.classes.command();return b})(tvg);tvg=(function(b){b.game.command.classes.roulette=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"roulette",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(q,t){if(!this.session){b.game.log.warning("Game ?, roulette("+q+", "+t+").");this.failed("Invalid session");return}var o=this.session.state.players[q];if(!o){b.game.log.warning("Game "+this.session.id+", player "+q+", invalid player, can't roulette "+(t?"to the next player":"to random player")+".");this.failed("Invalid player ID: "+q);return}b.game.log.information("Game "+this.session.id+", player "+q+", rouletting "+(t?"to the next player":"to random player")+".");var g=[];for(var n in this.session.state.players){g.push(this.session.state.players[n])}var k=null;for(var l=0;l<g.length;l++){if(g[l].id==this.session.state.currentPlayerId){k=l}}var m=(15/g.length)|0,r=1,j=((400/60)|0)*60;var s=totalPoints=0?(((1+Math.sin(this.session.id))/2)*g.length)|0:(k+2)%g.length;if(t){m=3;s=(k+1)%g.length}b.game.log.information("Game "+this.session.id+", player "+q+", roulette selected player "+g[s].id+".");while(r<=m){for(var l=0;l<g.length;l++){var h=new b.game.command.classes.flashPlayerScreen([this.session.id,this.session.state.frame+((((r-1)*g.length+l)*j)/b.game.kernel.frameDuration)|0,g[l].id,true]);b.game.kernel.enqueue(h);if(r==m&&l==s){h=new b.game.command.classes.flashPlayerScreen([this.session.id,this.session.state.frame+((((r-1)*g.length+l+2)*j)/b.game.kernel.frameDuration)|0,g[l].id,false]);b.game.kernel.enqueue(h);break}}r++}var h=new b.game.command.classes.nextRound([this.session.id,this.session.state.frame+((((m+1)*g.length+s)*j)/b.game.kernel.frameDuration)|0,g[s].id]);b.game.kernel.enqueue(h);h=new b.game.command.classes.currentPlayer([this.session.id,this.session.state.frame+((((m+1)*g.length+s)*j)/b.game.kernel.frameDuration)|0,g[s].id]);b.game.kernel.enqueue(h);this.failed()};return this.init.apply(this,arguments)};b.game.command.classes.roulette.prototype=new b.game.command.classes.command();return b})(tvg);tvg=(function(b){b.game.command.classes.currentPlayer=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"currentPlayer",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(h){if(!this.session){b.game.log.warning("Game ?, can't currentPlayer("+h+").");this.failed("Invalid session");return}var g=this.session.state.players[h];if(!g){b.game.log.warning("Game "+this.session.id+", player "+h+", can't set current, player not in the game.");this.failed("Invalid player ID: "+h);return}b.game.log.information("Game "+this.session.id+", player "+h+", set as current player, switching phase to waitingToPickup.");this.session.state.currentPlayerId=h;this.session.state.phase=5;this.succeeded({})};return this.init.apply(this,arguments)};b.game.command.classes.currentPlayer.prototype=new b.game.command.classes.command();return b})(tvg);tvg=(function(b){b.game.command.classes.resetPoints=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"resetPoints",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(g){if(!this.session){b.game.log.warning("Game ?, can't resetPoints("+g+").");this.failed("Invalid session.");return}b.game.log.information("Game "+this.session.id+", player "+g+", reset points.");for(var g in this.session.state.players){this.session.state.players[g].state.points=0}this.succeeded({})};return this.init.apply(this,arguments)};b.game.command.classes.resetPoints.prototype=new b.game.command.classes.command();return b})(tvg);tvg=(function(b){b.game.command.classes.orientationChanged=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"orientationChanged",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(i,g){if(!this.session){this.failed("Invalid session.");return}var h=this.session.state.players[i];if(!h){this.failed("Invalid player ID: "+i);return}switch(g|0){case -1:b.game.log.information("Game "+this.session.id+", player "+i+", orientation changed to face-down.");break;case 0:b.game.log.information("Game "+this.session.id+", player "+i+", orientation changed to moving.");break;case 1:b.game.log.information("Game "+this.session.id+", player "+i+", orientation changed to face-up.");break;default:b.game.log.error("Game "+this.session.id+", player "+i+", invalid orientation "+(g|0)+", can't change orientation.");this.failed("Invalid orientation: "+(g|0));return}h.state.orientation=g|0;this.succeeded({})};return this.init.apply(this,arguments)};b.game.command.classes.orientationChanged.prototype=new b.game.command.classes.command();return b})(tvg);tvg=(function(b){b.game.command.classes.nextRound=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"nextRound",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(h){if(!this.session){b.game.log.warning("Game ?, can't nextRound("+h+").");this.failed("Invalid session");return}for(playerId in this.session.state.players){var i=this.session.state.players[playerId];for(cardId in i.state.cards){var g=i.state.cards[cardId];if(!g){continue}if(g.state.type=="cardQuestion"||i.state.selectedCardId==g.id){g.throwFaceUp();i.state.cards[cardId]=null;delete i.state.cards[cardId]}}i.state.showingCards=false;i.state.locked=true;i.state.selected=false;if(i.state.selectedCardId){delete i.state.selectedCardId}}for(playerId in this.session.state.players){var i=this.session.state.players[playerId];if(i.id==h){this.session.state.deck.draw("cardQuestion",i);this.session.state.deck.draw("cardQuestion",i)}var j=0;for(cardId in i.state.cards){var g=i.state.cards[cardId];if(g&&g.state.type=="cardAnswer"){j++}}while(i.state.cards===undefined||j<10){this.session.state.deck.draw("cardAnswer",i);j++}}b.game.log.information("Game "+this.session.id+", player "+h+", set as player asking question, starting next round.");this.succeeded({})};return this.init.apply(this,arguments)};b.game.command.classes.nextRound.prototype=new b.game.command.classes.command();return b})(tvg);tvg=(function(b){b.game.command.classes.addCards=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"addCards",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(h,g){if(!this.session){b.game.log.warning("Game ?, can't addCards("+(h.length|0)+" chars, "+(g.length|0)+" chars).");this.failed("Invalid session.");return}if(!h&&!g){b.game.log.warning("Game "+this.session.id+", can't addCards("+(h.length|0)+" chars, "+(g.length|0)+" chars), no cards specified.");this.failed("Expected questions / answers.");return}b.game.log.information("Game "+this.session.id+", adding cards to the game.");if(!this.session.state.deck){this.session.state.deck=new b.game.classes.deck(this.session.id)}this.session.state.deck.load(h,g);this.succeeded({})};return this.init.apply(this,arguments)};b.game.command.classes.addCards.prototype=new b.game.command.classes.command();return b})(tvg);tvg=(function(b){b.game.command.classes.selectAnswer=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"selectAnswer",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(i,g){if(!this.session){b.game.log.warning("Game ?, can't selectAnswer("+i+", "+g+").");this.failed("Invalid session.");return}var h=this.session.state.players[i];if(!h){b.game.log.warning("Game "+this.session.id+", player "+i+", invalid player, can't select card "+g+".");this.failed("Invalid player ID: "+i);return}b.game.log.information("Game "+this.session.id+", player "+i+", selected card "+g+".");h.state.selectedCardId=g;this.succeeded({})};return this.init.apply(this,arguments)};b.game.command.classes.selectAnswer.prototype=new b.game.command.classes.command();return b})(tvg);tvg=(function(b){b.game.command.classes.selectBestAnswer=function a(){var c=arguments.callee.prototype;this.init=function e(g,j,h,i){c.init.call(this,"selectBestAnswer",g,j,h,i)};this.release=function f(){c.release.call(this)};this.execute=function d(k){if(!this.session){b.game.log.warning("Game ?, can't selectBestAnswer("+k+").");this.failed("Invalid session.");return}var j=this.session.state.players[k];if(!j){b.game.log.warning("Game "+this.session.id+", player "+k+", invalid player, can't award winning answer.");this.failed("Invalid player ID: "+k);return}b.game.log.information("Game "+this.session.id+", player "+k+", awarded winning answer, switching phase to bestAnswerSelected.");var h=j.state.showCardText;for(pid in this.session.state.players){var i=this.session.state.players[pid];var g=this.session.state.deck.state.cards[i.state.selectedCardId];if(g){if(g.state.text===h){i.state.points+=1;this.session.state.bestPlayerId=pid}if(i.state.showCardText){delete i.state.showCardText}}}this.session.state.phase=6;this.session.state.phaseEndFrame=this.session.state.frame+3000/b.game.kernel.frameDuration;this.succeeded({})};return this.init.apply(this,arguments)};b.game.command.classes.selectBestAnswer.prototype=new b.game.command.classes.command();return b})(tvg);tvg=(function(a){a.product.pah.configuration={serverUrl:"http://localhost:8069/",gfxDriver:a.client.gfx.classes.CssDriver,sfxDriver:a.client.sfx.classes.DriverHtml5,cameraDriver:a.client.input.classes.CameraDriverHtml5,qrDriver:a.client.input.classes.QrDriverHtml5,orientationDriver:a.client.input.classes.OrientationHtml5Driver,pointerDriver:a.client.input.classes.MouseDriver,dataDriver:a.client.data.classes.LocalStorageDriver};return a})(tvg);(function(){tvg.product.pah.configuration.pointerDriver=tvg.client.input.classes.TouchDriver;tvg.product.pah.PahApplication.start()})();</script>
    
    
    <script type="text/javascript" src="js/polyfill/TypedArray.js"></script>

    <!-- namespace -->
    

    <!-- game -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <!-- client -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <!-- net -->
    

    <!-- pah app -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    
    
    
    

    
    
    
    
    
    
    
    
    

    <!-- configuration -->
    
    

  </head>
  <body>
    <script type="text/javascript"></script>
  </body>
</html>
