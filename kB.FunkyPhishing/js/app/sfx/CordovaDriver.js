app.sfx.CordovaDriver=function(){var e=Class.inherit(this,app.sfx.Driver);var a={};a.sounds={};a.playbacks={};e.init=function(){};e.cleanup=function(){};e.loadSound=function(e,n){var o={sound:e,url:e.url()+".mp3",callback:n};a.sounds[e.id()]=o;o.audio=new Media(o.url);o.sound.loaded(true);if(o.callback){o.callback()}return true};e.removeSound=function(e){if(!a.sounds[e]){return}a.sounds[e].audio.release();delete a.sounds[e].audio;delete a.sounds[e]};e.play=function(e,n,o,d){if(!a.sounds[e]){return null}var i={playbackId:app.sfx.CordovaDriver.nextPlaybackId++,soundId:e,url:a.sounds[e].url,releaseAudio:!a.sounds[e].sound.singleton(),onstartedTriggered:false,onstarted:n,onfinished:o,onprogress:d,latency:0,latencyWeight:0,updateProgress:function(){i.audio.getCurrentPosition(i.positionUpdated)},positionUpdated:function(e){if(e>-1){if(!i.onstartedTriggered){i.onstartedTriggered=true;if(i.onstarted){i.onstarted()}}var n=app.Application.time()-i.startTime;var o=e*1e3;var d=o-n;i.latency=(i.latencyWeight*i.latency+d)/(i.latencyWeight+1);i.latencyWeight++;var s=n+i.latency;if(s>=a.sounds[i.soundId].sound.duration()-100){i.onended()}else if(i.onprogress){i.onprogress(s)}}}};a.playbacks[i.playbackId]=i;i.onended=function(){clearInterval(i.intervalId);if(i.onfinished){i.onfinished()}if(i.releaseAudio){i.audio.release();delete i.audio}delete a.playbacks[i.playbackId]};if(a.sounds[e].sound.singleton()){i.audio=a.sounds[e].audio}else{i.audio=new Media(i.url)}i.intervalId=setInterval(i.updateProgress,1e3);i.audio.play();i.startTime=app.Application.time();return i.playbackId};e.stop=function(e){if(!a.playbacks[e]){return}var n=a.playbacks[e];n.audio.pause();n.onended()}};app.sfx.CordovaDriver.nextPlaybackId=0;