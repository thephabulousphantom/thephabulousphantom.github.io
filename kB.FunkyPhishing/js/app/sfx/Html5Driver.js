app.sfx.Html5Driver=function(){var e=Class.inherit(this,app.sfx.Driver);var a={};a.sounds={};a.playbacks={};a.muted=false;e.init=function(){};e.cleanup=function(){};e.mute=function(e){if(e===undefined){return a.muted}e=!!e;for(playbackId in a.playbacks){a.playbacks[playbackId].audio.volume=e?0:1;a.playbacks[playbackId].audio.muted=e}a.muted=e};e.loadSound=function(e,n){var d=new Audio;var o=app.sfx.Driver.forceAudioMediaType;if(!o){if(!!(d.canPlayType&&d.canPlayType("audio/mpeg;").replace(/no/,""))){o=".mp3"}else if(!!(d.canPlayType&&d.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""))){o=".ogg"}else{return false}}var t={sound:e,url:e.url()+o,audio:d,callback:n};d.addEventListener("canplaythrough",a.onloaded);d.data=t;d.preload="auto";d.src=e.url()+o;d.load();a.sounds[e.id()]=t;return true};a.onloaded=function(){this.removeEventListener("canplaythrough",a.onloaded);this.data.sound.loaded(true);if(this.data.callback){this.data.callback()}};e.removeSound=function(e){if(!a.sounds[e]){return}a.sounds[e].audio.removeEventListener("canplaythrough",a.onloaded);a.sounds[e].audio.removeEventListener("timeupdate",a.ontimeupdate);a.sounds[e].audio.removeEventListener("ended",a.onended);delete a.sounds[e].audio;delete a.sounds[e]};e.play=function(e,n,d,o){if(!a.sounds[e]){return null}var t=null;if(a.sounds[e].sound.singleton()){t=a.sounds[e].audio;t.removeEventListener("timeupdate",a.ontimeupdate);t.removeEventListener("ended",a.onended)}else{t=new Audio;t.preload="auto";t.src=a.sounds[e].url;t.load()}var i={playbackId:app.sfx.Html5Driver.nextPlaybackId++,audio:t,url:a.sounds[e].url,releaseAudio:!a.sounds[e].sound.singleton(),playbackStarted:false,onstarted:n,onfinished:d,onprogress:o};a.playbacks[i.playbackId]=i;t.playdata=i;t.volume=a.muted?0:1;t.muted=a.muted;if(o||n){t.addEventListener("timeupdate",a.ontimeupdate)}t.addEventListener("ended",a.onended);t.play();return i.playbackId};a.ontimeupdate=function(){var e=this.playdata;if(e.onstarted){e.onstarted();e.onstarted=null}if(e.onprogress){e.onprogress(e.audio.currentTime*1e3|0)}};a.onended=function(){this.removeEventListener("canplaythrough",a.onloaded);this.removeEventListener("timeupdate",a.ontimeupdate);this.removeEventListener("ended",a.onended);var e=this.playdata;if(a.playbacks[e.playbackId]){if(e.onfinished){e.onfinished();e.onfinished=null}if(e.releaseAudio){delete e.audio}delete a.playbacks[e.playbackId]}};e.stop=function(e){if(!a.playbacks[e]){return}var n=a.playbacks[e];n.audio.pause();a.onended.call(n.audio)}};app.sfx.Html5Driver.nextPlaybackId=0;