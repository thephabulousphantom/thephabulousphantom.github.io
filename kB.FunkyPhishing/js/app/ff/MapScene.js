app.ff.MapScene=function(){var e=Class.inherit(this,app.Scene,["mapScene","img/mapBackground.jpg"]);var n={};n.help=new app.gfx.Sprite("map.help","img/mapHelp.png",1,9080,4370,1390,640);n.town=new app.gfx.Sprite("map.town","img/mapTown.png",1,4800,4900,1740,1260);n.city=new app.gfx.Sprite("map.city","img/mapCity.png",2,1150,6660,6040/2,3560);n.resort=new app.gfx.Sprite("map.resort","img/mapResort.png",2,5520,7990,9280/2,3440);n.island=new app.gfx.Sprite("map.island","img/mapIsland.png",2,2650,11770,8140/2,1920);n.funky=new app.gfx.Sprite("map.funky","img/mapFunky"+app.ff.State.difficulty()+".png",1,8490,4460,1050,1910);n.unlock=new app.gfx.Sprite("map.unlock","img/unlock.png",3,2240,7330,2850/3,1650);n.abortButton=new app.gfx.Sprite("abortButton","img/abortButton.png",1,9250,710,1070,1070);n.scoreText=new app.gfx.BitmapText(3,"score.text","img/fontCifre.png","0123456789",3350,1230,1280,1280,640);n.baloon=new app.gfx.Text("baloon","img/dialogRight.png","X",512,85,"ComicBookFont","#444",5430,710,3820,3190,550,true,true,550,350,350,950);n.music=new app.sfx.Channel("music");n.funkyPosition=[];e.init=function(t,o){e.loading(10,o);e.base.init(t,function(){e.addSprite(n.help,e.loaded);n.scoreText.init(e,e.loaded);n.scoreText.text(app.ff.State.score());n.help.show();e.addSprite(n.town,e.loaded);e.addSprite(n.city,e.loaded);e.addSprite(n.resort,e.loaded);e.addSprite(n.island,e.loaded);e.addSprite(n.unlock,e.loaded);e.addSprite(n.funky,e.loaded);e.addSprite(n.abortButton,e.loaded);e.addSprite(n.baloon,e.loaded);n.city.frame(app.ff.State.mapEnabled("city")?0:1);n.resort.frame(app.ff.State.mapEnabled("resort")?0:1);n.island.frame(app.ff.State.mapEnabled("island")?0:1);n.town.show();n.city.show();n.resort.show();n.island.show();n.unlock.show();n.funky.show();n.abortButton.show();n.funkyPosition.push({sprite:n.help,x:9250,y:2780,handler:n.helpReached});n.funkyPosition.push({sprite:n.town,x:5580,y:3230,handler:n.townReached});n.funkyPosition.push({sprite:n.city,x:1430,y:7200,handler:n.cityReached});n.funkyPosition.push({sprite:n.resort,x:7320,y:7060,handler:n.resortReached});n.funkyPosition.push({sprite:n.island,x:5450,y:11350,handler:n.islandReached});n.positionUnlock();n.unlock.onclick=n.doUnlock;n.help.onclick=function(){n.jumpTo(0)};n.abortButton.onclick=function(){e.bounce("abortButton",-300,200,e.exit);n.toMainMenu()};n.town.onclick=function(){n.jumpTo(1)};n.city.onclick=function(){if(app.ff.State.mapEnabled("city"))n.jumpTo(2)};n.resort.onclick=function(){if(app.ff.State.mapEnabled("resort"))n.jumpTo(3)};n.island.onclick=function(){if(app.ff.State.mapEnabled("island"))n.jumpTo(4)};n.funky.onclick=function(){n.jumpTo(app.ff.State.mapPosition())};n.funky.position.x=n.funkyPosition[app.ff.State.mapPosition()].x;n.funky.position.y=n.funkyPosition[app.ff.State.mapPosition()].y})};e.cleanup=function(){n.music.stop();e.base.cleanup();n=null;e=null};e.processCommand=function(t){if(e.base.processCommand(t)!=null){return}switch(t.code()){case"action":n.onGo();break;case"altaction":n.onNext();break}};e.updateFrame=function(n){e.base.updateFrame(n)};n.say=function(t){e.abortdelay(n.baloon.hide);n.baloon.text(app.data.Strings.get(t));n.baloon.show();e.delay(2e3,n.baloon.hide)};n.onGo=function(){switch(app.ff.State.mapPosition()){case 0:n.helpReached();return;case 1:n.townReached();return;case 2:n.cityReached();return;case 3:n.resortReached();return;case 4:n.islandReached();return}};n.onNext=function(){switch(app.ff.State.mapPosition()){case 0:n.jumpTo(1);return;case 1:if(app.ff.State.mapEnabled("city")){n.jumpTo(2)}else{n.doUnlock()}return;case 2:if(app.ff.State.mapEnabled("resort")){n.jumpTo(3)}else{n.doUnlock()}return;case 3:if(app.ff.State.mapEnabled("island")){n.jumpTo(4)}else{n.doUnlock()}return;case 4:n.jumpTo(0);return}};n.positionUnlock=function(){if(!app.ff.State.mapEnabled("city")){n.unlock.position.x=n.funkyPosition[2].x+(n.funky.size.x-n.unlock.size.x)/2;n.unlock.position.y=n.funkyPosition[2].y+(n.funky.size.y-n.unlock.size.y)/2;n.unlock.frame(0);n.unlock.show()}else if(!app.ff.State.mapEnabled("resort")){n.unlock.position.x=n.funkyPosition[3].x+(n.funky.size.x-n.unlock.size.x)/2;n.unlock.position.y=n.funkyPosition[3].y+(n.funky.size.y-n.unlock.size.y)/2;n.unlock.frame(1);n.unlock.show()}else if(!app.ff.State.mapEnabled("island")){n.unlock.position.x=n.funkyPosition[4].x+(n.funky.size.x-n.unlock.size.x)/2;n.unlock.position.y=n.funkyPosition[4].y+(n.funky.size.y-n.unlock.size.y)/2;n.unlock.frame(2);n.unlock.show()}else{n.unlock.hide()}};n.doUnlock=function(){if(!app.ff.State.mapEnabled("city")){if(app.ff.State.score()<10){e.bounce(n.city.id(),500,200);return}app.ff.State.score(app.ff.State.score()-10);n.scoreText.text(app.ff.State.score());e.bounce(n.unlock.id(),100,300,function(){app.ff.State.enableMap("city");n.city.frame(0);e.bounce(n.city.id(),500,200);n.positionUnlock()})}else if(!app.ff.State.mapEnabled("resort")){if(app.ff.State.score()<30){e.bounce(n.city.id(),500,200);return}app.ff.State.score(app.ff.State.score()-30);n.scoreText.text(app.ff.State.score());e.bounce(n.unlock.id(),100,300,function(){app.ff.State.enableMap("resort");n.resort.frame(0);e.bounce(n.resort.id(),500,200);n.positionUnlock()})}else if(!app.ff.State.mapEnabled("island")){if(app.ff.State.score()<90){e.bounce(n.city.id(),500,200);return}app.ff.State.score(app.ff.State.score()-90);n.scoreText.text(app.ff.State.score());e.bounce(n.unlock.id(),100,300,function(){app.ff.State.enableMap("island");n.island.frame(0);e.bounce(n.island.id(),500,200);n.positionUnlock()})}else{n.unlock.hide()}};n.resetGame=function(){app.ff.State.score(0);app.ff.State.disableMap("city");app.ff.State.disableMap("resort");app.ff.State.disableMap("island");n.jumpTo(0)};n.jumpTo=function(t){var o=app.ff.State.mapPosition();var a=o;if(t>o){a=o+1}else if(t<o){a=o-1}else if(t==o){n.funkyPosition[o].handler();return}var i=Math.sqrt(Math.pow(n.funkyPosition[a].x-n.funkyPosition[o].x,2)+Math.pow(n.funkyPosition[a].y-n.funkyPosition[o].y,2));e.bounceTo(n.funky.id(),n.funkyPosition[a].x,n.funkyPosition[a].y,i,i/20,function(){e.bounce(n.funkyPosition[a].sprite.id(),200,150,function(){app.ff.State.mapPosition(a);n.jumpTo(t)})},.5)};n.helpReached=function(){n.say("mapHelp")};n.townReached=function(){app.Scene.change(app.ff.GameSceneCountry)};n.cityReached=function(){app.Scene.change(app.ff.GameSceneCity)};n.resortReached=function(){app.Scene.change(app.ff.GameSceneResort)};n.islandReached=function(){app.Scene.change(app.ff.IslandScene)};n.toMainMenu=function(){app.Scene.change(app.ff.MainMenuScene)}};