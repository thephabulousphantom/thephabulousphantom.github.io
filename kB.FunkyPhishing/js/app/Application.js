app.Application=new function(){var a=Class.inherit(this);var p={};p.running=false;p.loaded=false;p.time=performance.now();a.time=function(){return p.time};a.pause=function(){p.running=false};a.resume=function(){if(!p.running){p.running=true;requestAnimationFrame(p.heartbeat)}};a.quit=function(){if(app.platform.quit){return app.platform.quit()}try{window.close()}catch(a){}try{window.top.close()}catch(a){}};a.log=function(a){var p=null;if(a.type()&&a.severity&&a.message){p=""+a.type()+", severity "+a.severity+": "+a.message}else{p=""+a}console.log(p)};window.addEventListener("DOMContentLoaded",function(){if(!p.loaded){p.onLoad();p.loaded=true}});p.onLoad=function(){if(app.sfx.Sound.audioDelay==0){app.sfx.Sound.audioDelay=app.Application.configuration.audioDelay}app.data.Driver.load(new app.Application.configuration.dataDriver);app.analytics.Driver.load(new app.Application.configuration.analyticsDriver);app.gfx.Driver.load(new app.Application.configuration.gfxDriver);app.sfx.Driver.load(new app.Application.configuration.sfxDriver);app.ad.Driver.load(new app.Application.configuration.adDriver);app.data.Strings.init();setTimeout(function(){app.sfx.Driver.current.mute(app.ff.State.sound()==="off")},3e3);if(app.Application.query["difficulty"]){app.ff.State.difficulty(app.Application.query["difficulty"]|0)}if(app.Application.query["level"]){app.ff.State.level(app.Application.query["level"]|0)}for(var p=0;p<app.Application.configuration.inputDrivers.length;p++){app.input.Driver.load(new app.Application.configuration.inputDrivers[p])}app.Scene.load(new app.ff.MainMenuScene);a.resume()};p.heartbeat=function(e){if(!e){e=performance.now()}p.time=e;var i=null;while(i=app.Application.commands.dequeue()){a.processCommand(i)}if(app.Scene.current){app.Scene.current.updateFrame(e|0);while(i=app.Scene.commands.dequeue()){app.Scene.current.processCommand(i)}}if(app.gfx.Driver.current){app.gfx.Driver.current.updateFrame(e|0)}if(p.running){requestAnimationFrame(p.heartbeat)}};a.processCommand=function(a){switch(a.code()){case"click":case"action":case"altaction":case"back":app.Scene.commands.enqueue(a);return true;case"scene":app.Scene.load(new(a.scene()));return true;default:return false}};a.query={};{var e=(window.location.search||"?").substr(1);e.replace(/([^&=]+)=?([^&]*)(?:&+|$)/g,function(p,e,i){(a.query[e]=a.query[e]||[]).push(i)})}};app.Application.commands=new app.CommandQueue;app.Application.configuration={analyticsDriver:app.Application.query["analytics"]?eval("app.analytics."+app.Application.query["analytics"]):app.analytics.ConsoleDriver,gfxDriver:app.Application.query["gfx"]?eval("app.gfx."+app.Application.query["gfx"]):app.gfx.CssTextDriver,sfxDriver:app.Application.query["sfx"]?eval("app.sfx."+app.Application.query["sfx"]):app.sfx.Html5Driver,adDriver:app.Application.query["ad"]?eval("app.ad."+app.Application.query["ad"]):app.ad.NoAdsDriver,inputDrivers:[app.input.KeyboardDriver,app.Application.query["input"]?eval("app.input."+app.Application.query["input"]):app.input.MouseDriver],dataDriver:app.Application.query["data"]?eval("app.data."+app.Application.query["data"]):app.data.LocalStorageDriver,audioDelay:app.Application.query["audioDelay"]?1*app.Application.query["audioDelay"]:0};