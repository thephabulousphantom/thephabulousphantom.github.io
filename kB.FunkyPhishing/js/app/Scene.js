app.Scene=function(e,t){var i=Class.inherit(this,app.gfx.Visual,arguments);var n={};n.spritesLookup={};n.sprites=new Array;n.movingSprites=new Array;n.tempPosition=new app.gfx.Position;n.loadingItems=0;n.loadedItems=0;n.loadedCallback=null;n.frame=0;i.position.x=0;i.position.y=0;i.size.x=app.gfx.Driver.current.screenSize.game.x;i.size.y=app.gfx.Driver.current.screenSize.game.y;i.frame=function(){return n.frame};i.cleanup=function(){n.spritesLookup={};while(n.sprites.length){var e=n.sprites.pop();e.hide();e.cleanup();delete e}i.base.cleanup()};i.addSprite=function(e,t){e.init(i,t);n.spritesLookup[e.id()]=e;n.sprites.push(e)};i.getSprite=function(e){return n.spritesLookup[e]};n.spritesAt=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];i.findSpritesAt=function(e,t,i,s){var p=0;for(var o=0;o<n.sprites.length;o++){var l=n.sprites[o];if(!l.visible){continue}if(l.position.x<=i&&l.position.x+l.size.x>=e&&l.position.y<=s&&l.position.y+l.size.y>=t){n.spritesAt[p++]=l}}n.spritesAt[p]=null;return n.spritesAt};i.findTaggedSprite=function(e){for(var t=0;t<n.sprites.length;t++){var i=n.sprites[t];if(!i.visible){continue}if(i.tag()==e){return i}}return null};i.processCommand=function(e){switch(e.code()){case"click":n.tempPosition.setBrowser(e.x(),e.y());var t=n.tempPosition.x;var i=n.tempPosition.y;var s=null;for(var p=0;p<n.sprites.length;p++){var o=n.sprites[p];if(!o.visible){continue}if(t>=o.position.x&&t<=o.position.x+o.size.x&&i>=o.position.y&&i<=o.position.y+o.size.y){if(o.onclick){s=o}}}if(s){s.onclick();return s}break;case"action":for(var p=0;p<n.sprites.length;p++){var o=n.sprites[p];if(!o.onclick||!o.onclickAliases||!o.visible){continue}for(var p=0;p<o.onclickAliases.length;p++){if(o.onclickAliases[p]=="action"){o.onclick()}}}break;default:break}return null};n.moveSprites=function(e){if(!e){e=app.Application.time()}for(var t=0;t<n.movingSprites.length;t++){var s=n.movingSprites[t];if(e>=s.end.time){if(s.sprite){i.stop(s.sprite.id(),true)}else{if(s.inUse){s.inUse=false}else{delete n.movingSprites[t]}n.movingSprites.splice(t,1);if(s.callback){s.callback(s.sprite)}}t--;continue}s.move.call(s,e)}};i.updateFrame=function(e){n.moveSprites(e);for(var t=0;t<n.sprites.length;t++){if(n.sprites[t].visible){n.sprites[t].animate(e)}}n.frame++};i.stop=function(e,t){if(!n.spritesLookup[e]){return}for(var i=0;i<n.movingSprites.length;i++){var s=n.movingSprites[i];if(s.sprite&&s.sprite.id()==e){if(t){s.sprite.position.x=s.end.x;s.sprite.position.y=s.end.y}if(n.movingSprites[i].inUse){n.movingSprites[i].inUse=false}else{delete n.movingSprites[i]}n.movingSprites.splice(i,1);if(t){if(s.callback){s.callback(s.sprite)}}break}}};i.delay=function(e,t){var i=app.Scene.delayObject.get();i.start.time=app.Application.time();i.end.time=i.start.time+e;i.callback=t;n.movingSprites.push(i)};i.abortdelay=function(e){for(var t=0;t<n.movingSprites.length;t++){if(n.movingSprites[t].callback==e){if(n.movingSprites[t].inUse){n.movingSprites[t].inUse=false}else{delete n.movingSprites[t]}n.movingSprites.splice(t,1)}}};n.tempPosition=new app.gfx.Position(0,0);i.move=function(e,t,s,p,o){i.stop(e,true);if(!n.spritesLookup[e]){return}var l=app.Scene.moveObject.get();l.sprite=n.spritesLookup[e];l.start.x=l.sprite.position.x;l.start.y=l.sprite.position.y;l.start.time=app.Application.time();n.tempPosition.x=t;n.tempPosition.y=s;l.end.x=n.tempPosition.x;l.end.y=n.tempPosition.y;l.end.time=l.start.time+p;l.callback=o;n.movingSprites.push(l)};i.bounceTo=function(e,t,s,p,o,l,a,r,c){i.stop(e,true);if(!n.spritesLookup[e]){return}var u=app.Scene.bounceToObject.get();u.sprite=n.spritesLookup[e];u.amplitude=p;u.scale=c;u.times=a?a:1;u.position=r?r:0;u.frame=0;u.start.x=u.sprite.position.x;u.start.y=u.sprite.position.y;u.start.time=app.Application.time();u.start.size.x=u.sprite.size.x;u.start.size.y=u.sprite.size.y;u.end.x=t?t:u.sprite.position.x;u.end.y=s?s:u.sprite.position.y;u.end.time=u.start.time+o;u.end.size.x=(c?c:0)*u.sprite.size.x;u.end.size.y=(c?c:0)*u.sprite.size.y;u.callback=l;n.movingSprites.push(u)};i.bounce=function(e,t,s,p,o,l){i.stop(e,true);if(!n.spritesLookup[e]){return}var a=app.Scene.bounceObject.get();a.sprite=n.spritesLookup[e];a.amplitude=t;a.times=o?o:1;a.position=l?l:0;a.start.x=a.sprite.position.x;a.start.y=a.sprite.position.y;a.start.time=app.Application.time();a.end.x=a.sprite.position.x;a.end.y=a.sprite.position.y;a.end.time=a.start.time+s;a.callback=p;n.movingSprites.push(a)};n.loadingStarted=null;i.loading=function(e,t){n.loadingItems=e|0;n.loadedItems=0;n.loadedCallback=t;n.loadingStarted=app.Application.time()};i.loaded=function(e){n.loadedItems+=e===undefined?1:(e|0)==0?1:e|0;if(n.loadedItems>=n.loadingItems&&n.loadedCallback){var t=app.Application.time()-n.loadingStarted;setTimeout(function(){app.Scene.loadingScene.updateProgress(n.loadingItems?n.loadedItems/n.loadingItems:1);if(n.loadedCallback){n.loadedCallback();n.loadedCallback=null}},t<3e3?3400-t:400)}else{app.Scene.loadingScene.updateProgress(n.loadingItems?n.loadedItems/n.loadingItems:1)}}};app.Scene.current=null;app.Scene.load=function(e){if(app.Scene.loadingScene==null){app.Scene.loadingScene=new app.ff.LoadingScene;app.Scene.loadingScene.init()}app.Scene.loadingScene.show();if(app.Scene.current==app.Scene.loadingScene){return false}if(app.Scene.current){app.Scene.current.hide();app.Scene.current.cleanup();delete currentScene}app.Scene.current=app.Scene.loadingScene;e.init(null,function(){app.analytics.Driver.current.onSceneShown(e);app.Scene.current=e;app.Scene.current.show();app.Scene.loadingScene.hide()});return true};app.Scene.change=function(e){var t=app.Command.get("scene");t.scene(e);app.Application.commands.enqueue(t)};app.Scene.commands=new app.CommandQueue;app.Scene.delayObject={pool:[],get:function(){for(var e=0;e<app.Scene.delayObject.pool.length;e++){if(!app.Scene.delayObject.pool[e].inUse){app.Scene.delayObject.pool[e].inUse=true;return app.Scene.delayObject.pool[e]}}return null},init:function(){for(var e=0;e<50;e++){app.Scene.delayObject.pool.push({inUse:false,sprite:null,start:{x:0,y:0,time:0},end:{x:0,y:0,time:0},callback:null,move:function(e){}})}}};app.Scene.moveObject={pool:[],get:function(){for(var e=0;e<app.Scene.moveObject.pool.length;e++){if(!app.Scene.moveObject.pool[e].inUse){app.Scene.moveObject.pool[e].inUse=true;return app.Scene.moveObject.pool[e]}}return null},init:function(){for(var e=0;e<50;e++){app.Scene.moveObject.pool.push({inUse:false,sprite:null,start:{x:0,y:0,time:0},end:{x:0,y:0,time:0},callback:null,move:function(e){var t=Math.min((e-this.start.time)/(this.end.time-this.start.time),1);this.sprite.position.x=this.start.x+t*(this.end.x-this.start.x);this.sprite.position.y=this.start.y+t*(this.end.y-this.start.y)}})}}};app.Scene.bounceToObject={pool:[],get:function(){for(var e=0;e<app.Scene.bounceToObject.pool.length;e++){if(!app.Scene.bounceToObject.pool[e].inUse){app.Scene.bounceToObject.pool[e].inUse=true;return app.Scene.bounceToObject.pool[e]}}return null},init:function(){for(var e=0;e<50;e++){app.Scene.bounceToObject.pool.push({inUse:false,sprite:null,amplitude:0,scale:0,times:1,position:0,frame:0,start:{x:0,y:0,time:0,size:{x:0,y:0}},end:{x:0,y:0,time:0,size:{x:0,y:0}},callback:null,move:function(e){var t=Math.min((e-this.start.time)/(this.end.time-this.start.time),1);var i=(this.end.time-e)/(this.end.time-this.start.time);if(this.scale&&this.sprite.timeToAnimate(e)){this.sprite.size.x=this.start.size.x+t*(this.end.size.x-this.start.size.x);this.sprite.size.y=this.start.size.y+t*(this.end.size.y-this.start.size.y)}this.sprite.position.x=this.start.x+t*(this.end.x-this.start.x);this.sprite.position.y=this.start.y+t*(this.end.y-this.start.y)-this.amplitude*i*Math.abs(Math.sin(t*this.times*Math.PI+this.position*Math.PI))}})}}};app.Scene.bounceObject={pool:[],get:function(){for(var e=0;e<app.Scene.bounceObject.pool.length;e++){if(!app.Scene.bounceObject.pool[e].inUse){app.Scene.bounceObject.pool[e].inUse=true;return app.Scene.bounceObject.pool[e]}}return null},init:function(){for(var e=0;e<50;e++){app.Scene.bounceObject.pool.push({inUse:false,sprite:0,amplitude:0,times:0,position:0,start:{x:0,y:0,time:0},end:{x:0,y:0,time:0},callback:0,move:function(e){var t=Math.min((e-this.start.time)/(this.end.time-this.start.time),1);var i=(this.end.time-e)/(this.end.time-this.start.time);this.sprite.position.x=this.start.x;this.sprite.position.y=this.start.y-this.amplitude*i*Math.abs(Math.sin(t*this.times*Math.PI+this.position*Math.PI))}})}}};app.Scene.delayObject.init();app.Scene.moveObject.init();app.Scene.bounceToObject.init();app.Scene.bounceObject.init();